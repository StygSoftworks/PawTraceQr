import{r as A,s as F,c as K,j as e,f as X,L as Y,D as U,b as q}from"./index-BQ22oCNL.js";import{u as J}from"./useQuery-Ope2sH_a.js";import{C as M,c as O,b as R,d as Z,a as z}from"./card-BUGqioNM.js";import{B as C}from"./badge-DczbN3zq.js";import{B as E}from"./button-DrXzTa1i.js";import{S as _}from"./skeleton-DZYKAv8R.js";import{f as ee,b as se,c as ae,a as te,D as re}from"./dialog-e_CCo_DT.js";import{A as T,a as D}from"./alert-BewOwHlx.js";import{E as le}from"./eye-9jBToAWE.js";import{a as ie,H as ne}from"./Header-BffrzQ-h.js";import{T as H}from"./index-Dy6BwgCL.js";import{P as I}from"./paw-print-C-92AjAN.js";import{H as oe,M as ce}from"./map-pin-Dn9_Vojk.js";import{I as me}from"./info-BjRnx3du.js";import{c as V}from"./createLucideIcon-C8wWVUVH.js";import{M as Q}from"./mail-l6kqbz2D.js";import"./index-BLqxMqt7.js";import"./index-CNGF4dQh.js";import"./index-BeWzbmyO.js";import"./index-BNXpBZ0n.js";import"./x-Dnrag34T.js";import"./useProfile-CoQlQDbd.js";import"./useMutation-M1gzAMzN.js";import"./Logo-B_gBZRKl.js";import"./log-in-D6axOvZq.js";import"./user-plus-Dofc3G7q.js";import"./credit-card-sQFOWTrw.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xe=V("clock",de);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],L=V("phone",pe);function he({shortId:s,askGeo:a=!0}){return A.useEffect(()=>{if(!s)return;let n=!1;return(async()=>{try{let i={};if(a&&"geolocation"in navigator)try{const r=await new Promise((o,l)=>navigator.geolocation.getCurrentPosition(o,l,{timeout:3e3}));i={lat:r.coords.latitude,lng:r.coords.longitude}}catch{}if(n)return;await F.rpc("log_scan",{p_short_id:s,p_referrer:document.referrer||null,p_ua:navigator.userAgent,p_city:null,p_region:null,p_country:null,p_lat:i.lat??null,p_lng:i.lng??null})}catch(i){console.warn("log_scan failed:",i)}})(),()=>{n=!0}},[s,a]),null}function ue(s){const a=K.c(17),{petId:n,days:p,label:i}=s,r=p===void 0?30:p,o=i===void 0?"Scans":i;let l,t;a[0]!==r||a[1]!==n?(l=["pet_scan_count",n,r],t=()=>ee(n,r),a[0]=r,a[1]=n,a[2]=l,a[3]=t):(l=a[2],t=a[3]);const f=!!n;let h;a[4]!==l||a[5]!==t||a[6]!==f?(h={queryKey:l,queryFn:t,staleTime:3e4,enabled:f},a[4]=l,a[5]=t,a[6]=f,a[7]=h):h=a[7];const{data:g,isLoading:k,isError:j}=J(h);if(!n)return null;let m;a[8]===Symbol.for("react.memo_cache_sentinel")?(m=e.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"h-5 w-5 text-primary"})}),a[8]=m):m=a[8];let d;a[9]!==r||a[10]!==o?(d=e.jsxs("p",{className:"text-sm font-medium",children:[o," (Last ",r," days)"]}),a[9]=r,a[10]=o,a[11]=d):d=a[11];const u=k?"Loading...":j?"‚Äî":`${g} view${g===1?"":"s"}`;let c;a[12]!==u?(c=e.jsx("p",{className:"text-sm text-muted-foreground",children:u}),a[12]=u,a[13]=c):c=a[13];let x;return a[14]!==c||a[15]!==d?(x=e.jsxs("div",{className:"flex items-center gap-3",children:[m,e.jsxs("div",{children:[d,c]})]}),a[14]=c,a[15]=d,a[16]=x):x=a[16],x}function G(s){if(!s)return"";const a=new Date(s).getTime(),n=Date.now();if(isNaN(a)||n<=a)return"just now";const p=n-a,i=Math.floor(p/(1e3*60)),r=Math.floor(i/60),o=Math.floor(r/24);if(o>0){const l=r%24;return`${o} day${o>1?"s":""}${l?`, ${l} hour${l>1?"s":""}`:""}`}if(r>0){const l=i%60;return`${r} hour${r>1?"s":""}${l?`, ${l} min`:""}`}return`${i} min`}function Qe(){const s=K.c(37),{id:a}=X(),[n,p]=A.useState(!1);let i;s[0]!==a?(i=["public-pet",a],s[0]=a,s[1]=i):i=s[1];const r=!!a;let o;s[2]!==a?(o=async()=>{const{data:$,error:B}=await F.from("public_pets").select("*").eq("short_id",a).maybeSingle();if(B)throw B;if(!$)return null;const{data:W}=await F.from("pet_themes").select("theme_preset").eq("pet_id",$.id).maybeSingle();return{...$,theme_preset:W?.theme_preset}},s[2]=a,s[3]=o):o=s[3];let l;s[4]!==i||s[5]!==r||s[6]!==o?(l={queryKey:i,enabled:r,queryFn:o,staleTime:6e4},s[4]=i,s[5]=r,s[6]=o,s[7]=l):l=s[7];const{data:t,isLoading:f,isError:h}=J(l);let g;s[8]!==t?.theme_preset?(g=()=>{const $=t?.theme_preset||U;return q($,!1),fe},s[8]=t?.theme_preset,s[9]=g):g=s[9];const k=t?.theme_preset;let j;s[10]!==k?(j=[k],s[10]=k,s[11]=j):j=s[11],A.useEffect(g,j);let m;s[12]!==a?(m=e.jsx(he,{shortId:a,askGeo:!0}),s[12]=a,s[13]=m):m=s[13];let d,u;s[14]===Symbol.for("react.memo_cache_sentinel")?(d=e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-brand-rose/25 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-brand-lavender/25 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/3 right-1/3 w-96 h-96 bg-brand-peach/15 rounded-full blur-3xl"})]}),u=e.jsx(ne,{}),s[14]=d,s[15]=u):(d=s[14],u=s[15]);let c;s[16]!==t||s[17]!==h||s[18]!==f?(c=e.jsx("main",{className:"relative mx-auto max-w-5xl px-4 sm:px-6 py-8 md:py-12",children:f?e.jsx(M,{className:"overflow-hidden shadow-xl",children:e.jsxs("div",{className:"grid gap-6 p-6 lg:grid-cols-[400px,1fr]",children:[e.jsx(_,{className:"h-96 w-full rounded-lg"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(_,{className:"h-8 w-48"}),e.jsx(_,{className:"h-6 w-64"}),e.jsx(_,{className:"h-4 w-full"}),e.jsx(_,{className:"h-4 w-full"}),e.jsx(_,{className:"h-24 w-full"})]})]})}):h||!t?e.jsxs(M,{className:"shadow-xl",children:[e.jsx(O,{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 bg-destructive/10 rounded-xl flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-destructive"})}),e.jsxs("div",{children:[e.jsx(R,{className:"text-2xl",children:"Pet Not Found"}),e.jsx(Z,{className:"text-base",children:"This QR code may be invalid or the pet profile is no longer available"})]})]})}),e.jsx(z,{children:e.jsx(E,{asChild:!0,className:"gap-2",children:e.jsxs(Y,{to:"/",children:[e.jsx(ie,{className:"h-4 w-4"}),"Go to Homepage"]})})})]}):e.jsxs("div",{className:"space-y-6",children:[t.missing&&e.jsxs(T,{variant:"destructive",className:"animate-in fade-in-50 slide-in-from-top-2 duration-300",children:[e.jsx(H,{className:"h-5 w-5"}),e.jsxs(D,{className:"text-base font-medium",children:[e.jsx("span",{className:"block mb-1",children:"üö® This pet is currently MISSING!"}),t.missing_since&&e.jsxs("span",{className:"text-sm opacity-90",children:["Missing for ",G(t.missing_since)]})]})]}),e.jsxs(M,{className:"overflow-hidden shadow-xl border-primary/10",children:[e.jsx(O,{className:"space-y-4 bg-gradient-to-r from-orange-50/80 to-amber-50/80 dark:bg-slate-900/50",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center ring-4 ring-primary/5",children:e.jsx(I,{className:"h-5 w-5 text-primary"})}),e.jsx(R,{className:"text-3xl tracking-tight",children:t.name})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(C,{variant:"secondary",className:"capitalize text-sm px-3 py-1",children:[t.species==="dog"?"üêï":t.species==="cat"?"üê±":"üêæ"," ",t.species]}),t.breed&&e.jsx(C,{variant:"outline",className:"text-sm px-3 py-1",children:t.breed}),t.color&&e.jsx(C,{variant:"outline",className:"text-sm px-3 py-1",children:t.color})]})]}),e.jsx(C,{variant:t.missing?"destructive":"default",className:`text-sm px-4 py-2 gap-2 ${t.missing?"animate-pulse":""}`,children:t.missing?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4"}),"Missing"]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4"}),"Safe at Home"]})})]})}),e.jsxs(z,{className:"grid gap-8 p-6 lg:grid-cols-[1fr,400px]",children:[e.jsxs("div",{className:"space-y-6 order-2 lg:order-1",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(me,{className:"h-5 w-5 text-primary"}),"About ",t.name]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:t.description||"No additional description provided."})]}),(t.owner_email||t.owner_phone)&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(L,{className:"h-5 w-5 text-primary"}),"Contact Owner"]}),e.jsx(T,{className:"border-blue-200 bg-blue-50 dark:border-blue-900 dark:bg-blue-950",children:e.jsx(D,{className:"text-blue-800 dark:text-blue-200",children:"If you've found this pet, please contact the owner using the information below"})}),e.jsxs("div",{className:"space-y-3 pl-4 border-l-2 border-primary/20",children:[t.owner_phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Phone"}),e.jsx("a",{href:`tel:${t.owner_phone}`,className:"text-primary hover:underline font-medium",children:t.owner_phone})]})]}),t.owner_email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Email"}),e.jsx("a",{href:`mailto:${t.owner_email}`,className:"text-primary hover:underline font-medium",children:t.owner_email})]})]}),t.missing&&e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("div",{className:"h-10 w-10 bg-orange-100 dark:bg-orange-950 rounded-lg flex items-center justify-center",children:e.jsx(xe,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Last Seen"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.missing_since?G(t.missing_since)+" ago":"Recently"})]})]}),e.jsx(ue,{petId:t.id,days:30,label:"QR Code Scans"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[t.owner_phone&&e.jsx(E,{asChild:!0,className:"flex-1 gap-2",variant:"success",children:e.jsxs("a",{href:`tel:${t.owner_phone}`,children:[e.jsx(L,{className:"h-4 w-4"}),"Call Owner"]})}),t.owner_email&&e.jsx(E,{asChild:!0,variant:"outline",className:"flex-1 gap-2",children:e.jsxs("a",{href:`mailto:${t.owner_email}`,children:[e.jsx(Q,{className:"h-4 w-4"}),"Send Email"]})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(ce,{className:"h-5 w-5 text-primary"}),"Found This Pet?"]}),e.jsx(T,{children:e.jsx(D,{className:"space-y-2",children:e.jsx("p",{className:"text-sm",children:"Please share your location with the owner when you contact them. This helps reunite pets faster!"})})})]})]}),e.jsx("div",{className:"space-y-4 order-1 lg:order-2",children:t.photo_url?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>p(!0),className:"group relative w-full overflow-hidden rounded-xl border-2 border-primary/10 ring-4 ring-primary/5 transition-all hover:scale-[1.02] hover:shadow-lg cursor-pointer",children:[e.jsx("img",{src:t.photo_url,alt:`${t.name}`,className:"w-full h-auto max-h-[600px] object-contain bg-white"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity bg-black/70 px-4 py-2 rounded-lg text-sm",children:"Click to enlarge"})})]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Click image to view full size"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 rounded-xl border-2 border-dashed border-primary/20 bg-slate-50 dark:bg-slate-900",children:[e.jsx(I,{className:"h-16 w-16 text-primary/30 mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No photo provided"})]})})]})]})]})}),s[16]=t,s[17]=h,s[18]=f,s[19]=c):c=s[19];let x;s[20]===Symbol.for("react.memo_cache_sentinel")?(x=e.jsx(I,{className:"h-5 w-5"}),s[20]=x):x=s[20];const P=t?.name;let N;s[21]!==P?(N=e.jsx(se,{className:"p-6 pb-0",children:e.jsxs(ae,{className:"flex items-center gap-2",children:[x,P,"'s Photo"]})}),s[21]=P,s[22]=N):N=s[22];let y;s[23]!==t?(y=t?.photo_url&&e.jsx("div",{className:"p-6 pt-4 overflow-auto",children:e.jsx("img",{src:t.photo_url,alt:`${t.name} full size`,className:"w-full h-auto rounded-lg"})}),s[23]=t,s[24]=y):y=s[24];let b;s[25]!==N||s[26]!==y?(b=e.jsxs(te,{className:"max-w-4xl max-h-[90vh] p-0 bg-white dark:bg-slate-900",children:[N,y]}),s[25]=N,s[26]=y,s[27]=b):b=s[27];let v;s[28]!==n||s[29]!==b?(v=e.jsx(re,{open:n,onOpenChange:p,children:b}),s[28]=n,s[29]=b,s[30]=v):v=s[30];let w;s[31]!==c||s[32]!==v?(w=e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-pink-50 to-purple-50 dark:from-slate-950 dark:via-purple-950/20 dark:to-slate-900",children:[d,u,c,v]}),s[31]=c,s[32]=v,s[33]=w):w=s[33];let S;return s[34]!==w||s[35]!==m?(S=e.jsxs(e.Fragment,{children:[m,w]}),s[34]=w,s[35]=m,s[36]=S):S=s[36],S}function fe(){const s=localStorage.getItem("theme_preset"),a=localStorage.getItem("dark_mode")==="true";s?q(s,a):q(U,a)}export{Qe as default};
