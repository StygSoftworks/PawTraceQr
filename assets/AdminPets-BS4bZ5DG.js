import{s as Z,r as l,j as e}from"./index-D0W7q_7F.js";import{u as Y}from"./useQuery-BXCE_1Zp.js";import{u as K}from"./useAdminCheck-BhSEWQeS.js";import{d as t,C as r,b as L,a as _,c as W}from"./card-Bc7eUURN.js";import{B as y}from"./button-zkU1qkGu.js";import{I as G}from"./input-BCKOSWcm.js";import{B as f}from"./badge-CDxnUr7a.js";import{S as J,T as X,a as ee,b as C,c,d as se,e as n,f as S,Q as ae,H as ie}from"./format-Dy_csP1z.js";import{S as M,a as T,b as k,c as A,d as i}from"./select-ByIndHiI.js";import{b as te,A as re,a as ne}from"./avatar-ECrTtebt.js";import{g as le}from"./billing-X1lU7Ov_.js";import{C as ce}from"./circle-alert-BCiABaJe.js";import{P as D}from"./paw-print-DG83h3DZ.js";import{c as v}from"./createLucideIcon-YUNKGbtX.js";import{C as de}from"./chevron-up-DU79MXN-.js";import{C as oe}from"./chevron-down-DiVdaDii.js";import{E as xe}from"./eye-DEKFakkm.js";import{Q as me}from"./qr-code-ZBYM1oJo.js";import"./index-evFw_6fT.js";import"./index-D8j6CDy2.js";import"./dialog-DVa5l9x4.js";import"./index-CHt30Jrt.js";import"./index-Dh20Ov_T.js";import"./index-BizdK3DN.js";import"./index-Cy_ilBqL.js";import"./qr-Dv_Hb54F.js";import"./index-D5iRRVG3.js";import"./index-DuOWaFuV.js";import"./index-DpEVKMG7.js";import"./check-BrjXxH2D.js";const he=[["path",{d:"M12 5c.67 0 1.35.09 2 .26 1.78-2 5.03-2.84 6.42-2.26 1.4.58-.42 7-.42 7 .57 1.07 1 2.24 1 3.44C21 17.9 16.97 21 12 21s-9-3-9-7.56c0-1.25.5-2.4 1-3.44 0 0-1.89-6.42-.5-7 1.39-.58 4.72.23 6.5 2.23A9.04 9.04 0 0 1 12 5Z",key:"x6xyqk"}],["path",{d:"M8 14v.5",key:"1nzgdb"}],["path",{d:"M16 14v.5",key:"1lajdz"}],["path",{d:"M11.25 16.25h1.5L12 17l-.75-.75Z",key:"12kq1m"}]],je=v("cat",he);const ue=[["path",{d:"M11.25 16.25h1.5L12 17z",key:"w7jh35"}],["path",{d:"M16 14v.5",key:"1lajdz"}],["path",{d:"M4.42 11.247A13.152 13.152 0 0 0 4 14.556C4 18.728 7.582 21 12 21s8-2.272 8-6.444a11.702 11.702 0 0 0-.493-3.309",key:"u7s9ue"}],["path",{d:"M8 14v.5",key:"1nzgdb"}],["path",{d:"M8.5 8.5c-.384 1.05-1.083 2.028-2.344 2.5-1.931.722-3.576-.297-3.656-1-.113-.994 1.177-6.53 4-7 1.923-.321 3.651.845 3.651 2.235A7.497 7.497 0 0 1 14 5.277c0-1.39 1.844-2.598 3.767-2.277 2.823.47 4.113 6.006 4 7-.08.703-1.725 1.722-3.656 1-1.261-.472-1.855-1.45-2.239-2.5",key:"v8hric"}]],ge=v("dog",ue);const pe=[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]],Ne=v("mountain",pe);const fe=[["path",{d:"M10 10v.2A3 3 0 0 1 8.9 16H5a3 3 0 0 1-1-5.8V10a3 3 0 0 1 6 0Z",key:"1l6gj6"}],["path",{d:"M7 16v6",key:"1a82de"}],["path",{d:"M13 19v3",key:"13sx9i"}],["path",{d:"M12 19h8.3a1 1 0 0 0 .7-1.7L18 14h.3a1 1 0 0 0 .7-1.7L16 9h.2a1 1 0 0 0 .8-1.7L13 3l-1.4 1.5",key:"1sj9kv"}]],ve=v("trees",fe);async function be(){const{data:j,error:u}=await Z.rpc("get_all_pets_admin");if(u)throw u;return j??[]}function Je(){const{isAdmin:j,isLoading:u}=K(),[d,z]=l.useState(""),[m,P]=l.useState("all"),[h,E]=l.useState("all"),[o,Q]=l.useState("all"),[b,R]=l.useState(null),[g,F]=l.useState(null),{data:a,isLoading:V,isError:$}=Y({queryKey:["admin-all-pets"],queryFn:be,enabled:j,staleTime:3e4}),p=l.useMemo(()=>a?a.filter(s=>{const N=d===""||s.pet_name.toLowerCase().includes(d.toLowerCase())||s.owner_email?.toLowerCase().includes(d.toLowerCase())||s.short_id.toLowerCase().includes(d.toLowerCase()),w=m==="all"||s.species===m,O=h==="all"||s.tag_type===h,U=o==="all"||o==="missing"&&s.missing||o==="not_missing"&&!s.missing;return N&&w&&O&&U}):[],[a,d,m,h,o]),x=l.useMemo(()=>a?{total:a.length,dogs:a.filter(s=>s.species==="dog").length,cats:a.filter(s=>s.species==="cat").length,other:a.filter(s=>s.species==="other").length,missing:a.filter(s=>s.missing).length,active:a.filter(s=>s.subscription_status==="active").length}:{total:0,dogs:0,cats:0,other:0,missing:0,active:0},[a]),B=s=>{const w=`${window.location.origin}/p/${s.short_id}`;window.open(w,"_blank")},I=s=>{const N={id:s.pet_id,owner_id:s.owner_id,name:s.pet_name,species:s.species,breed:s.breed,color:s.color,weight:s.weight,birthdate:s.birthdate,microchip_id:s.microchip_id,description:s.description,notes:s.notes,vaccinations:s.vaccinations,photo_url:s.photo_url,created_at:s.created_at,updated_at:s.updated_at,missing:s.missing,missing_since:s.missing_since,qr_url:s.qr_url,short_id:s.short_id,tag_type:s.tag_type,environment:s.environment,paypal_subscription_id:s.paypal_subscription_id,subscription_status:s.subscription_status,subscription_activated_at:s.subscription_activated_at,subscription_expires_at:s.subscription_expires_at,subscription_plan_id:s.subscription_plan_id};F(N)},q=s=>{R(b===s?null:s)},H=s=>{switch(s){case"indoor":return e.jsx(ie,{className:"h-3.5 w-3.5"});case"outdoor":return e.jsx(ve,{className:"h-3.5 w-3.5"});case"indoor_outdoor":return e.jsx(Ne,{className:"h-3.5 w-3.5"});default:return null}};return u?e.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-10",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})}):j?e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-10 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:"All Pets"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage all pets across all users"})]}),e.jsx(D,{className:"h-8 w-8 text-primary"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4 mb-6",children:[e.jsx(t,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:x.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Pets"})]})}),e.jsx(t,{children:e.jsxs(r,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),x.dogs]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dogs"})]})}),e.jsx(t,{children:e.jsxs(r,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),x.cats]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Cats"})]})}),e.jsx(t,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:x.other}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Other"})]})}),e.jsx(t,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-destructive",children:x.missing}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Missing"})]})}),e.jsx(t,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Subs"})]})})]}),e.jsxs(t,{className:"mb-6",children:[e.jsx(L,{children:e.jsx(_,{className:"text-lg",children:"Filters"})}),e.jsx(r,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search by name, email, or ID...",value:d,onChange:s=>z(s.target.value),className:"pl-10"})]}),e.jsxs(M,{value:m,onValueChange:P,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"All Species"})}),e.jsxs(A,{children:[e.jsx(i,{value:"all",children:"All Species"}),e.jsx(i,{value:"dog",children:"Dogs"}),e.jsx(i,{value:"cat",children:"Cats"}),e.jsx(i,{value:"other",children:"Other"})]})]}),e.jsxs(M,{value:h,onValueChange:E,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"All Tag Types"})}),e.jsxs(A,{children:[e.jsx(i,{value:"all",children:"All Tag Types"}),e.jsx(i,{value:"dog",children:"Dog Tags"}),e.jsx(i,{value:"cat",children:"Cat Tags"})]})]}),e.jsxs(M,{value:o,onValueChange:Q,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"All Status"})}),e.jsxs(A,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"missing",children:"Missing Only"}),e.jsx(i,{value:"not_missing",children:"Not Missing"})]})]})]})})]}),e.jsxs(t,{children:[e.jsxs(L,{children:[e.jsxs(_,{children:["Pets (",p.length,")"]}),e.jsx(W,{children:d||m!=="all"||h!=="all"||o!=="all"?`Showing ${p.length} of ${a?.length??0} pets`:`Total of ${a?.length??0} pets`})]}),e.jsx(r,{children:V?e.jsx("p",{className:"text-muted-foreground",children:"Loading pets..."}):$?e.jsx("p",{className:"text-destructive",children:"Error loading pets"}):p.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No pets found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(X,{children:[e.jsx(ee,{children:e.jsxs(C,{children:[e.jsx(c,{className:"w-[50px]"}),e.jsx(c,{children:"Pet"}),e.jsx(c,{children:"Owner"}),e.jsx(c,{children:"Species"}),e.jsx(c,{children:"Tag Type"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Created"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:p.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs(C,{className:"group",children:[e.jsx(n,{children:e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>q(s.pet_id),className:"h-8 w-8",children:b===s.pet_id?e.jsx(de,{className:"h-4 w-4"}):e.jsx(oe,{className:"h-4 w-4"})})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"h-10 w-10",children:s.photo_url?e.jsx(re,{src:s.photo_url,alt:s.pet_name}):e.jsx(ne,{children:e.jsx(D,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.pet_name}),e.jsx("div",{className:"text-xs text-muted-foreground font-mono",children:s.short_id})]})]})}),e.jsx(n,{children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:s.owner_email??"Unknown"}),s.owner_name&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.owner_name})]})}),e.jsx(n,{children:e.jsx(f,{variant:"outline",className:"capitalize",children:s.species})}),e.jsx(n,{children:e.jsx(f,{variant:s.tag_type==="dog"?"default":"secondary",children:s.tag_type==="dog"?"Dog Size":"Cat Size"})}),e.jsx(n,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[s.missing&&e.jsx(f,{variant:"destructive",className:"w-fit",children:"Missing"}),e.jsx(f,{variant:le(s.subscription_status),className:"w-fit capitalize",children:s.subscription_status})]})}),e.jsx(n,{children:e.jsx("div",{className:"text-sm",children:S(new Date(s.created_at),"MMM d, yyyy")})}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>B(s),title:"View public page",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>I(s),title:"View QR code",children:e.jsx(me,{className:"h-4 w-4"})})]})})]},s.pet_id),b===s.pet_id&&e.jsx(C,{children:e.jsx(n,{colSpan:8,className:"bg-muted/50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 py-4 px-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Pet Details"}),e.jsxs("dl",{className:"space-y-1 text-sm",children:[s.breed&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-muted-foreground inline",children:"Breed: "}),e.jsx("dd",{className:"inline",children:s.breed}),e.jsx("br",{})]}),s.color&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-muted-foreground inline",children:"Color: "}),e.jsx("dd",{className:"inline",children:s.color}),e.jsx("br",{})]}),s.weight&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-muted-foreground inline",children:"Weight: "}),e.jsxs("dd",{className:"inline",children:[s.weight," lbs"]}),e.jsx("br",{})]}),s.birthdate&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-muted-foreground inline",children:"Birthdate: "}),e.jsx("dd",{className:"inline",children:S(new Date(s.birthdate),"MMM d, yyyy")}),e.jsx("br",{})]}),s.microchip_id&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-muted-foreground inline",children:"Microchip: "}),e.jsx("dd",{className:"inline font-mono",children:s.microchip_id}),e.jsx("br",{})]}),e.jsx("dt",{className:"text-muted-foreground inline",children:"Environment: "}),e.jsxs("dd",{className:"inline flex items-center gap-1",children:[H(s.environment),e.jsx("span",{className:"capitalize",children:s.environment.replace("_"," ")})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Additional Info"}),e.jsxs("dl",{className:"space-y-1 text-sm",children:[s.description&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-muted-foreground",children:"Description:"}),e.jsx("dd",{className:"mb-2",children:s.description})]}),s.notes&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-muted-foreground",children:"Notes:"}),e.jsx("dd",{className:"mb-2",children:s.notes})]}),s.vaccinations?.rabies&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-muted-foreground inline",children:"Rabies Vaccination: "}),e.jsxs("dd",{className:"inline",children:["Yes",s.vaccinations.rabiesExpires&&` (expires ${S(new Date(s.vaccinations.rabiesExpires),"MMM d, yyyy")})`]})]})]})]})]})})})]}))})]})})})]}),g&&e.jsx(ae,{pet:g,open:!!g,onOpenChange:s=>!s&&F(null),ownerId:g.owner_id})]}):e.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-10",children:e.jsx(t,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[e.jsx(ce,{className:"h-5 w-5"}),e.jsx("p",{children:"You don't have permission to view this page. (Admins/Owners only)"})]})})})})}export{Je as default};
