import{c as W,u as Le,j as e,s as I,r as i,a as ut,D as Ce,b as Yt,T as Xt}from"./index-D0W7q_7F.js";import{u as Ve}from"./useQuery-BXCE_1Zp.js";import{u as De}from"./useMutation-B-SqnT_K.js";import{u as pt}from"./useProfile-04-DTauO.js";import{C as ie,a as le,b as ce,c as Me,d as te}from"./card-Bc7eUURN.js";import{B as Z}from"./badge-CDxnUr7a.js";import{T as Jt,a as Zt,b as _e,c as ke}from"./tabs-BjESpUKL.js";import{B as $}from"./button-zkU1qkGu.js";import{S as G}from"./skeleton-BPR3q0Jg.js";import{A as ht,a as ft,b as xt,c as gt,d as vt,e as bt,f as jt,g as yt,T as wt}from"./alert-dialog-BKuro55_.js";import{S as Ie,P as Ye,a as es}from"./switch-5zD424s_.js";import{L as z,I as Q}from"./input-BCKOSWcm.js";import{A as Oe,a as Fe}from"./alert-xCkTbqkw.js";import{l as ts,M as Se,C as ss,E as rs}from"./analytics-C_Ch6mVj.js";import{T as as,a as ns,b as Nt,c as Xe,d as os,e as Je,R as Ct,f as is,S as ls,H as cs,Q as ds}from"./format-Dy_csP1z.js";import{T as Be}from"./triangle-alert-C4aYkOOu.js";import{M as ms}from"./message-square-BppwbG9R.js";import{P as us}from"./phone-DEZn4YMw.js";import{E as _t}from"./eye-DEKFakkm.js";import{c as K,a as Y}from"./createLucideIcon-YUNKGbtX.js";import{u as ps,a as hs,o as Ze,_ as et,s as U,b as fs,c as xs,n as gs,d as vs,e as bs}from"./zod-DmvL0Aou.js";import{D as js,a as ys,b as ws,c as Ns,d as Cs,e as _s}from"./dialog-DVa5l9x4.js";import{T as ks}from"./textarea-OeCiUUku.js";import{S as tt,a as st,b as rt,c as at,d as ae}from"./select-ByIndHiI.js";import{u as Ss,c as Ps,a as se,b as he}from"./index-Dh20Ov_T.js";import{u as kt,c as Es,a as fe}from"./index-evFw_6fT.js";import{P as Rs,h as Ts,R as As,u as Ds,F as Ms,D as Is}from"./index-BizdK3DN.js";import{c as St,R as Os,A as Pt,C as Fs,a as Bs}from"./index-D5iRRVG3.js";import{P as Et}from"./index-Cy_ilBqL.js";import{P as H}from"./index-D8j6CDy2.js";import{R as $s,P as qs,O as zs,C as Ls}from"./index-CHt30Jrt.js";import{S as Pe}from"./separator-DOapot60.js";import{X as Vs}from"./x-D8HKcuEB.js";import{P as ee}from"./paw-print-DG83h3DZ.js";import{C as be}from"./circle-alert-BCiABaJe.js";import{F as Ks}from"./file-text-CdPYcdob.js";import{C as Ws}from"./check-BrjXxH2D.js";import{g as Us}from"./billing-X1lU7Ov_.js";import{S as Hs}from"./shield-check-BAaVWLM_.js";import{Q as Qs}from"./qr-code-ZBYM1oJo.js";import"./index-Ci8M6J5h.js";import"./index-DpEVKMG7.js";import"./index-DuOWaFuV.js";import"./qr-Dv_Hb54F.js";import"./chevron-down-DiVdaDii.js";import"./chevron-up-DU79MXN-.js";const Gs=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],nt=K("activity",Gs);const Ys=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Xs=K("archive",Ys);const Js=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Zs=K("calendar",Js);const er=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],tr=K("camera",er);const sr=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],rr=K("chevrons-up-down",sr);const ar=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],nr=K("image",ar);const or=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ee=K("plus",or);const ir=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],lr=K("shield-alert",ir);const cr=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],dr=K("square-pen",cr);const mr=[["path",{d:"m18 2 4 4",key:"22kx64"}],["path",{d:"m17 7 3-3",key:"1w1zoj"}],["path",{d:"M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5",key:"1exhtz"}],["path",{d:"m9 11 4 4",key:"rovt3i"}],["path",{d:"m5 19-3 3",key:"59f2uf"}],["path",{d:"m14 4 6 6",key:"yqp9t2"}]],ur=K("syringe",mr);const pr=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],hr=K("upload",pr);const fr=[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]],xr=K("weight",fr);function gr(s){const t=W.c(18),{days:r}=s,a=r===void 0?14:r,{user:n}=Le(),o=n?.id??null;let l,d;t[0]!==a||t[1]!==o?(l=["scan_events",o,a],d=()=>o?ts(o,a):Promise.resolve([]),t[0]=a,t[1]=o,t[2]=l,t[3]=d):(l=t[2],d=t[3]);const h=!!o;let c;t[4]!==l||t[5]!==d||t[6]!==h?(c={queryKey:l,queryFn:d,enabled:h,staleTime:3e4},t[4]=l,t[5]=d,t[6]=h,t[7]=c):c=t[7];const{data:p,isLoading:x,isError:v}=Ve(c);let j;t[8]===Symbol.for("react.memo_cache_sentinel")?(j=e.jsx(le,{children:"QR Scan Events"}),t[8]=j):j=t[8];let y;t[9]!==a?(y=e.jsxs(ce,{children:[j,e.jsxs(Me,{children:["Last ",a," days"]})]}),t[9]=a,t[10]=y):y=t[10];let w;t[11]!==p||t[12]!==v||t[13]!==x?(w=e.jsx(ie,{children:x?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):v?e.jsx("div",{className:"text-sm text-destructive",children:"Failed to load scans."}):p?.length?e.jsxs(as,{children:[e.jsx(ns,{children:e.jsxs(Nt,{children:[e.jsx(Xe,{children:"When"}),e.jsx(Xe,{children:"Pet"})]})}),e.jsx(os,{children:p.map(vr)})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No scans yet."})}),t[11]=p,t[12]=v,t[13]=x,t[14]=w):w=t[14];let k;return t[15]!==y||t[16]!==w?(k=e.jsxs(te,{children:[y,w]}),t[15]=y,t[16]=w,t[17]=k):k=t[17],k}function vr(s){return e.jsxs(Nt,{children:[e.jsx(Je,{className:"whitespace-nowrap",children:new Date(s.scanned_at).toLocaleString()}),e.jsx(Je,{className:"font-medium",children:s.pet_name})]},s.id)}async function br(s){const t=s.species==="dog"?"dog":"cat",{data:r,error:a}=await I.rpc("reserve_qr_code",{p_tag_type:t});if(a||!r||r.length===0)throw new Error(`No available ${t} QR codes in pool. Please contact support.`);const n=r[0];try{const{data:o,error:l}=await I.from("pets").insert({...s,qr_code_id:n.qr_id,short_id:n.qr_short_id,qr_url:n.qr_qr_url}).select("*").single();if(l)throw l;const{error:d}=await I.rpc("finalize_qr_assignment",{p_qr_id:n.qr_id,p_pet_id:o.id});return d&&console.error("Failed to finalize QR assignment:",d),o}catch(o){throw await I.rpc("release_qr_code",{p_qr_id:n.qr_id}),o}}async function $e(s,t){const{error:r}=await I.from("pets").update(t).eq("id",s);if(r)throw r;const{data:a,error:n}=await I.from("pets").select("*").eq("id",s).maybeSingle();return n?(console.warn("updatePet: select after update blocked by RLS:",n?.message),{id:s,...t}):a??{id:s,...t}}async function jr(s){const{data:t,error:r}=await I.from("pets").select("*").eq("owner_id",s).order("created_at",{ascending:!1});if(r)throw r;return t??[]}async function ot(s,t,r){if(!r||r.size===0)throw new Error("Empty image blob");const a=r.type||"image/webp",n=a==="image/jpeg"||a==="image/jpg"?"jpg":a==="image/png"?"png":a==="image/avif"?"avif":"webp",o=Date.now(),l=`${s}/${t}-${o}.${n}`,{error:d}=await I.storage.from("pet-photos").upload(l,r,{contentType:a,upsert:!1});if(d)throw console.error("storage.upload error:",d),d;const{data:h}=I.storage.from("pet-photos").getPublicUrl(l);return h.publicUrl}async function yr(s){const{error:t}=await I.from("pets").delete().eq("id",s);if(t)throw t}async function wr(s){if(!s)return;const t=s.indexOf("/pet-photos/");if(t===-1)return;const r=s.substring(t+12);if(!r)return;const{error:a}=await I.storage.from("pet-photos").remove([r]);a&&console.warn("storage.remove warning:",a.message)}function Nr({pet:s,open:t,onOpenChange:r,onDeleted:a}){const[n,o]=i.useState(!1),l=async()=>{if(s){o(!0);try{s.photo_url&&await wr(s.photo_url),await yr(s.id),a(),r(!1)}catch(d){alert(d?.message??"Failed to delete pet")}finally{o(!1)}}};return s?e.jsx(ht,{open:t,onOpenChange:r,children:e.jsxs(ft,{children:[e.jsxs(xt,{children:[e.jsxs(gt,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-destructive"}),"Delete ",s.name,"?"]}),e.jsxs(vt,{children:["This will permanently remove the pet profile",s.photo_url?" and its photo":"",". This action cannot be undone."]})]}),e.jsxs(bt,{children:[e.jsx(jt,{disabled:n,children:"Cancel"}),e.jsx(yt,{disabled:n,onClick:l,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"h-4 w-4 animate-spin"}),"Deletingâ€¦"]}):e.jsxs(e.Fragment,{children:[e.jsx(wt,{className:"h-4 w-4"}),"Delete"]})})]})]})}):null}function Cr(){const s=W.c(34),t=ut();let r;s[0]===Symbol.for("react.memo_cache_sentinel")?(r={queryKey:["location-shares"],queryFn:Rr},s[0]=r):r=s[0];const{data:a,isLoading:n}=Ve(r);let o;s[1]!==t?(o={mutationFn:Er,onSuccess:()=>{t.invalidateQueries({queryKey:["location-shares"]})}},s[1]=t,s[2]=o):o=s[2];const l=De(o);let d;s[3]!==t?(d={mutationFn:Pr,onSuccess:()=>{t.invalidateQueries({queryKey:["location-shares"]})}},s[3]=t,s[4]=d):d=s[4];const h=De(d),c=Sr;if(n){let T;s[5]===Symbol.for("react.memo_cache_sentinel")?(T=e.jsx(ce,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Location Shares"]})}),s[5]=T):T=s[5];let E;return s[6]===Symbol.for("react.memo_cache_sentinel")?(E=e.jsxs(te,{children:[T,e.jsxs(ie,{className:"space-y-3",children:[e.jsx(G,{className:"h-24 w-full"}),e.jsx(G,{className:"h-24 w-full"})]})]}),s[6]=E):E=s[6],E}let p,x,v,j,y,w;if(s[7]!==h||s[8]!==l||s[9]!==a){w=Symbol.for("react.early_return_sentinel");e:{const T=a?.filter(kr)||[],E=T.filter(_r).length;if(T.length===0){let m;s[16]===Symbol.for("react.memo_cache_sentinel")?(m=e.jsx(ce,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Location Shares"]})}),s[16]=m):m=s[16];let q;s[17]===Symbol.for("react.memo_cache_sentinel")?(q=e.jsxs(te,{children:[m,e.jsx(ie,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No location shares yet. When someone finds your pet and shares their location, it will appear here."})})]}),s[17]=q):q=s[17],w=q;break e}x=te;let N;s[18]===Symbol.for("react.memo_cache_sentinel")?(N=e.jsx(Se,{className:"h-5 w-5"}),s[18]=N):N=s[18];let S;s[19]!==E?(S=E>0&&e.jsxs(Z,{variant:"destructive",className:"ml-auto",children:[E," New"]}),s[19]=E,s[20]=S):S=s[20],s[21]!==S?(y=e.jsx(ce,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[N,"Location Shares",S]})}),s[21]=S,s[22]=y):y=s[22],p=ie,v="space-y-4";let _;s[23]!==h||s[24]!==l?(_=m=>e.jsxs("div",{className:`border rounded-lg p-4 space-y-3 ${m.viewed_at?"border-border":"border-primary bg-primary/5"}`,children:[e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold",children:m.pet_name}),!m.viewed_at&&e.jsx(Z,{variant:"secondary",className:"text-xs",children:"New"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ss,{className:"h-3.5 w-3.5"}),is(new Date(m.shared_at),"MMM d, yyyy 'at' h:mm a")]}),m.accuracy&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Accuracy: Â±",Math.round(m.accuracy),"m"]})]})}),m.finder_note&&e.jsxs("div",{className:"bg-muted/50 rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(ms,{className:"h-3 w-3"}),"Message from finder"]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:m.finder_note})]}),m.finder_contact&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(us,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("a",{href:m.finder_contact.includes("@")?`mailto:${m.finder_contact}`:`tel:${m.finder_contact}`,className:"text-primary hover:underline",children:m.finder_contact})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs($,{size:"sm",onClick:()=>c(Number(m.latitude),Number(m.longitude)),className:"flex-1 gap-2",children:[e.jsx(rs,{className:"h-3.5 w-3.5"}),"Open in Maps"]}),!m.viewed_at&&e.jsx($,{size:"sm",variant:"outline",onClick:()=>l.mutate(m.id),disabled:l.isPending,children:e.jsx(_t,{className:"h-3.5 w-3.5"})}),e.jsx($,{size:"sm",variant:"ghost",onClick:()=>h.mutate(m.id),disabled:h.isPending,children:e.jsx(Xs,{className:"h-3.5 w-3.5"})})]})]},m.id),s[23]=h,s[24]=l,s[25]=_):_=s[25],j=T.map(_)}s[7]=h,s[8]=l,s[9]=a,s[10]=p,s[11]=x,s[12]=v,s[13]=j,s[14]=y,s[15]=w}else p=s[10],x=s[11],v=s[12],j=s[13],y=s[14],w=s[15];if(w!==Symbol.for("react.early_return_sentinel"))return w;let k;s[26]!==p||s[27]!==v||s[28]!==j?(k=e.jsx(p,{className:v,children:j}),s[26]=p,s[27]=v,s[28]=j,s[29]=k):k=s[29];let A;return s[30]!==x||s[31]!==y||s[32]!==k?(A=e.jsxs(x,{children:[y,k]}),s[30]=x,s[31]=y,s[32]=k,s[33]=A):A=s[33],A}function _r(s){return!s.viewed_at}function kr(s){return!s.archived_at}function Sr(s,t){const r=`https://www.google.com/maps/search/?api=1&query=${s},${t}`;window.open(r,"_blank")}async function Pr(s){const{error:t}=await I.from("location_shares").update({archived_at:new Date().toISOString()}).eq("id",s);if(t)throw t}async function Er(s){const{error:t}=await I.from("location_shares").update({viewed_at:new Date().toISOString()}).eq("id",s);if(t)throw t}async function Rr(){const{data:s}=await I.auth.getUser(),{user:t}=s;if(!t)return[];const{data:r,error:a}=await I.from("location_shares").select(`
          id,
          pet_id,
          latitude,
          longitude,
          accuracy,
          finder_note,
          finder_contact,
          shared_at,
          viewed_at,
          archived_at,
          pets!inner(name)
        `).eq("owner_id",t.id).is("archived_at",null).order("shared_at",{ascending:!1}).limit(10);if(a)throw a;return(r||[]).map(Tr)}function Tr(s){return{...s,pet_name:s.pets.name}}var je="Popover",[Rt]=Ps(je,[St]),xe=St(),[Ar,J]=Rt(je),Tt=s=>{const{__scopePopover:t,children:r,open:a,defaultOpen:n,onOpenChange:o,modal:l=!1}=s,d=xe(t),h=i.useRef(null),[c,p]=i.useState(!1),[x,v]=Ss({prop:a,defaultProp:n??!1,onChange:o,caller:je});return e.jsx(Os,{...d,children:e.jsx(Ar,{scope:t,contentId:se(),triggerRef:h,open:x,onOpenChange:v,onOpenToggle:i.useCallback(()=>v(j=>!j),[v]),hasCustomAnchor:c,onCustomAnchorAdd:i.useCallback(()=>p(!0),[]),onCustomAnchorRemove:i.useCallback(()=>p(!1),[]),modal:l,children:r})})};Tt.displayName=je;var At="PopoverAnchor",Dr=i.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=J(At,r),o=xe(r),{onCustomAnchorAdd:l,onCustomAnchorRemove:d}=n;return i.useEffect(()=>(l(),()=>d()),[l,d]),e.jsx(Pt,{...o,...a,ref:t})});Dr.displayName=At;var Dt="PopoverTrigger",Mt=i.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=J(Dt,r),o=xe(r),l=kt(t,n.triggerRef),d=e.jsx(H.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":$t(n.open),...a,ref:l,onClick:he(s.onClick,n.onOpenToggle)});return n.hasCustomAnchor?d:e.jsx(Pt,{asChild:!0,...o,children:d})});Mt.displayName=Dt;var Ke="PopoverPortal",[Mr,Ir]=Rt(Ke,{forceMount:void 0}),It=s=>{const{__scopePopover:t,forceMount:r,children:a,container:n}=s,o=J(Ke,t);return e.jsx(Mr,{scope:t,forceMount:r,children:e.jsx(Et,{present:r||o.open,children:e.jsx(Rs,{asChild:!0,container:n,children:a})})})};It.displayName=Ke;var de="PopoverContent",Ot=i.forwardRef((s,t)=>{const r=Ir(de,s.__scopePopover),{forceMount:a=r.forceMount,...n}=s,o=J(de,s.__scopePopover);return e.jsx(Et,{present:a||o.open,children:o.modal?e.jsx(Fr,{...n,ref:t}):e.jsx(Br,{...n,ref:t})})});Ot.displayName=de;var Or=Es("PopoverContent.RemoveScroll"),Fr=i.forwardRef((s,t)=>{const r=J(de,s.__scopePopover),a=i.useRef(null),n=kt(t,a),o=i.useRef(!1);return i.useEffect(()=>{const l=a.current;if(l)return Ts(l)},[]),e.jsx(As,{as:Or,allowPinchZoom:!0,children:e.jsx(Ft,{...s,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:he(s.onCloseAutoFocus,l=>{l.preventDefault(),o.current||r.triggerRef.current?.focus()}),onPointerDownOutside:he(s.onPointerDownOutside,l=>{const d=l.detail.originalEvent,h=d.button===0&&d.ctrlKey===!0,c=d.button===2||h;o.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:he(s.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1})})})}),Br=i.forwardRef((s,t)=>{const r=J(de,s.__scopePopover),a=i.useRef(!1),n=i.useRef(!1);return e.jsx(Ft,{...s,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{s.onCloseAutoFocus?.(o),o.defaultPrevented||(a.current||r.triggerRef.current?.focus(),o.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:o=>{s.onInteractOutside?.(o),o.defaultPrevented||(a.current=!0,o.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const l=o.target;r.triggerRef.current?.contains(l)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&n.current&&o.preventDefault()}})}),Ft=i.forwardRef((s,t)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:c,onInteractOutside:p,...x}=s,v=J(de,r),j=xe(r);return Ds(),e.jsx(Ms,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:o,children:e.jsx(Is,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:p,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:c,onDismiss:()=>v.onOpenChange(!1),children:e.jsx(Fs,{"data-state":$t(v.open),role:"dialog",id:v.contentId,...j,...x,ref:t,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Bt="PopoverClose",$r=i.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=J(Bt,r);return e.jsx(H.button,{type:"button",...a,ref:t,onClick:he(s.onClick,()=>n.onOpenChange(!1))})});$r.displayName=Bt;var qr="PopoverArrow",zr=i.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=xe(r);return e.jsx(Bs,{...n,...a,ref:t})});zr.displayName=qr;function $t(s){return s?"open":"closed"}var Lr=Tt,Vr=Mt,Kr=It,Wr=Ot;function Ur(s){const t=W.c(4);let r;t[0]!==s?({...r}=s,t[0]=s,t[1]=r):r=t[1];let a;return t[2]!==r?(a=e.jsx(Lr,{"data-slot":"popover",...r}),t[2]=r,t[3]=a):a=t[3],a}function Hr(s){const t=W.c(4);let r;t[0]!==s?({...r}=s,t[0]=s,t[1]=r):r=t[1];let a;return t[2]!==r?(a=e.jsx(Vr,{"data-slot":"popover-trigger",...r}),t[2]=r,t[3]=a):a=t[3],a}function Qr(s){const t=W.c(12);let r,a,n,o;t[0]!==s?({className:r,align:n,sideOffset:o,...a}=s,t[0]=s,t[1]=r,t[2]=a,t[3]=n,t[4]=o):(r=t[1],a=t[2],n=t[3],o=t[4]);const l=n===void 0?"center":n,d=o===void 0?4:o;let h;t[5]!==r?(h=Y("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",r),t[5]=r,t[6]=h):h=t[6];let c;return t[7]!==l||t[8]!==a||t[9]!==d||t[10]!==h?(c=e.jsx(Kr,{children:e.jsx(Wr,{"data-slot":"popover-content",align:l,sideOffset:d,className:h,...a})}),t[7]=l,t[8]=a,t[9]=d,t[10]=h,t[11]=c):c=t[11],c}var it=1,Gr=.9,Yr=.8,Xr=.17,Re=.1,Te=.999,Jr=.9999,Zr=.99,ea=/[\\\/_+.#"@\[\(\{&]/,ta=/[\\\/_+.#"@\[\(\{&]/g,sa=/[\s-]/,qt=/[\s-]/g;function qe(s,t,r,a,n,o,l){if(o===t.length)return n===s.length?it:Zr;var d=`${n},${o}`;if(l[d]!==void 0)return l[d];for(var h=a.charAt(o),c=r.indexOf(h,n),p=0,x,v,j,y;c>=0;)x=qe(s,t,r,a,c+1,o+1,l),x>p&&(c===n?x*=it:ea.test(s.charAt(c-1))?(x*=Yr,j=s.slice(n,c-1).match(ta),j&&n>0&&(x*=Math.pow(Te,j.length))):sa.test(s.charAt(c-1))?(x*=Gr,y=s.slice(n,c-1).match(qt),y&&n>0&&(x*=Math.pow(Te,y.length))):(x*=Xr,n>0&&(x*=Math.pow(Te,c-n))),s.charAt(c)!==t.charAt(o)&&(x*=Jr)),(x<Re&&r.charAt(c-1)===a.charAt(o+1)||a.charAt(o+1)===a.charAt(o)&&r.charAt(c-1)!==a.charAt(o))&&(v=qe(s,t,r,a,c+1,o+2,l),v*Re>x&&(x=v*Re)),x>p&&(p=x),c=r.indexOf(h,c+1);return l[d]=p,p}function lt(s){return s.toLowerCase().replace(qt," ")}function ra(s,t,r){return s=r&&r.length>0?`${s+" "+r.join(" ")}`:s,qe(s,t,lt(s),lt(t),0,0,{})}var pe='[cmdk-group=""]',Ae='[cmdk-group-items=""]',aa='[cmdk-group-heading=""]',zt='[cmdk-item=""]',ct=`${zt}:not([aria-disabled="true"])`,ze="cmdk-item-select",ne="data-value",na=(s,t,r)=>ra(s,t,r),Lt=i.createContext(void 0),ge=()=>i.useContext(Lt),Vt=i.createContext(void 0),We=()=>i.useContext(Vt),Kt=i.createContext(void 0),Wt=i.forwardRef((s,t)=>{let r=oe(()=>{var u,b;return{search:"",value:(b=(u=s.value)!=null?u:s.defaultValue)!=null?b:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),a=oe(()=>new Set),n=oe(()=>new Map),o=oe(()=>new Map),l=oe(()=>new Set),d=Ut(s),{label:h,children:c,value:p,onValueChange:x,filter:v,shouldFilter:j,loop:y,disablePointerSelection:w=!1,vimBindings:k=!0,...A}=s,T=se(),E=se(),N=se(),S=i.useRef(null),_=xa();re(()=>{if(p!==void 0){let u=p.trim();r.current.value=u,m.emit()}},[p]),re(()=>{_(6,M)},[]);let m=i.useMemo(()=>({subscribe:u=>(l.current.add(u),()=>l.current.delete(u)),snapshot:()=>r.current,setState:(u,b,C)=>{var g,P,R,L;if(!Object.is(r.current[u],b)){if(r.current[u]=b,u==="search")f(),O(),_(1,F);else if(u==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let B=document.getElementById(N);B?B.focus():(g=document.getElementById(T))==null||g.focus()}if(_(7,()=>{var B;r.current.selectedItemId=(B=V())==null?void 0:B.id,m.emit()}),C||_(5,M),((P=d.current)==null?void 0:P.value)!==void 0){let B=b??"";(L=(R=d.current).onValueChange)==null||L.call(R,B);return}}m.emit()}},emit:()=>{l.current.forEach(u=>u())}}),[]),q=i.useMemo(()=>({value:(u,b,C)=>{var g;b!==((g=o.current.get(u))==null?void 0:g.value)&&(o.current.set(u,{value:b,keywords:C}),r.current.filtered.items.set(u,D(b,C)),_(2,()=>{O(),m.emit()}))},item:(u,b)=>(a.current.add(u),b&&(n.current.has(b)?n.current.get(b).add(u):n.current.set(b,new Set([u]))),_(3,()=>{f(),O(),r.current.value||F(),m.emit()}),()=>{o.current.delete(u),a.current.delete(u),r.current.filtered.items.delete(u);let C=V();_(4,()=>{f(),C?.getAttribute("id")===u&&F(),m.emit()})}),group:u=>(n.current.has(u)||n.current.set(u,new Set),()=>{o.current.delete(u),n.current.delete(u)}),filter:()=>d.current.shouldFilter,label:h||s["aria-label"],getDisablePointerSelection:()=>d.current.disablePointerSelection,listId:T,inputId:N,labelId:E,listInnerRef:S}),[]);function D(u,b){var C,g;let P=(g=(C=d.current)==null?void 0:C.filter)!=null?g:na;return u?P(u,r.current.search,b):0}function O(){if(!r.current.search||d.current.shouldFilter===!1)return;let u=r.current.filtered.items,b=[];r.current.filtered.groups.forEach(g=>{let P=n.current.get(g),R=0;P.forEach(L=>{let B=u.get(L);R=Math.max(B,R)}),b.push([g,R])});let C=S.current;ue().sort((g,P)=>{var R,L;let B=g.getAttribute("id"),ve=P.getAttribute("id");return((R=u.get(ve))!=null?R:0)-((L=u.get(B))!=null?L:0)}).forEach(g=>{let P=g.closest(Ae);P?P.appendChild(g.parentElement===P?g:g.closest(`${Ae} > *`)):C.appendChild(g.parentElement===C?g:g.closest(`${Ae} > *`))}),b.sort((g,P)=>P[1]-g[1]).forEach(g=>{var P;let R=(P=S.current)==null?void 0:P.querySelector(`${pe}[${ne}="${encodeURIComponent(g[0])}"]`);R?.parentElement.appendChild(R)})}function F(){let u=ue().find(C=>C.getAttribute("aria-disabled")!=="true"),b=u?.getAttribute(ne);m.setState("value",b||void 0)}function f(){var u,b,C,g;if(!r.current.search||d.current.shouldFilter===!1){r.current.filtered.count=a.current.size;return}r.current.filtered.groups=new Set;let P=0;for(let R of a.current){let L=(b=(u=o.current.get(R))==null?void 0:u.value)!=null?b:"",B=(g=(C=o.current.get(R))==null?void 0:C.keywords)!=null?g:[],ve=D(L,B);r.current.filtered.items.set(R,ve),ve>0&&P++}for(let[R,L]of n.current)for(let B of L)if(r.current.filtered.items.get(B)>0){r.current.filtered.groups.add(R);break}r.current.filtered.count=P}function M(){var u,b,C;let g=V();g&&(((u=g.parentElement)==null?void 0:u.firstChild)===g&&((C=(b=g.closest(pe))==null?void 0:b.querySelector(aa))==null||C.scrollIntoView({block:"nearest"})),g.scrollIntoView({block:"nearest"}))}function V(){var u;return(u=S.current)==null?void 0:u.querySelector(`${zt}[aria-selected="true"]`)}function ue(){var u;return Array.from(((u=S.current)==null?void 0:u.querySelectorAll(ct))||[])}function we(u){let b=ue()[u];b&&m.setState("value",b.getAttribute(ne))}function Ne(u){var b;let C=V(),g=ue(),P=g.findIndex(L=>L===C),R=g[P+u];(b=d.current)!=null&&b.loop&&(R=P+u<0?g[g.length-1]:P+u===g.length?g[0]:g[P+u]),R&&m.setState("value",R.getAttribute(ne))}function Ue(u){let b=V(),C=b?.closest(pe),g;for(;C&&!g;)C=u>0?ha(C,pe):fa(C,pe),g=C?.querySelector(ct);g?m.setState("value",g.getAttribute(ne)):Ne(u)}let He=()=>we(ue().length-1),Qe=u=>{u.preventDefault(),u.metaKey?He():u.altKey?Ue(1):Ne(1)},Ge=u=>{u.preventDefault(),u.metaKey?we(0):u.altKey?Ue(-1):Ne(-1)};return i.createElement(H.div,{ref:t,tabIndex:-1,...A,"cmdk-root":"",onKeyDown:u=>{var b;(b=A.onKeyDown)==null||b.call(A,u);let C=u.nativeEvent.isComposing||u.keyCode===229;if(!(u.defaultPrevented||C))switch(u.key){case"n":case"j":{k&&u.ctrlKey&&Qe(u);break}case"ArrowDown":{Qe(u);break}case"p":case"k":{k&&u.ctrlKey&&Ge(u);break}case"ArrowUp":{Ge(u);break}case"Home":{u.preventDefault(),we(0);break}case"End":{u.preventDefault(),He();break}case"Enter":{u.preventDefault();let g=V();if(g){let P=new Event(ze);g.dispatchEvent(P)}}}}},i.createElement("label",{"cmdk-label":"",htmlFor:q.inputId,id:q.labelId,style:va},h),ye(s,u=>i.createElement(Vt.Provider,{value:m},i.createElement(Lt.Provider,{value:q},u))))}),oa=i.forwardRef((s,t)=>{var r,a;let n=se(),o=i.useRef(null),l=i.useContext(Kt),d=ge(),h=Ut(s),c=(a=(r=h.current)==null?void 0:r.forceMount)!=null?a:l?.forceMount;re(()=>{if(!c)return d.item(n,l?.id)},[c]);let p=Ht(n,o,[s.value,s.children,o],s.keywords),x=We(),v=X(_=>_.value&&_.value===p.current),j=X(_=>c||d.filter()===!1?!0:_.search?_.filtered.items.get(n)>0:!0);i.useEffect(()=>{let _=o.current;if(!(!_||s.disabled))return _.addEventListener(ze,y),()=>_.removeEventListener(ze,y)},[j,s.onSelect,s.disabled]);function y(){var _,m;w(),(m=(_=h.current).onSelect)==null||m.call(_,p.current)}function w(){x.setState("value",p.current,!0)}if(!j)return null;let{disabled:k,value:A,onSelect:T,forceMount:E,keywords:N,...S}=s;return i.createElement(H.div,{ref:fe(o,t),...S,id:n,"cmdk-item":"",role:"option","aria-disabled":!!k,"aria-selected":!!v,"data-disabled":!!k,"data-selected":!!v,onPointerMove:k||d.getDisablePointerSelection()?void 0:w,onClick:k?void 0:y},s.children)}),ia=i.forwardRef((s,t)=>{let{heading:r,children:a,forceMount:n,...o}=s,l=se(),d=i.useRef(null),h=i.useRef(null),c=se(),p=ge(),x=X(j=>n||p.filter()===!1?!0:j.search?j.filtered.groups.has(l):!0);re(()=>p.group(l),[]),Ht(l,d,[s.value,s.heading,h]);let v=i.useMemo(()=>({id:l,forceMount:n}),[n]);return i.createElement(H.div,{ref:fe(d,t),...o,"cmdk-group":"",role:"presentation",hidden:x?void 0:!0},r&&i.createElement("div",{ref:h,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),ye(s,j=>i.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},i.createElement(Kt.Provider,{value:v},j))))}),la=i.forwardRef((s,t)=>{let{alwaysRender:r,...a}=s,n=i.useRef(null),o=X(l=>!l.search);return!r&&!o?null:i.createElement(H.div,{ref:fe(n,t),...a,"cmdk-separator":"",role:"separator"})}),ca=i.forwardRef((s,t)=>{let{onValueChange:r,...a}=s,n=s.value!=null,o=We(),l=X(c=>c.search),d=X(c=>c.selectedItemId),h=ge();return i.useEffect(()=>{s.value!=null&&o.setState("search",s.value)},[s.value]),i.createElement(H.input,{ref:t,...a,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":h.listId,"aria-labelledby":h.labelId,"aria-activedescendant":d,id:h.inputId,type:"text",value:n?s.value:l,onChange:c=>{n||o.setState("search",c.target.value),r?.(c.target.value)}})}),da=i.forwardRef((s,t)=>{let{children:r,label:a="Suggestions",...n}=s,o=i.useRef(null),l=i.useRef(null),d=X(c=>c.selectedItemId),h=ge();return i.useEffect(()=>{if(l.current&&o.current){let c=l.current,p=o.current,x,v=new ResizeObserver(()=>{x=requestAnimationFrame(()=>{let j=c.offsetHeight;p.style.setProperty("--cmdk-list-height",j.toFixed(1)+"px")})});return v.observe(c),()=>{cancelAnimationFrame(x),v.unobserve(c)}}},[]),i.createElement(H.div,{ref:fe(o,t),...n,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":d,"aria-label":a,id:h.listId},ye(s,c=>i.createElement("div",{ref:fe(l,h.listInnerRef),"cmdk-list-sizer":""},c)))}),ma=i.forwardRef((s,t)=>{let{open:r,onOpenChange:a,overlayClassName:n,contentClassName:o,container:l,...d}=s;return i.createElement($s,{open:r,onOpenChange:a},i.createElement(qs,{container:l},i.createElement(zs,{"cmdk-overlay":"",className:n}),i.createElement(Ls,{"aria-label":s.label,"cmdk-dialog":"",className:o},i.createElement(Wt,{ref:t,...d}))))}),ua=i.forwardRef((s,t)=>X(r=>r.filtered.count===0)?i.createElement(H.div,{ref:t,...s,"cmdk-empty":"",role:"presentation"}):null),pa=i.forwardRef((s,t)=>{let{progress:r,children:a,label:n="Loading...",...o}=s;return i.createElement(H.div,{ref:t,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":n},ye(s,l=>i.createElement("div",{"aria-hidden":!0},l)))}),me=Object.assign(Wt,{List:da,Item:oa,Input:ca,Group:ia,Separator:la,Dialog:ma,Empty:ua,Loading:pa});function ha(s,t){let r=s.nextElementSibling;for(;r;){if(r.matches(t))return r;r=r.nextElementSibling}}function fa(s,t){let r=s.previousElementSibling;for(;r;){if(r.matches(t))return r;r=r.previousElementSibling}}function Ut(s){let t=i.useRef(s);return re(()=>{t.current=s}),t}var re=typeof window>"u"?i.useEffect:i.useLayoutEffect;function oe(s){let t=i.useRef();return t.current===void 0&&(t.current=s()),t}function X(s){let t=We(),r=()=>s(t.snapshot());return i.useSyncExternalStore(t.subscribe,r,r)}function Ht(s,t,r,a=[]){let n=i.useRef(),o=ge();return re(()=>{var l;let d=(()=>{var c;for(let p of r){if(typeof p=="string")return p.trim();if(typeof p=="object"&&"current"in p)return p.current?(c=p.current.textContent)==null?void 0:c.trim():n.current}})(),h=a.map(c=>c.trim());o.value(s,d,h),(l=t.current)==null||l.setAttribute(ne,d),n.current=d}),n}var xa=()=>{let[s,t]=i.useState(),r=oe(()=>new Map);return re(()=>{r.current.forEach(a=>a()),r.current=new Map},[s]),(a,n)=>{r.current.set(a,n),t({})}};function ga(s){let t=s.type;return typeof t=="function"?t(s.props):"render"in t?t.render(s.props):s}function ye({asChild:s,children:t},r){return s&&i.isValidElement(t)?i.cloneElement(ga(t),{ref:t.ref},r(t.props.children)):r(t)}var va={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};function ba(s){const t=W.c(8);let r,a;t[0]!==s?({className:r,...a}=s,t[0]=s,t[1]=r,t[2]=a):(r=t[1],a=t[2]);let n;t[3]!==r?(n=Y("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",r),t[3]=r,t[4]=n):n=t[4];let o;return t[5]!==a||t[6]!==n?(o=e.jsx(me,{"data-slot":"command",className:n,...a}),t[5]=a,t[6]=n,t[7]=o):o=t[7],o}function ja(s){const t=W.c(9);let r,a;t[0]!==s?({className:r,...a}=s,t[0]=s,t[1]=r,t[2]=a):(r=t[1],a=t[2]);let n;t[3]===Symbol.for("react.memo_cache_sentinel")?(n=e.jsx(ls,{className:"size-4 shrink-0 opacity-50"}),t[3]=n):n=t[3];let o;t[4]!==r?(o=Y("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",r),t[4]=r,t[5]=o):o=t[5];let l;return t[6]!==a||t[7]!==o?(l=e.jsxs("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[n,e.jsx(me.Input,{"data-slot":"command-input",className:o,...a})]}),t[6]=a,t[7]=o,t[8]=l):l=t[8],l}function ya(s){const t=W.c(8);let r,a;t[0]!==s?({className:r,...a}=s,t[0]=s,t[1]=r,t[2]=a):(r=t[1],a=t[2]);let n;t[3]!==r?(n=Y("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",r),t[3]=r,t[4]=n):n=t[4];let o;return t[5]!==a||t[6]!==n?(o=e.jsx(me.List,{"data-slot":"command-list",className:n,...a}),t[5]=a,t[6]=n,t[7]=o):o=t[7],o}function wa(s){const t=W.c(4);let r;t[0]!==s?({...r}=s,t[0]=s,t[1]=r):r=t[1];let a;return t[2]!==r?(a=e.jsx(me.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...r}),t[2]=r,t[3]=a):a=t[3],a}function Na(s){const t=W.c(8);let r,a;t[0]!==s?({className:r,...a}=s,t[0]=s,t[1]=r,t[2]=a):(r=t[1],a=t[2]);let n;t[3]!==r?(n=Y("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",r),t[3]=r,t[4]=n):n=t[4];let o;return t[5]!==a||t[6]!==n?(o=e.jsx(me.Group,{"data-slot":"command-group",className:n,...a}),t[5]=a,t[6]=n,t[7]=o):o=t[7],o}function Ca(s){const t=W.c(8);let r,a;t[0]!==s?({className:r,...a}=s,t[0]=s,t[1]=r,t[2]=a):(r=t[1],a=t[2]);let n;t[3]!==r?(n=Y("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",r),t[3]=r,t[4]=n):n=t[4];let o;return t[5]!==a||t[6]!==n?(o=e.jsx(me.Item,{"data-slot":"command-item",className:n,...a}),t[5]=a,t[6]=n,t[7]=o):o=t[7],o}const Qt=[{name:"Golden Retriever",defaultColors:["Golden"]},{name:"Labrador Retriever",defaultColors:["Yellow","Black","Chocolate"]},{name:"German Shepherd",defaultColors:["Black/Tan","Sable","Black"]},{name:"French Bulldog",defaultColors:["Fawn","Brindle","Cream","Pied"]},{name:"Poodle",defaultColors:["White","Black","Apricot","Red"]},{name:"Bulldog",defaultColors:["Fawn","Brindle","White","Piebald"]},{name:"Beagle",defaultColors:["Tri-color","Lemon/White","Red/White"]},{name:"Rottweiler",defaultColors:["Black/Rust"]},{name:"Dachshund",defaultColors:["Red","Black/Tan","Chocolate/Tan","Dapple"]},{name:"Yorkshire Terrier",defaultColors:["Blue/Tan"]}],Gt=[{name:"Bicolor / Tuxedo",defaultColors:["Black/White","Gray/White","Seal/White"]},{name:"Calico",defaultColors:["Black/Orange/White","Dilute (Blue/Cream/White)"]},{name:"Pointed",defaultColors:["Seal point","Blue point","Chocolate point","Lilac point","Flame point"]},{name:"Shaded",defaultColors:["Shaded Silver","Shaded Golden"]},{name:"Smoke",defaultColors:["Black Smoke","Blue Smoke"]},{name:"Solid",defaultColors:["Black","White","Blue/Gray","Red/Orange","Cream"]},{name:"Spotted",defaultColors:["Brown Spotted","Silver Spotted"]},{name:"Tabby",defaultColors:["Brown Tabby","Gray/Blue Tabby","Orange Tabby","Silver Tabby","Torbie"]},{name:"Tortoiseshell (Tortie)",defaultColors:["Black/Orange","Chocolate/Cream","Dilute (Blue/Cream)"]}];function _a(s,t){return!s||!t?[]:s==="dog"?Qt.find(a=>a.name===t)?.defaultColors??[]:s==="cat"?Gt.find(a=>a.name===t)?.defaultColors??[]:[]}const ka=Qt.map(s=>s.name),Sa=Gt.map(s=>s.name);function Pa({label:s="Photo",value:t,onChange:r,options:a,accept:n="image/*",className:o}){const l=i.useRef(null),[d,h]=i.useState(!1),[c,p]=i.useState(!1),[x,v]=i.useState(null),j=i.useCallback(()=>{l.current?.click()},[]),y=i.useCallback(()=>{r(null),v(null)},[r]),w=i.useCallback(async N=>{if(!N||!N.type.startsWith("image/")){v("Please select a valid image file");return}if(N.size>10*1024*1024){v("File size must be less than 10MB");return}v(null),h(!0);try{const S=await Ea(N,a);r(S)}catch(S){v("Failed to optimize image. Please try another file."),console.error("Image optimization error:",S)}finally{h(!1)}},[a,r]),k=i.useCallback(N=>{N.preventDefault(),N.stopPropagation(),p(!0)},[]),A=i.useCallback(N=>{N.preventDefault(),N.stopPropagation(),p(!1)},[]),T=i.useCallback(N=>{N.preventDefault(),N.stopPropagation(),p(!1);const S=N.dataTransfer.files?.[0];S&&w(S)},[w]),E=t?Math.round((1-t.approxKB/t.original.sizeKB)*100):0;return e.jsxs("div",{className:o,children:[e.jsx(z,{className:"mb-2 block font-medium",children:s}),t?e.jsx("div",{className:"border rounded-lg p-4 bg-card",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.dataUrl,alt:"preview",className:"h-32 w-32 rounded-lg object-cover border-2 border-border"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx(nr,{className:"h-8 w-8 text-white"})})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.original.name}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.width," Ã— ",t.height,"px"]})]}),e.jsx($,{type:"button",variant:"ghost",size:"sm",onClick:y,className:"h-8 w-8 p-0",children:e.jsx(Vs,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Original"}),e.jsxs("p",{className:"font-medium",children:[t.original.sizeKB.toLocaleString()," KB"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Optimized"}),e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[t.approxKB.toLocaleString()," KB"]})]})]}),E>0&&e.jsx("div",{className:"bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-900 rounded-md px-3 py-2",children:e.jsxs("p",{className:"text-xs text-green-700 dark:text-green-300 font-medium",children:["â†“ ",E,"% smaller Â· ",t.mimeType]})}),e.jsx($,{type:"button",variant:"outline",size:"sm",onClick:j,className:"w-full",children:"Replace Image"})]})]})}):e.jsx("div",{onDragOver:k,onDragLeave:A,onDrop:T,onClick:j,className:`
            relative border-2 border-dashed rounded-lg p-8 transition-all cursor-pointer
            hover:border-primary/50 hover:bg-accent/50
            ${c?"border-primary bg-accent scale-[1.02]":"border-border"}
            ${d?"pointer-events-none opacity-60":""}
          `,children:e.jsx("div",{className:"flex flex-col items-center justify-center text-center space-y-3",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"}),e.jsx("p",{className:"text-sm font-medium",children:"Optimizing image..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-3",children:e.jsx(hr,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Drop your image here, or click to browse"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG, WebP up to 10MB"})]})]})})}),x&&e.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-900 rounded-md px-3 py-2",children:x}),e.jsx(Q,{ref:l,type:"file",accept:n,className:"hidden",onChange:N=>{const S=N.target.files?.[0];S&&w(S),N.currentTarget.value=""}})]})}async function Ea(s,t){const r=await s.arrayBuffer(),a=new Blob([r]),n=await Ta(a),o=t?.maxWidth??1200,l=t?.maxHeight??1200,{width:d,height:h}=Ra(n.width,n.height,o,l),c=document.createElement("canvas");c.width=d,c.height=h;const p=c.getContext("2d",{alpha:!0});p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.drawImage(n,0,0,d,h);const x=t?.preferWebP??!0,v=t?.quality??.82,j=c.toDataURL("image/webp").startsWith("data:image/webp"),y=x&&j?"image/webp":"image/jpeg",w=await Aa(c,y,v),k=await Da(w);return{blob:w,dataUrl:k,width:d,height:h,approxKB:Math.round(w.size/1024),mimeType:y,original:{name:s.name,sizeKB:Math.round(s.size/1024),type:s.type}}}function Ra(s,t,r,a){const n=Math.min(r/s,a/t,1);return{width:Math.round(s*n),height:Math.round(t*n)}}function Ta(s){return new Promise((t,r)=>{const a=URL.createObjectURL(s),n=new Image;n.onload=()=>{URL.revokeObjectURL(a),t(n)},n.onerror=()=>{URL.revokeObjectURL(a),r(new Error("Failed to load image"))},n.src=a})}function Aa(s,t,r){return new Promise((a,n)=>{s.toBlob(o=>{o?a(o):n(new Error("Canvas to blob conversion failed"))},t,r)})}function Da(s){return new Promise((t,r)=>{const a=new FileReader;a.onload=()=>t(String(a.result)),a.onerror=()=>r(new Error("Failed to read blob")),a.readAsDataURL(s)})}function Ma(s){const[t,r]=i.useState(Ce),[a,n]=i.useState(!0);return i.useEffect(()=>{if(!s){n(!1);return}(async()=>{try{const{data:h,error:c}=await I.from("pet_themes").select("theme_preset, custom_colors, background_image_url").eq("pet_id",s).maybeSingle();if(c)throw c;r(h?h.theme_preset:Ce)}catch(h){console.error("Failed to load pet theme:",h),r(Ce)}finally{n(!1)}})()},[s]),{themeId:t,isLoading:a,updatePetTheme:async d=>{if(s){r(d);try{const{error:h}=await I.from("pet_themes").upsert({pet_id:s,theme_preset:d,updated_at:new Date().toISOString()});if(h)throw h}catch(h){console.error("Failed to save pet theme:",h)}}},applyPetTheme:(d=!1)=>{Yt(t,d)}}}const Ia=Ze({id:U().optional(),name:U().min(1,"Name is required"),species:et(["dog","cat","other"],{message:"Choose a species"}),breed:U().optional(),color:U().optional(),weight:fs([gs().min(0,"Weight must be positive"),vs(),bs()]).transform(s=>typeof s=="number"&&!isNaN(s)?s:void 0).optional(),birthdate:U().optional(),microchipId:U().optional(),description:U().optional(),notes:U().optional(),vaccinations:Ze({rabies:xs().default(!1),rabiesExpires:U().optional()}).default({rabies:!1,rabiesExpires:""}),photoPreview:U().optional(),environment:et(["indoor","outdoor","indoor_outdoor"]).default("indoor_outdoor")});async function dt(s){return await(await fetch(s)).blob()}function mt({mode:s,open:t,onOpenChange:r,initialPet:a,onSubmit:n}){const{user:o}=Le(),[l,d]=i.useState(!1),{data:h,update:c}=pt(),p=ps({resolver:hs(Ia),defaultValues:{id:a?.id,name:a?.name??"",species:a?.species,breed:a?.breed??"",color:a?.color??"",weight:a?.weight??void 0,birthdate:a?.birthdate??"",microchipId:a?.microchipId??"",description:a?.description??"",notes:a?.notes??"",vaccinations:{rabies:a?.vaccinations?.rabies??!1,rabiesExpires:a?.vaccinations?.rabiesExpires??""},photoPreview:a?.photoPreview??"",environment:a?.environment??"indoor_outdoor"},mode:"onSubmit"}),x=p.watch("species"),v=p.watch("breed"),[j,y]=i.useState(!1),{themeId:w,updatePetTheme:k}=Ma(a?.id),[A,T]=i.useState(w);i.useEffect(()=>{T(w)},[w]);const E=i.useRef(null),N=i.useMemo(()=>x==="dog"?ka:x==="cat"?Sa:[],[x]),S=i.useMemo(()=>_a(x??"other",v),[x,v]),_=async m=>{if(!o?.id){alert("You must be signed in.");return}d(!0);const q={rabies:!!m.vaccinations?.rabies,rabiesExpires:m.vaccinations?.rabies&&m.vaccinations.rabiesExpires||void 0},D={owner_id:o.id,name:m.name,species:m.species,breed:m.breed||null,color:m.color||null,weight:typeof m.weight=="number"?m.weight:null,birthdate:m.birthdate||null,microchip_id:m.microchipId||null,description:m.description||null,notes:m.notes||null,vaccinations:q,environment:m.environment};try{let O;if(s==="add"){O=await br({...D});let F=E.current;if(!F&&m.photoPreview&&(F=await dt(m.photoPreview)),F&&F.size>0){const f=await ot(o.id,O.id,F);O=await $e(O.id,{photo_url:f})}}else{const F=m.id||a?.id;if(!F)throw new Error("Missing pet id for update.");let f=E.current;!f&&m.photoPreview&&(f=await dt(m.photoPreview));const M={name:D.name,species:D.species,breed:D.breed,color:D.color,weight:D.weight,birthdate:D.birthdate,microchip_id:D.microchip_id,description:D.description,notes:D.notes,vaccinations:D.vaccinations,environment:D.environment};if(f&&f.size>0){const V=await ot(o.id,F,f);M.photo_url=V}O=await $e(F,M)}O?.id&&await k(A),s==="add"&&h?.has_created_first_pet===!1&&await c.mutateAsync({has_created_first_pet:!0}),n?.(m),r(!1),s==="add"&&p.reset()}catch(O){console.error(O),alert(O?.message??"Failed to save pet")}finally{d(!1)}};return e.jsx(js,{open:t,onOpenChange:m=>!l&&r(m),children:e.jsxs(ys,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[e.jsx(ws,{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center ring-4 ring-primary/5",children:e.jsx(ee,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(Ns,{className:"text-2xl",children:s==="add"?"Add New Pet":"Edit Pet"}),e.jsx(Cs,{className:"text-base",children:s==="add"?"Enter your pet's details to create their profile":"Update your pet's information"})]})]})}),e.jsxs("form",{onSubmit:p.handleSubmit(_),className:"space-y-6 mt-4",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx(Ie,{className:"h-4 w-4 text-primary"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-primary/20",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"name",className:"text-sm font-medium flex items-center gap-2",children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Q,{id:"name",...p.register("name"),placeholder:"e.g., Milo, Luna, Max",className:"h-11 transition-all duration-200 focus:ring-2 focus:ring-primary/20"}),p.formState.errors.name&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1.5 animate-in fade-in-50",children:[e.jsx(be,{className:"h-3.5 w-3.5"}),p.formState.errors.name.message]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{className:"text-sm font-medium flex items-center gap-2",children:["Species ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(tt,{value:x,onValueChange:m=>{p.setValue("species",m,{shouldValidate:!0}),p.setValue("breed",""),p.setValue("color","")},children:[e.jsx(st,{className:"h-11",children:e.jsx(rt,{placeholder:"Select species"})}),e.jsxs(at,{children:[e.jsx(ae,{value:"dog",children:"ðŸ• Dog"}),e.jsx(ae,{value:"cat",children:"ðŸ± Cat"}),e.jsx(ae,{value:"other",children:"ðŸ¾ Other"})]})]}),p.formState.errors.species&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1.5",children:[e.jsx(be,{className:"h-3.5 w-3.5"}),p.formState.errors.species.message]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"birthdate",className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Zs,{className:"h-3.5 w-3.5"}),"Birthdate"]}),e.jsx(Q,{id:"birthdate",type:"date",...p.register("birthdate"),className:"h-11"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ee,{className:"h-3.5 w-3.5"}),x==="cat"?"Pattern":"Breed",x==="other"&&e.jsx("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{placeholder:x==="dog"?"e.g., Golden Retriever":x==="cat"?"e.g., Tabby, Calico":"e.g., Rabbit, Guinea Pig",...p.register("breed"),className:"h-11 flex-1"}),N.length>0&&e.jsxs(Ur,{open:j,onOpenChange:y,children:[e.jsx(Hr,{asChild:!0,children:e.jsxs($,{type:"button",variant:"outline",className:"w-36 justify-between h-11",children:["Suggestions ",e.jsx(rr,{className:"h-4 w-4 opacity-60"})]})}),e.jsx(Qr,{className:"p-0 w-64",children:e.jsxs(ba,{children:[e.jsx(ja,{placeholder:"Searchâ€¦"}),e.jsxs(ya,{children:[e.jsx(wa,{children:"No matches found."}),e.jsx(Na,{children:N.map(m=>e.jsx(Ca,{value:m,onSelect:q=>{p.setValue("breed",q),y(!1)},children:m},m))})]})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"color",className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ye,{className:"h-3.5 w-3.5"}),"Color"]}),e.jsx(Q,{id:"color",...p.register("color"),placeholder:"e.g., Brown, White, Mixed",className:"h-11"}),S.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:S.map(m=>e.jsx("button",{type:"button",onClick:()=>p.setValue("color",m,{shouldValidate:!0}),className:"rounded-full border border-primary/20 bg-primary/5 px-3 py-1 text-xs font-medium hover:bg-primary/10 transition-colors",children:m},m))})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"weight",className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(xr,{className:"h-3.5 w-3.5"}),"Weight (lbs)"]}),e.jsx(Q,{id:"weight",type:"number",step:"0.1",placeholder:"e.g., 45.5",...p.register("weight",{valueAsNumber:!0}),className:"h-11"}),p.formState.errors.weight&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1.5",children:[e.jsx(be,{className:"h-3.5 w-3.5"}),p.formState.errors.weight.message]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"microchipId",className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ks,{className:"h-3.5 w-3.5"}),"Microchip ID"]}),e.jsx(Q,{id:"microchipId",...p.register("microchipId"),placeholder:"e.g., 981000012345678",className:"h-11"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(cs,{className:"h-3.5 w-3.5"}),"Pet Environment"]}),e.jsxs(tt,{value:p.watch("environment"),onValueChange:m=>{p.setValue("environment",m,{shouldValidate:!0})},children:[e.jsx(st,{className:"h-11",children:e.jsx(rt,{placeholder:"Select environment"})}),e.jsxs(at,{children:[e.jsx(ae,{value:"indoor",children:"ðŸ  Indoor Only"}),e.jsx(ae,{value:"outdoor",children:"ðŸŒ³ Outdoor Only"}),e.jsx(ae,{value:"indoor_outdoor",children:"ðŸ¡ Indoor & Outdoor"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"description",className:"text-sm font-medium",children:"Physical Description"}),e.jsx(Q,{id:"description",...p.register("description"),placeholder:"e.g., White paws, brown spot on left ear",className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"notes",className:"text-sm font-medium",children:"Additional Notes"}),e.jsx(ks,{id:"notes",...p.register("notes"),placeholder:"Allergies, medications, behavioral notes, vet contact info...",className:"min-h-[80px] resize-none"})]})]})]}),e.jsx(Pe,{}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx(ur,{className:"h-4 w-4 text-primary"}),"Vaccinations"]}),e.jsxs("div",{className:"space-y-3 pl-6 border-l-2 border-primary/20",children:[e.jsx(Oe,{className:"border-blue-200 bg-blue-50 dark:border-blue-900 dark:bg-blue-950",children:e.jsx(Fe,{className:"text-xs text-blue-800 dark:text-blue-200",children:"Keep track of your pet's vaccination records for their health and safety"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 bg-secondary/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("input",{id:"rabies",type:"checkbox",className:"h-4 w-4 rounded border-primary text-primary focus:ring-primary",checked:!!p.watch("vaccinations.rabies"),onChange:m=>p.setValue("vaccinations.rabies",m.target.checked)}),e.jsx(z,{htmlFor:"rabies",className:"text-sm font-medium cursor-pointer",children:"Rabies Vaccination"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:w-48",children:[e.jsx(z,{htmlFor:"rabiesExpires",className:"text-xs text-muted-foreground whitespace-nowrap",children:"Expires:"}),e.jsx(Q,{id:"rabiesExpires",type:"date",disabled:!p.watch("vaccinations.rabies"),...p.register("vaccinations.rabiesExpires"),className:"h-9"})]})]})]})]}),e.jsx(Pe,{}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx(Ye,{className:"h-4 w-4 text-primary"}),"Page Theme"]}),e.jsxs("div",{className:"pl-6 border-l-2 border-primary/20",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Choose a color theme for your pet's public page"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Object.values(Xt).map(m=>e.jsxs("button",{type:"button",onClick:()=>T(m.id),className:Y("relative p-3 rounded-lg border-2 transition-all hover:scale-105",A===m.id?"border-primary shadow-md":"border-border hover:border-primary/50"),children:[e.jsx("div",{className:Y("h-16 rounded-md mb-2 bg-gradient-to-br",m.previewGradient)}),e.jsx("p",{className:"text-xs font-medium text-center",children:m.name}),A===m.id&&e.jsx("div",{className:"absolute top-2 right-2 h-5 w-5 bg-primary rounded-full flex items-center justify-center",children:e.jsx(Ws,{className:"h-3 w-3 text-primary-foreground"})})]},m.id))})]})]}),e.jsx(Pe,{}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx(tr,{className:"h-4 w-4 text-primary"}),"Pet Photo"]}),e.jsx("div",{className:"pl-6 border-l-2 border-primary/20",children:e.jsx(Pa,{label:"",value:p.watch("photoPreview")?{blob:new Blob,dataUrl:p.watch("photoPreview"),width:0,height:0,approxKB:0,mimeType:"image/*",original:{name:"",sizeKB:0,type:""}}:null,onChange:m=>{E.current=m?.blob??null,p.setValue("photoPreview",m?.dataUrl??"")},options:{maxWidth:1200,maxHeight:1200,quality:.82,preferWebP:!0}})})]}),e.jsxs(_s,{className:"gap-2 sm:gap-0 pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:l,className:"transition-all hover:scale-105",children:"Cancel"}),e.jsx($,{type:"submit",disabled:l,className:"transition-all hover:scale-105",children:l?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s==="add"?"Creating...":"Updating..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),s==="add"?"Create Pet Profile":"Save Changes"]})})]})]})]})})}function En(){const{user:s}=Le(),t=ut(),r=s?.id??null,{data:a}=pt(),{data:n,isLoading:o,isError:l}=Ve({queryKey:["pets",r],queryFn:async()=>r?jr(r):[],enabled:!!r,staleTime:3e4}),[d,h]=i.useState(!1),[c,p]=i.useState(null),[x,v]=i.useState(null),[j,y]=i.useState(null),[w,k]=i.useState(null),[A,T]=i.useState(!1),[E,N]=i.useState(!1);i.useEffect(()=>{if(!a||!n||o||E)return;const f=n.length===0,M=a.has_created_first_pet===!1;f&&M&&!d&&h(!0)},[a,n,o,d,E]);const S=f=>{const V=`${window.location.origin}/p/${f.short_id}`;window.open(V,"_blank")},_=async()=>{await t.invalidateQueries({queryKey:["pets",r]}),await t.invalidateQueries({queryKey:["profile",r]}),p(null),h(!1)},m=f=>{h(f),!f&&a?.has_created_first_pet===!1&&(!n||n.length===0)&&N(!0)},q=async()=>{await t.invalidateQueries({queryKey:["pets",r]}),v(null)},D=De({mutationFn:async({id:f,missing:M})=>$e(f,{missing:M,missing_since:M?new Date().toISOString():null}),onSuccess:async()=>{await t.invalidateQueries({queryKey:["pets",r]})}}),O=async(f,M)=>{if(M)k(f);else try{T(!0),await D.mutateAsync({id:f.id,missing:!1})}catch(V){alert(V?.message??"Failed to update")}finally{T(!1)}},F=async()=>{if(w)try{T(!0),await D.mutateAsync({id:w.id,missing:!0})}catch(f){alert(f?.message??"Failed to update")}finally{T(!1),k(null)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center ring-4 ring-primary/5",children:e.jsx(ee,{className:"h-5 w-5 text-primary"})}),"Dashboard"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your pets, QR codes, and track activity"})]}),E&&a?.has_created_first_pet===!1&&(!n||n.length===0)&&e.jsxs(Oe,{className:"border-primary/30 bg-primary/5 animate-in fade-in-50 slide-in-from-top-5",children:[e.jsx(Ie,{className:"h-4 w-4 text-primary"}),e.jsxs(Fe,{className:"flex items-center justify-between gap-4",children:[e.jsx("span",{className:"text-sm",children:"Ready to get started? Create your first pet profile to activate your QR tag"}),e.jsxs($,{size:"sm",onClick:()=>{N(!1),h(!0)},className:"gap-2 shrink-0",children:[e.jsx(Ee,{className:"h-3.5 w-3.5"}),"Add Pet"]})]})]}),e.jsxs(Jt,{defaultValue:"pets",className:"space-y-4",children:[e.jsxs(Zt,{className:"grid w-full max-w-2xl grid-cols-3",children:[e.jsxs(_e,{value:"pets",className:"gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"My Pets"]}),e.jsxs(_e,{value:"locations",className:"gap-2",children:[e.jsx(nt,{className:"h-4 w-4"}),"Locations"]}),e.jsxs(_e,{value:"activity",className:"gap-2",children:[e.jsx(nt,{className:"h-4 w-4"}),"Activity"]})]}),e.jsxs(ke,{value:"pets",className:"space-y-4",children:[e.jsxs(te,{className:"shadow-lg border-primary/10",children:[e.jsx(ce,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(le,{className:"text-2xl flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-primary"}),"Registered Pets"]}),e.jsx(Me,{className:"text-base",children:"Manage profiles, photos, QR tags, and missing status"})]}),e.jsxs($,{onClick:()=>h(!0),disabled:!r,className:"gap-2 transition-all hover:scale-105",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Add Pet"]})]})}),e.jsx(ie,{children:o?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((f,M)=>e.jsxs(te,{className:"p-4 space-y-3",children:[e.jsx(G,{className:"h-5 w-40"}),e.jsx(G,{className:"h-4 w-24"}),e.jsx(G,{className:"h-32 w-full rounded-md"}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(G,{className:"h-9 w-16"}),e.jsx(G,{className:"h-9 w-16"}),e.jsx(G,{className:"h-9 w-16"})]})]},M))}):l?e.jsxs(Oe,{variant:"destructive",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(Fe,{children:"Failed to load pets. Please try again."})]}):n&&n.length>0?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:n.map(f=>e.jsxs(te,{className:"overflow-hidden transition-all duration-200 hover:shadow-lg hover:scale-[1.02] border-primary/10",children:[e.jsxs(ce,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs(le,{className:"text-lg truncate flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-primary flex-shrink-0"}),f.name]}),e.jsxs("div",{className:"flex flex-col gap-1.5 items-end",children:[f.missing&&e.jsxs(Z,{variant:"destructive",className:"gap-1 animate-pulse",children:[e.jsx(Be,{className:"h-3 w-3"}),"Missing"]}),e.jsx(Z,{variant:Us(f.subscription_status),className:"gap-1 text-xs",children:f.subscription_status==="active"?e.jsxs(e.Fragment,{children:[e.jsx(Hs,{className:"h-3 w-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(lr,{className:"h-3 w-3"}),f.subscription_status==="expired"?"Expired":f.subscription_status==="cancelled"?"Cancelled":f.subscription_status==="pending"?"Pending":"Inactive"]})}),e.jsx(Z,{variant:"secondary",className:"capitalize text-xs",children:f.species}),e.jsxs(Z,{variant:"outline",className:"text-xs gap-1",children:[f.environment==="indoor"&&"ðŸ  Indoor",f.environment==="outdoor"&&"ðŸŒ³ Outdoor",f.environment==="indoor_outdoor"&&"ðŸ¡ Both"]}),e.jsx(Z,{variant:"outline",className:"text-xs capitalize",title:`Physical tag size: ${f.tag_type}`,children:f.tag_type==="dog"?"ðŸ·ï¸ Dog Tag":"ðŸ·ï¸ Cat Tag"})]})]}),e.jsx(Me,{className:"line-clamp-2 text-sm",children:f.breed||f.description||"No description"})]}),f.photo_url&&e.jsx("div",{className:"px-4 pb-3",children:e.jsx("img",{src:f.photo_url,alt:`${f.name} photo`,className:"w-full h-40 rounded-lg object-cover ring-1 ring-primary/10",loading:"lazy"})}),e.jsxs(ie,{className:"space-y-3 pt-3 border-t",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs($,{size:"sm",onClick:()=>p(f),className:"gap-1.5 flex-1 transition-all hover:scale-105",children:[e.jsx(dr,{className:"h-3.5 w-3.5"}),"Edit"]}),e.jsxs($,{size:"sm",variant:"outline",onClick:()=>S(f),className:"gap-1.5 flex-1 transition-all hover:scale-105",children:[e.jsx(_t,{className:"h-3.5 w-3.5"}),"View"]}),e.jsxs($,{size:"sm",variant:"outline",onClick:()=>y(f),className:"gap-1.5 flex-1 transition-all hover:scale-105",title:"View QR Code",children:[e.jsx(Qs,{className:"h-3.5 w-3.5"}),"QR"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{htmlFor:`missing-${f.id}`,className:"text-sm font-medium cursor-pointer",children:"Mark Missing"}),e.jsx(es,{id:`missing-${f.id}`,checked:!!f.missing,disabled:A||D.isPending,onCheckedChange:M=>O(f,M)})]}),e.jsxs($,{size:"sm",variant:"ghost",onClick:()=>v(f),className:"gap-1.5 text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(wt,{className:"h-3.5 w-3.5"}),"Delete"]})]})]})]},f.id))}):e.jsxs("div",{className:"text-center py-12 space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-20 w-20 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ee,{className:"h-10 w-10 text-primary/60"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-foreground",children:"No pets yet"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Click ",e.jsx("span",{className:"font-medium text-foreground",children:"Add Pet"})," to create your first pet profile"]})]}),e.jsxs($,{onClick:()=>h(!0),className:"gap-2 mt-4",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Add Your First Pet"]})]})})]}),e.jsx(mt,{mode:"add",open:d,onOpenChange:m,onSubmit:_}),c&&e.jsx(mt,{mode:"edit",open:!!c,onOpenChange:f=>!f&&p(null),initialPet:{id:c.id,name:c.name,species:c.species,breed:c.breed??void 0,color:c.color??void 0,weight:c.weight??void 0,birthdate:c.birthdate??void 0,microchipId:c.microchip_id??void 0,description:c.description??void 0,notes:c.notes??void 0,vaccinations:c.vaccinations?{rabies:c.vaccinations.rabies??!1,rabiesExpires:c.vaccinations.rabiesExpires??void 0}:void 0,photoPreview:c.photo_url??void 0,environment:c.environment},onSubmit:_}),r&&e.jsx(ds,{pet:j,open:!!j,onOpenChange:f=>!f&&y(null),ownerId:r}),e.jsx(Nr,{pet:x,open:!!x,onOpenChange:f=>!f&&v(null),onDeleted:q}),e.jsx(ht,{open:!!w,onOpenChange:f=>!f&&k(null),children:e.jsxs(ft,{children:[e.jsxs(xt,{children:[e.jsxs(gt,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-orange-500"}),"Mark ",w?.name," as missing?"]}),e.jsx(vt,{children:"This helps highlight their profile and can trigger your outreach flow. You can turn this off later."})]}),e.jsxs(bt,{children:[e.jsx(jt,{disabled:A,children:"Cancel"}),e.jsx(yt,{disabled:A,onClick:F,className:"gap-2",children:A?e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"h-4 w-4 animate-spin"}),"Savingâ€¦"]}):"Yes, mark missing"})]})]})})]}),e.jsx(ke,{value:"locations",className:"mt-4",children:e.jsx(Cr,{})}),e.jsx(ke,{value:"activity",className:"mt-4",children:e.jsx(gr,{days:30})})]})]})}export{En as default};
