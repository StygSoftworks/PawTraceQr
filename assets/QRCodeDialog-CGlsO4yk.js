const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-export-BgTFhrNl.js","assets/pdf-DO90N-Wx.js","assets/forms-BenlWNMe.js"])))=>i.map(i=>d[i]);
import{j as a}from"./radix-ui-Bptolu_l.js";import{c as p}from"./index-CF7rRjM7.js";import{r as u}from"./forms-BenlWNMe.js";import{c as b}from"./utils-CBfrqCZ4.js";import{_ as ee}from"./pdf-DO90N-Wx.js";import{c as ae,d as te,D as se,a as le,b as re,e as oe}from"./dialog-BvdlrsBK.js";import{B as h}from"./button-BLh6466_.js";import{L as P,I as ne}from"./input-D5K7R9e5.js";import{m as N,a as y}from"./qr-C9SoBEpz.js";import{S as I,a as G,b as B,c as O,d as V}from"./select-6HIOZ6ea.js";import{Q as ce,a9 as ie,aa as de,R as me,ai as ge,a8 as M,F as xe}from"./icons-D6Vx8KFF.js";function Ce(t){const e=p.c(8);let s,r;e[0]!==t?({className:s,...r}=t,e[0]=t,e[1]=s,e[2]=r):(s=e[1],r=e[2]);let l;e[3]!==s?(l=b("w-full caption-bottom text-sm",s),e[3]=s,e[4]=l):l=e[4];let o;return e[5]!==r||e[6]!==l?(o=a.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:a.jsx("table",{"data-slot":"table",className:l,...r})}),e[5]=r,e[6]=l,e[7]=o):o=e[7],o}function Te(t){const e=p.c(8);let s,r;e[0]!==t?({className:s,...r}=t,e[0]=t,e[1]=s,e[2]=r):(s=e[1],r=e[2]);let l;e[3]!==s?(l=b("[&_tr]:border-b",s),e[3]=s,e[4]=l):l=e[4];let o;return e[5]!==r||e[6]!==l?(o=a.jsx("thead",{"data-slot":"table-header",className:l,...r}),e[5]=r,e[6]=l,e[7]=o):o=e[7],o}function $e(t){const e=p.c(8);let s,r;e[0]!==t?({className:s,...r}=t,e[0]=t,e[1]=s,e[2]=r):(s=e[1],r=e[2]);let l;e[3]!==s?(l=b("[&_tr:last-child]:border-0",s),e[3]=s,e[4]=l):l=e[4];let o;return e[5]!==r||e[6]!==l?(o=a.jsx("tbody",{"data-slot":"table-body",className:l,...r}),e[5]=r,e[6]=l,e[7]=o):o=e[7],o}function De(t){const e=p.c(8);let s,r;e[0]!==t?({className:s,...r}=t,e[0]=t,e[1]=s,e[2]=r):(s=e[1],r=e[2]);let l;e[3]!==s?(l=b("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),e[3]=s,e[4]=l):l=e[4];let o;return e[5]!==r||e[6]!==l?(o=a.jsx("tr",{"data-slot":"table-row",className:l,...r}),e[5]=r,e[6]=l,e[7]=o):o=e[7],o}function Fe(t){const e=p.c(8);let s,r;e[0]!==t?({className:s,...r}=t,e[0]=t,e[1]=s,e[2]=r):(s=e[1],r=e[2]);let l;e[3]!==s?(l=b("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),e[3]=s,e[4]=l):l=e[4];let o;return e[5]!==r||e[6]!==l?(o=a.jsx("th",{"data-slot":"table-head",className:l,...r}),e[5]=r,e[6]=l,e[7]=o):o=e[7],o}function ke(t){const e=p.c(8);let s,r;e[0]!==t?({className:s,...r}=t,e[0]=t,e[1]=s,e[2]=r):(s=e[1],r=e[2]);let l;e[3]!==s?(l=b("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),e[3]=s,e[4]=l):l=e[4];let o;return e[5]!==r||e[6]!==l?(o=a.jsx("td",{"data-slot":"table-cell",className:l,...r}),e[5]=r,e[6]=l,e[7]=o):o=e[7],o}const ue=[{label:"Small (256px)",value:"256"},{label:"Medium (512px)",value:"512"},{label:"Large (1024px)",value:"1024"},{label:"Extra Large (2048px)",value:"2048"}],he=[{label:"Letter (8.5 × 11 in)",value:"letter"},{label:"A4 (210 × 297 mm)",value:"a4"}];function qe({pet:t,open:e,onOpenChange:s}){const[r,l]=u.useState(!1),[o,S]=u.useState(null),[C,z]=u.useState("512"),[c,T]=u.useState("square"),[$,A]=u.useState("letter"),[D,F]=u.useState(!1);u.useEffect(()=>{if(e&&t?.short_id){l(!0);const n=`https://www.pawtraceqr.com/p/${t.short_id}`,m=`pawtraceqr.com/p/${t.short_id}`;(c==="round"?N:y)(n,m,512,!1).then(i=>{const f=`data:image/svg+xml;base64,${btoa(i)}`;S(f)}).catch(()=>{S(null)}).finally(()=>l(!1))}else S(null)},[e,t?.short_id,c]);const k=t?.short_id?`https://www.pawtraceqr.com/p/${t.short_id}`:null,H=async n=>{if(n)try{await navigator.clipboard.writeText(n),alert("Copied to clipboard")}catch{alert("Failed to copy")}},W=async n=>{if(t?.short_id)try{const m=`https://www.pawtraceqr.com/p/${t.short_id}`,w=`pawtraceqr.com/p/${t.short_id}`,i=parseInt(n),x=await(c==="round"?N:y)(m,w,i,!1),d=new Image,_=new Blob([x],{type:"image/svg+xml"}),v=URL.createObjectURL(_);await new Promise((X,Y)=>{d.onload=()=>X(),d.onerror=()=>Y(new Error("Failed to load SVG")),d.src=v});const E=new DOMParser().parseFromString(x,"image/svg+xml").documentElement,L=parseFloat(E.getAttribute("width")||String(i)),Q=parseFloat(E.getAttribute("height")||String(i)),U=i/Math.max(L,Q),g=document.createElement("canvas");g.width=Math.round(L*U),g.height=Math.round(Q*U);const j=g.getContext("2d");if(!j)throw new Error("Canvas context unavailable");j.fillStyle="#ffffff",j.fillRect(0,0,g.width,g.height),j.drawImage(d,0,0,g.width,g.height),URL.revokeObjectURL(v);const K=g.toDataURL("image/png"),R=document.createElement("a");R.href=K,R.download=`${t.name}-qr-${c}-${n}px.png`,R.click()}catch{alert("Failed to generate PNG")}},Z=async()=>{if(t?.short_id)try{const n=`https://www.pawtraceqr.com/p/${t.short_id}`,m=`pawtraceqr.com/p/${t.short_id}`,i=await(c==="round"?N:y)(n,m),f=new Blob([i],{type:"image/svg+xml"}),x=URL.createObjectURL(f),d=document.createElement("a");d.href=x,d.download=`${t.name}-qr-${c}.svg`,d.click(),URL.revokeObjectURL(x)}catch{alert("Failed to generate SVG")}},J=async()=>{if(t?.short_id){F(!0);try{const n=`https://www.pawtraceqr.com/p/${t.short_id}`,m=`pawtraceqr.com/p/${t.short_id}`,i=await(c==="round"?N:y)(n,m),{svgStringToPdf:f,downloadPdfBlob:x}=await ee(async()=>{const{svgStringToPdf:v,downloadPdfBlob:q}=await import("./pdf-export-BgTFhrNl.js");return{svgStringToPdf:v,downloadPdfBlob:q}},__vite__mapDeps([0,1,2])),d=await f(i,{pageSize:$,orientation:"portrait",title:`${t.name} QR Code`,author:"PawTrace QR"}),_=new Date().toISOString().split("T")[0];x(d,`${t.name}-qr-${c}-${_}.pdf`)}catch(n){console.error("PDF generation error:",n),alert("Failed to generate PDF")}finally{F(!1)}}};return a.jsx(ae,{open:e,onOpenChange:s,children:a.jsxs(te,{className:"sm:max-w-md border-2",children:[a.jsx(se,{className:"space-y-3",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-10 w-10 bg-primary rounded-xl flex items-center justify-center shadow-md",children:a.jsx(ce,{className:"h-5 w-5 text-white"})}),a.jsxs("div",{children:[a.jsxs(le,{className:"text-xl text-foreground",children:["QR Code ",t?`– ${t.name}`:""]}),a.jsxs(re,{className:"text-muted-foreground",children:["Scan to open the public pet page",t&&a.jsxs("span",{className:"block mt-1 font-medium",children:["Physical Tag: ",t.tag_type==="dog"?"Dog Size (Larger)":"Cat Size (Smaller)"]})]})]})]})}),a.jsxs("div",{className:"flex flex-col items-center gap-4 py-4",children:[a.jsxs("div",{className:"w-full space-y-2",children:[a.jsx(P,{className:"text-sm font-semibold text-foreground",children:"QR Code Shape"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(h,{type:"button",variant:c==="square"?"default":"outline",className:"flex-1 gap-2",onClick:()=>T("square"),children:[a.jsx(ie,{className:"h-4 w-4"}),"Square"]}),a.jsxs(h,{type:"button",variant:c==="round"?"default":"outline",className:"flex-1 gap-2",onClick:()=>T("round"),children:[a.jsx(de,{className:"h-4 w-4"}),"Round"]})]}),c==="round"&&a.jsx("p",{className:"text-xs text-muted-foreground",children:"Perfect for round metallic tags. Uses high error correction for reliable scanning."})]}),r?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground py-8",children:[a.jsx(me,{className:"h-4 w-4 animate-spin"}),"Generating QR code…"]}):o?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:`p-8 bg-white dark:bg-white border-4 border-primary shadow-lg ${c==="round"?"rounded-full":"rounded-md"}`,children:a.jsx("img",{src:o,alt:"QR code",className:"h-64 w-64 object-contain",style:{backgroundColor:"#ffffff"}})}),a.jsxs("div",{className:"w-full space-y-3",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(P,{className:"text-sm font-semibold text-foreground",children:"Public Page URL"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(ne,{readOnly:!0,value:k??"",className:"text-xs bg-background text-foreground border-2"}),a.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>H(k),className:"flex-shrink-0",title:"Copy URL",children:a.jsx(ge,{className:"h-4 w-4"})})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(P,{className:"text-sm font-semibold text-foreground",children:"Download Options"}),a.jsxs(h,{type:"button",onClick:Z,variant:"outline",className:"w-full gap-2 border-2",children:[a.jsx(M,{className:"h-4 w-4"}),"Download SVG (Illustrator Compatible)"]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(I,{value:C,onValueChange:z,children:[a.jsx(G,{className:"flex-1",children:a.jsx(B,{})}),a.jsx(O,{children:ue.map(n=>a.jsx(V,{value:n.value,children:n.label},n.value))})]}),a.jsxs(h,{type:"button",onClick:()=>W(C),className:"gap-2 bg-primary text-primary-foreground hover:bg-primary/90",children:[a.jsx(M,{className:"h-4 w-4"}),"Download PNG"]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(I,{value:$,onValueChange:n=>A(n),children:[a.jsx(G,{className:"flex-1",children:a.jsx(B,{})}),a.jsx(O,{children:he.map(n=>a.jsx(V,{value:n.value,children:n.label},n.value))})]}),a.jsxs(h,{type:"button",onClick:J,disabled:D,variant:"outline",className:"gap-2 border-2",children:[a.jsx(xe,{className:"h-4 w-4"}),D?"Generating...":"Download PDF"]})]})]})]})]}):a.jsx("div",{className:"text-sm text-muted-foreground py-8",children:"No QR code available"})]}),a.jsx(oe,{children:a.jsx(h,{type:"button",variant:"outline",onClick:()=>s(!1),className:"border-2",children:"Close"})})]})})}export{qe as Q,Ce as T,Te as a,De as b,Fe as c,$e as d,ke as e};
