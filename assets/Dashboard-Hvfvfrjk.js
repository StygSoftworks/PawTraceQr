import{j as t,R as gs,T as vs,P as js,C as bs,u as qe,a as ue,b as ws,c as ys,O as Ns,d as _s,e as Be}from"./radix-ui-Bptolu_l.js";import{c as G,u as jt,s as F,D as nt,a as Ss,T as Cs}from"./index-CF7rRjM7.js";import{r as f,u as zt}from"./forms-BenlWNMe.js";import{u as he,b as et,c as oe}from"./react-query-DgYD4zqU.js";import{u as Ot}from"./useProfile-C_JxfiJ4.js";import{C as ie,a as ne,b as le,c as $e,d as ee}from"./card-CIySVGy3.js";import{B as Y}from"./badge-Bx5bWiwT.js";import{T as ks,a as Ps,b as Ye,c as Xe}from"./tabs-k7i6jSCB.js";import{B as K}from"./button-BLh6466_.js";import{S as X}from"./skeleton-W9uVo9s8.js";import{A as Lt,a as Ut,b as Vt,c as Kt,d as Qt,e as Wt,f as Gt,g as Ht}from"./alert-dialog-iojD7B6s.js";import{S as tt}from"./switch-DlVR02HA.js";import{I as re,L as W}from"./input-D5K7R9e5.js";import{A as Je,a as Ze}from"./alert-BehdoEGx.js";import{l as Es}from"./analytics-BlNnruwt.js";import{T as Ts,a as Ds,b as Yt,c as _t,d as Rs,e as St,Q as Ms}from"./QRCodeDialog-CGlsO4yk.js";import"./opentype-CPIVssqb.js";import{T as st,R as ze,b as bt,M as lt,c as wt,d as qs,P as As,E as Fs,e as Le,A as Is,U as ht,S as Ue,f as Oe,g as Bs,h as Ie,i as yt,X as Xt,j as $s,k as zs,l as ce,m as pt,n as Os,o as Ls,p as Ct,W as Us,F as Vs,H as Ks,q as Qs,r as Ws,s as ot,t as ft,u as kt,v as Gs,w as Hs,Q as Ys}from"./icons-D6Vx8KFF.js";import{f as Jt}from"./date-fns-CSQe5d3I.js";import{a as Zt,o as xt,b as es,s as ae,_ as Pt,u as Xs,n as Js,c as Zs,d as ea}from"./zod-B4P2RwCa.js";import{D as ts,a as ss,b as as,c as rs,d as is,e as ta}from"./dialog-BvdlrsBK.js";import{T as sa}from"./textarea-DdMh91v_.js";import{S as Et,a as Tt,b as Dt,c as Rt,d as De}from"./select-6HIOZ6ea.js";import{c as de}from"./utils-CBfrqCZ4.js";import{S as ct}from"./separator-BobN6wd_.js";import{g as aa}from"./billing-X1lU7Ov_.js";import"./react-dom-CWqaeSHD.js";import"./pdf-DO90N-Wx.js";import"./supabase-Dq_AJ6PJ.js";import"./router-fBLXKt6a.js";import"./index-CdJFUDDL.js";import"./qr-C9SoBEpz.js";function ra(s){const e=G.c(18),{days:a}=s,r=a===void 0?14:a,{user:i}=jt(),n=i?.id??null;let o,c;e[0]!==r||e[1]!==n?(o=["scan_events",n,r],c=()=>n?Es(n,r):Promise.resolve([]),e[0]=r,e[1]=n,e[2]=o,e[3]=c):(o=e[2],c=e[3]);const u=!!n;let m;e[4]!==o||e[5]!==c||e[6]!==u?(m={queryKey:o,queryFn:c,enabled:u,staleTime:3e4},e[4]=o,e[5]=c,e[6]=u,e[7]=m):m=e[7];const{data:l,isLoading:h,isError:x}=he(m);let j;e[8]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx(ne,{children:"QR Scan Events"}),e[8]=j):j=e[8];let g;e[9]!==r?(g=t.jsxs(le,{children:[j,t.jsxs($e,{children:["Last ",r," days"]})]}),e[9]=r,e[10]=g):g=e[10];let v;e[11]!==l||e[12]!==x||e[13]!==h?(v=t.jsx(ie,{children:h?t.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}):x?t.jsx("div",{className:"text-sm text-destructive",children:"Failed to load scans."}):l?.length?t.jsxs(Ts,{children:[t.jsx(Ds,{children:t.jsxs(Yt,{children:[t.jsx(_t,{children:"When"}),t.jsx(_t,{children:"Pet"})]})}),t.jsx(Rs,{children:l.map(ia)})]}):t.jsx("div",{className:"text-sm text-muted-foreground",children:"No scans yet."})}),e[11]=l,e[12]=x,e[13]=h,e[14]=v):v=e[14];let y;return e[15]!==g||e[16]!==v?(y=t.jsxs(ee,{children:[g,v]}),e[15]=g,e[16]=v,e[17]=y):y=e[17],y}function ia(s){return t.jsxs(Yt,{children:[t.jsx(St,{className:"whitespace-nowrap",children:new Date(s.scanned_at).toLocaleString()}),t.jsx(St,{className:"font-medium",children:s.pet_name})]},s.id)}async function na(s){const e=s.species==="dog"?"dog":"cat",{data:a,error:r}=await F.rpc("reserve_qr_code",{p_tag_type:e});if(r||!a||a.length===0)throw new Error(`No available ${e} QR codes in pool. Please contact support.`);const i=a[0];try{const{data:n,error:o}=await F.from("pets").insert({...s,qr_code_id:i.qr_id,short_id:i.qr_short_id,qr_url:i.qr_qr_url}).select("*").single();if(o)throw o;const{error:c}=await F.rpc("finalize_qr_assignment",{p_qr_id:i.qr_id,p_pet_id:n.id});return c&&console.error("Failed to finalize QR assignment:",c),n}catch(n){throw await F.rpc("release_qr_code",{p_qr_id:i.qr_id}),n}}async function Mt(s,e){const{error:a}=await F.from("pets").update(e).eq("id",s);if(a)throw a;const{data:r,error:i}=await F.from("pets").select("*").eq("id",s).maybeSingle();return i?(console.warn("updatePet: select after update blocked by RLS:",i?.message),{id:s,...e}):r??{id:s,...e}}async function la(s){const{data:e,error:a}=await F.from("pets").select("*").eq("owner_id",s).order("created_at",{ascending:!1});if(a)throw a;return e??[]}async function qt(s,e,a){if(!a||a.size===0)throw new Error("Empty image blob");const r=a.type||"image/webp",i=r==="image/jpeg"||r==="image/jpg"?"jpg":r==="image/png"?"png":r==="image/avif"?"avif":"webp",n=Date.now(),o=`${s}/${e}-${n}.${i}`,{error:c}=await F.storage.from("pet-photos").upload(o,a,{contentType:r,upsert:!1});if(c)throw console.error("storage.upload error:",c),c;const{data:u}=F.storage.from("pet-photos").getPublicUrl(o);return u.publicUrl}async function oa(s){const{error:e}=await F.from("pets").delete().eq("id",s);if(e)throw e}async function ca(s){if(!s)return;const e=s.indexOf("/pet-photos/");if(e===-1)return;const a=s.substring(e+12);if(!a)return;const{error:r}=await F.storage.from("pet-photos").remove([a]);r&&console.warn("storage.remove warning:",r.message)}async function da(s,e){const{data:a,error:r}=await F.rpc("toggle_pet_missing",{p_pet_id:s,p_is_missing:e});if(r)throw r;return a}function ma({pet:s,open:e,onOpenChange:a,onDeleted:r}){const[i,n]=f.useState(!1),o=async()=>{if(s){n(!0);try{s.photo_url&&await ca(s.photo_url),await oa(s.id),r(),a(!1)}catch(c){alert(c?.message??"Failed to delete pet")}finally{n(!1)}}};return s?t.jsx(Lt,{open:e,onOpenChange:a,children:t.jsxs(Ut,{children:[t.jsxs(Vt,{children:[t.jsxs(Kt,{className:"flex items-center gap-2",children:[t.jsx(st,{className:"h-5 w-5 text-destructive"}),"Delete ",s.name,"?"]}),t.jsxs(Qt,{children:["This will permanently remove the pet profile",s.photo_url?" and its photo":"",". This action cannot be undone."]})]}),t.jsxs(Wt,{children:[t.jsx(Gt,{disabled:i,children:"Cancel"}),t.jsx(Ht,{disabled:i,onClick:o,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 gap-2",children:i?t.jsxs(t.Fragment,{children:[t.jsx(ze,{className:"h-4 w-4 animate-spin"}),"Deleting…"]}):t.jsxs(t.Fragment,{children:[t.jsx(bt,{className:"h-4 w-4"}),"Delete"]})})]})]})}):null}function ua(){const s=G.c(34),e=et();let a;s[0]===Symbol.for("react.memo_cache_sentinel")?(a={queryKey:["location-shares"],queryFn:va},s[0]=a):a=s[0];const{data:r,isLoading:i}=he(a);let n;s[1]!==e?(n={mutationFn:ga,onSuccess:()=>{e.invalidateQueries({queryKey:["location-shares"]})}},s[1]=e,s[2]=n):n=s[2];const o=oe(n);let c;s[3]!==e?(c={mutationFn:xa,onSuccess:()=>{e.invalidateQueries({queryKey:["location-shares"]})}},s[3]=e,s[4]=c):c=s[4];const u=oe(c),m=fa;if(i){let P;s[5]===Symbol.for("react.memo_cache_sentinel")?(P=t.jsx(le,{children:t.jsxs(ne,{className:"flex items-center gap-2",children:[t.jsx(lt,{className:"h-5 w-5"}),"Location Shares"]})}),s[5]=P):P=s[5];let b;return s[6]===Symbol.for("react.memo_cache_sentinel")?(b=t.jsxs(ee,{children:[P,t.jsxs(ie,{className:"space-y-3",children:[t.jsx(X,{className:"h-24 w-full"}),t.jsx(X,{className:"h-24 w-full"})]})]}),s[6]=b):b=s[6],b}let l,h,x,j,g,v;if(s[7]!==u||s[8]!==o||s[9]!==r){v=Symbol.for("react.early_return_sentinel");e:{const P=r?.filter(pa)||[],b=P.filter(ha).length;if(P.length===0){let d;s[16]===Symbol.for("react.memo_cache_sentinel")?(d=t.jsx(le,{children:t.jsxs(ne,{className:"flex items-center gap-2",children:[t.jsx(lt,{className:"h-5 w-5"}),"Location Shares"]})}),s[16]=d):d=s[16];let B;s[17]===Symbol.for("react.memo_cache_sentinel")?(B=t.jsxs(ee,{children:[d,t.jsx(ie,{children:t.jsx("p",{className:"text-sm text-muted-foreground",children:"No location shares yet. When someone finds your pet and shares their location, it will appear here."})})]}),s[17]=B):B=s[17],v=B;break e}h=ee;let C;s[18]===Symbol.for("react.memo_cache_sentinel")?(C=t.jsx(lt,{className:"h-5 w-5"}),s[18]=C):C=s[18];let E;s[19]!==b?(E=b>0&&t.jsxs(Y,{variant:"destructive",className:"ml-auto",children:[b," New"]}),s[19]=b,s[20]=E):E=s[20],s[21]!==E?(g=t.jsx(le,{children:t.jsxs(ne,{className:"flex items-center gap-2",children:[C,"Location Shares",E]})}),s[21]=E,s[22]=g):g=s[22],l=ie,x="space-y-4";let k;s[23]!==u||s[24]!==o?(k=d=>t.jsxs("div",{className:`border rounded-lg p-4 space-y-3 ${d.viewed_at?"border-border":"border-primary bg-primary/5"}`,children:[t.jsx("div",{className:"flex items-start justify-between gap-3",children:t.jsxs("div",{className:"space-y-1 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"font-semibold",children:d.pet_name}),!d.viewed_at&&t.jsx(Y,{variant:"secondary",className:"text-xs",children:"New"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsx(wt,{className:"h-3.5 w-3.5"}),Jt(new Date(d.shared_at),"MMM d, yyyy 'at' h:mm a")]}),d.accuracy&&t.jsxs("p",{className:"text-xs text-muted-foreground",children:["Accuracy: ±",Math.round(d.accuracy),"m"]})]})}),d.finder_note&&t.jsxs("div",{className:"bg-muted/50 rounded p-3 space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[t.jsx(qs,{className:"h-3 w-3"}),"Message from finder"]}),t.jsx("p",{className:"text-sm whitespace-pre-wrap",children:d.finder_note})]}),d.finder_contact&&t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(As,{className:"h-3.5 w-3.5 text-muted-foreground"}),t.jsx("a",{href:d.finder_contact.includes("@")?`mailto:${d.finder_contact}`:`tel:${d.finder_contact}`,className:"text-primary hover:underline",children:d.finder_contact})]}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsxs(K,{size:"sm",onClick:()=>m(Number(d.latitude),Number(d.longitude)),className:"flex-1 gap-2",children:[t.jsx(Fs,{className:"h-3.5 w-3.5"}),"Open in Maps"]}),!d.viewed_at&&t.jsx(K,{size:"sm",variant:"outline",onClick:()=>o.mutate(d.id),disabled:o.isPending,children:t.jsx(Le,{className:"h-3.5 w-3.5"})}),t.jsx(K,{size:"sm",variant:"ghost",onClick:()=>u.mutate(d.id),disabled:u.isPending,children:t.jsx(Is,{className:"h-3.5 w-3.5"})})]})]},d.id),s[23]=u,s[24]=o,s[25]=k):k=s[25],j=P.map(k)}s[7]=u,s[8]=o,s[9]=r,s[10]=l,s[11]=h,s[12]=x,s[13]=j,s[14]=g,s[15]=v}else l=s[10],h=s[11],x=s[12],j=s[13],g=s[14],v=s[15];if(v!==Symbol.for("react.early_return_sentinel"))return v;let y;s[26]!==l||s[27]!==x||s[28]!==j?(y=t.jsx(l,{className:x,children:j}),s[26]=l,s[27]=x,s[28]=j,s[29]=y):y=s[29];let S;return s[30]!==h||s[31]!==g||s[32]!==y?(S=t.jsxs(h,{children:[g,y]}),s[30]=h,s[31]=g,s[32]=y,s[33]=S):S=s[33],S}function ha(s){return!s.viewed_at}function pa(s){return!s.archived_at}function fa(s,e){const a=`https://www.google.com/maps/search/?api=1&query=${s},${e}`;window.open(a,"_blank")}async function xa(s){const{error:e}=await F.from("location_shares").update({archived_at:new Date().toISOString()}).eq("id",s);if(e)throw e}async function ga(s){const{error:e}=await F.from("location_shares").update({viewed_at:new Date().toISOString()}).eq("id",s);if(e)throw e}async function va(){const{data:s}=await F.auth.getUser(),{user:e}=s;if(!e)return[];const{data:a,error:r}=await F.from("location_shares").select(`
          id,
          pet_id,
          latitude,
          longitude,
          accuracy,
          finder_note,
          finder_contact,
          shared_at,
          viewed_at,
          archived_at,
          pets!inner(name)
        `).eq("owner_id",e.id).is("archived_at",null).order("shared_at",{ascending:!1}).limit(10);if(r)throw r;return(a||[]).map(ja)}function ja(s){return{...s,pet_name:s.pets.name}}async function ba(s,e,a=!1){const{data:{user:r}}=await F.auth.getUser();if(!r)throw new Error("Not authenticated");const{data:i}=await F.from("profiles").select("id, email").eq("email",e.toLowerCase().trim()).maybeSingle(),{data:n}=await F.from("pet_shares").select("id, status").eq("pet_id",s).eq(i?"shared_with_id":"shared_with_email",i?i.id:e.toLowerCase().trim()).in("status",["pending","accepted"]).maybeSingle();if(n)throw new Error("This pet is already shared with this user");const o={pet_id:s,owner_id:r.id,can_edit:a,status:"pending",shared_with_email:e.toLowerCase().trim()};i&&(o.shared_with_id=i.id);const{data:c,error:u}=await F.from("pet_shares").insert(o).select().single();if(u)throw u;return c}async function wa(s){const{data:e,error:a}=await F.from("pet_shares").select(`
      id,
      pet_id,
      owner_id,
      shared_with_id,
      shared_with_email,
      can_edit,
      status,
      created_at,
      accepted_at,
      revoked_at,
      pets!inner(name),
      shared_user:profiles!pet_shares_shared_with_id_fkey(display_name, email)
    `).eq("pet_id",s).in("status",["pending","accepted"]).order("created_at",{ascending:!1});if(a)throw a;return(e||[]).map(r=>({...r,pet_name:r.pets?.name||"",owner_name:null,owner_email:null,shared_user_name:r.shared_user?.display_name||null,shared_user_email:r.shared_user?.email||r.shared_with_email}))}async function ya(){const{data:{user:s}}=await F.auth.getUser();if(!s)return[];const{data:e,error:a}=await F.from("pet_shares").select(`
      id,
      pet_id,
      can_edit,
      created_at,
      pets!inner(name),
      owner:profiles!pet_shares_owner_id_fkey(display_name, email)
    `).eq("shared_with_id",s.id).eq("status","pending").order("created_at",{ascending:!1});if(a)throw a;return(e||[]).map(r=>({id:r.id,pet_id:r.pet_id,pet_name:r.pets?.name||"",owner_name:r.owner?.display_name||null,owner_email:r.owner?.email||null,can_edit:r.can_edit,created_at:r.created_at}))}async function Na(){const{data:{user:s}}=await F.auth.getUser();if(!s)return[];const{data:e,error:a}=await F.from("pet_shares").select(`
      id,
      can_edit,
      pets!inner(
        id,
        owner_id,
        name,
        species,
        breed,
        color,
        weight,
        birthdate,
        microchip_id,
        description,
        notes,
        vaccinations,
        photo_url,
        created_at,
        updated_at,
        missing,
        missing_since,
        qr_url,
        short_id,
        tag_type,
        environment,
        paypal_subscription_id,
        subscription_status,
        subscription_activated_at,
        subscription_expires_at,
        subscription_plan_id
      ),
      owner:profiles!pet_shares_owner_id_fkey(display_name, email)
    `).eq("shared_with_id",s.id).eq("status","accepted").order("created_at",{ascending:!1});if(a)throw a;return(e||[]).map(r=>({...r.pets,share_id:r.id,can_edit:r.can_edit,owner_name:r.owner?.display_name||null,owner_email:r.owner?.email||null,is_shared:!0}))}async function _a(s){const{error:e}=await F.rpc("accept_pet_share",{p_share_id:s});if(e)throw e;return!0}async function Sa(s){const{error:e}=await F.rpc("decline_pet_share",{p_share_id:s});if(e)throw e;return!0}async function Ca(s){const{error:e}=await F.rpc("revoke_pet_share",{p_share_id:s});if(e)throw e;return!0}async function ka(s,e){const{error:a}=await F.from("pet_shares").update({can_edit:e}).eq("id",s);if(a)throw a}async function Pa(s){const{count:e,error:a}=await F.from("pet_shares").select("id",{count:"exact",head:!0}).eq("pet_id",s).in("status",["pending","accepted"]);return a?0:e||0}const Ea=xt({email:ae().email("Please enter a valid email address"),canEdit:es()});function Ta(s){const e=G.c(118),{pet:a,open:r,onOpenChange:i}=s,n=et(),[o,c]=f.useState(null);let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u={resolver:Zt(Ea),defaultValues:{email:"",canEdit:!1}},e[0]=u):u=e[0];const{register:m,handleSubmit:l,reset:h,watch:x,setValue:j,formState:g}=zt(u),{errors:v}=g;let y;e[1]!==x?(y=x("canEdit"),e[1]=x,e[2]=y):y=e[2];const S=y,P=a?.id;let b;e[3]!==P?(b=["pet-collaborators",P],e[3]=P,e[4]=b):b=e[4];let C;e[5]!==a?(C=()=>a?wa(a.id):Promise.resolve([]),e[5]=a,e[6]=C):C=e[6];const E=!!a&&r;let k;e[7]!==b||e[8]!==C||e[9]!==E?(k={queryKey:b,queryFn:C,enabled:E},e[7]=b,e[8]=C,e[9]=E,e[10]=k):k=e[10];const{data:d,isLoading:B}=he(k);let M;e[11]!==a?(M=async se=>{if(!a)throw new Error("No pet selected");return ba(a.id,se.email,se.canEdit)},e[11]=a,e[12]=M):M=e[12];let A;e[13]!==a?.id||e[14]!==n||e[15]!==h?(A=()=>{n.invalidateQueries({queryKey:["pet-collaborators",a?.id]}),h(),c(null)},e[13]=a?.id,e[14]=n,e[15]=h,e[16]=A):A=e[16];let I;e[17]===Symbol.for("react.memo_cache_sentinel")?(I=se=>{c(se.message)},e[17]=I):I=e[17];let $;e[18]!==A||e[19]!==M?($={mutationFn:M,onSuccess:A,onError:I},e[18]=A,e[19]=M,e[20]=$):$=e[20];const R=oe($);let O;e[21]!==a?.id||e[22]!==n?(O={mutationFn:Ca,onSuccess:()=>{n.invalidateQueries({queryKey:["pet-collaborators",a?.id]})}},e[21]=a?.id,e[22]=n,e[23]=O):O=e[23];const V=oe(O);let N;e[24]!==a?.id||e[25]!==n?(N={mutationFn:Ra,onSuccess:()=>{n.invalidateQueries({queryKey:["pet-collaborators",a?.id]})}},e[24]=a?.id,e[25]=n,e[26]=N):N=e[26];const L=oe(N);let Q;e[27]!==R?(Q=se=>{c(null),R.mutate(se)},e[27]=R,e[28]=Q):Q=e[28];const Z=Q;if(!a)return null;let H,J,p,_,T,w,D,q,z,U,te;if(e[29]!==S||e[30]!==d||e[31]!==o||e[32]!==v.email||e[33]!==l||e[34]!==B||e[35]!==i||e[36]!==Z||e[37]!==r||e[38]!==a.name||e[39]!==m||e[40]!==V||e[41]!==j||e[42]!==R.isPending||e[43]!==L){const se=d?.filter(Da)||[];J=rs,U=r,te=i,H=is,q="sm:max-w-lg";let Qe;e[55]===Symbol.for("react.memo_cache_sentinel")?(Qe=t.jsx(Oe,{className:"h-5 w-5"}),e[55]=Qe):Qe=e[55],e[56]!==a.name?(z=t.jsxs(ts,{children:[t.jsxs(ss,{className:"flex items-center gap-2",children:[Qe,"Share ",a.name]}),t.jsxs(as,{children:["Invite family members or friends to view and manage ",a.name,"'s profile."]})]}),e[56]=a.name,e[57]=z):z=e[57],w="space-y-6";let ve;e[58]!==l||e[59]!==Z?(ve=l(Z),e[58]=l,e[59]=Z,e[60]=ve):ve=e[60];let We;e[61]===Symbol.for("react.memo_cache_sentinel")?(We=t.jsxs(W,{htmlFor:"email",className:"flex items-center gap-2",children:[t.jsx(Bs,{className:"h-4 w-4"}),"Email Address"]}),e[61]=We):We=e[61];let je;e[62]!==m?(je=m("email"),e[62]=m,e[63]=je):je=e[63];let be;e[64]!==R.isPending||e[65]!==je?(be=t.jsx(re,{id:"email",type:"email",placeholder:"friend@example.com",...je,disabled:R.isPending}),e[64]=R.isPending,e[65]=je,e[66]=be):be=e[66];let we;e[67]!==v.email?(we=v.email&&t.jsx("p",{className:"text-sm text-destructive",children:v.email.message}),e[67]=v.email,e[68]=we):we=e[68];let ye;e[69]!==be||e[70]!==we?(ye=t.jsxs("div",{className:"space-y-2",children:[We,be,we]}),e[69]=be,e[70]=we,e[71]=ye):ye=e[71];let Ge;e[72]===Symbol.for("react.memo_cache_sentinel")?(Ge=t.jsxs(W,{htmlFor:"canEdit",className:"flex items-center gap-2 cursor-pointer",children:[t.jsx(Ue,{className:"h-4 w-4"}),"Allow editing"]}),e[72]=Ge):Ge=e[72];const rt=S?"Can view and edit pet details":"Can only view pet details";let Ne;e[73]!==rt?(Ne=t.jsxs("div",{className:"space-y-0.5",children:[Ge,t.jsx("p",{className:"text-sm text-muted-foreground",children:rt})]}),e[73]=rt,e[74]=Ne):Ne=e[74];let _e;e[75]!==j?(_e=Te=>j("canEdit",Te),e[75]=j,e[76]=_e):_e=e[76];let Se;e[77]!==S||e[78]!==R.isPending||e[79]!==_e?(Se=t.jsx(tt,{id:"canEdit",checked:S,onCheckedChange:_e,disabled:R.isPending}),e[77]=S,e[78]=R.isPending,e[79]=_e,e[80]=Se):Se=e[80];let Ce;e[81]!==Ne||e[82]!==Se?(Ce=t.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[Ne,Se]}),e[81]=Ne,e[82]=Se,e[83]=Ce):Ce=e[83];let ke;e[84]!==o?(ke=o&&t.jsxs(Je,{variant:"destructive",children:[t.jsx(Ie,{className:"h-4 w-4"}),t.jsx(Ze,{children:o})]}),e[84]=o,e[85]=ke):ke=e[85];let Pe;e[86]!==R.isPending?(Pe=R.isPending?t.jsxs(t.Fragment,{children:[t.jsx(ze,{className:"h-4 w-4 animate-spin"}),"Sending invitation..."]}):t.jsxs(t.Fragment,{children:[t.jsx(ht,{className:"h-4 w-4"}),"Send Invitation"]}),e[86]=R.isPending,e[87]=Pe):Pe=e[87];let Ee;e[88]!==R.isPending||e[89]!==Pe?(Ee=t.jsx(K,{type:"submit",className:"w-full gap-2",disabled:R.isPending,children:Pe}),e[88]=R.isPending,e[89]=Pe,e[90]=Ee):Ee=e[90],e[91]!==ve||e[92]!==ye||e[93]!==Ce||e[94]!==ke||e[95]!==Ee?(D=t.jsxs("form",{onSubmit:ve,className:"space-y-4",children:[ye,Ce,ke,Ee]}),e[91]=ve,e[92]=ye,e[93]=Ce,e[94]=ke,e[95]=Ee,e[96]=D):D=e[96],p="space-y-3";let He;e[97]===Symbol.for("react.memo_cache_sentinel")?(He=t.jsx(Oe,{className:"h-4 w-4"}),e[97]=He):He=e[97];const it=se.length>0&&t.jsx(Y,{variant:"secondary",className:"ml-auto",children:se.length});e[98]!==it?(_=t.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[He,"Current Collaborators",it]}),e[98]=it,e[99]=_):_=e[99],T=B?t.jsxs("div",{className:"space-y-2",children:[t.jsx(X,{className:"h-16 w-full"}),t.jsx(X,{className:"h-16 w-full"})]}):se.length===0?t.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No one has access to this pet yet. Send an invitation above."}):t.jsx("div",{className:"space-y-2",children:se.map(Te=>t.jsx(Ma,{collaborator:Te,onRevoke:()=>V.mutate(Te.id),onToggleEdit:xs=>L.mutate({shareId:Te.id,canEdit:xs}),isRevoking:V.isPending,isUpdating:L.isPending},Te.id))}),e[29]=S,e[30]=d,e[31]=o,e[32]=v.email,e[33]=l,e[34]=B,e[35]=i,e[36]=Z,e[37]=r,e[38]=a.name,e[39]=m,e[40]=V,e[41]=j,e[42]=R.isPending,e[43]=L,e[44]=H,e[45]=J,e[46]=p,e[47]=_,e[48]=T,e[49]=w,e[50]=D,e[51]=q,e[52]=z,e[53]=U,e[54]=te}else H=e[44],J=e[45],p=e[46],_=e[47],T=e[48],w=e[49],D=e[50],q=e[51],z=e[52],U=e[53],te=e[54];let fe;e[100]!==p||e[101]!==_||e[102]!==T?(fe=t.jsxs("div",{className:p,children:[_,T]}),e[100]=p,e[101]=_,e[102]=T,e[103]=fe):fe=e[103];let xe;e[104]!==w||e[105]!==D||e[106]!==fe?(xe=t.jsxs("div",{className:w,children:[D,fe]}),e[104]=w,e[105]=D,e[106]=fe,e[107]=xe):xe=e[107];let ge;e[108]!==H||e[109]!==q||e[110]!==z||e[111]!==xe?(ge=t.jsxs(H,{className:q,children:[z,xe]}),e[108]=H,e[109]=q,e[110]=z,e[111]=xe,e[112]=ge):ge=e[112];let Ke;return e[113]!==J||e[114]!==U||e[115]!==te||e[116]!==ge?(Ke=t.jsx(J,{open:U,onOpenChange:te,children:ge}),e[113]=J,e[114]=U,e[115]=te,e[116]=ge,e[117]=Ke):Ke=e[117],Ke}function Da(s){return s.status==="accepted"||s.status==="pending"}function Ra(s){const{shareId:e,canEdit:a}=s;return ka(e,a)}function Ma(s){const e=G.c(27),{collaborator:a,onRevoke:r,onToggleEdit:i,isRevoking:n,isUpdating:o}=s,c=a.shared_user_name||a.shared_user_email||a.shared_with_email,u=a.status==="pending";let m;e[0]!==c?(m=t.jsx("span",{className:"font-medium truncate",children:c}),e[0]=c,e[1]=m):m=e[1];let l;e[2]!==u?(l=u?t.jsxs(Y,{variant:"outline",className:"gap-1 text-xs",children:[t.jsx(wt,{className:"h-3 w-3"}),"Pending"]}):t.jsxs(Y,{variant:"secondary",className:"gap-1 text-xs",children:[t.jsx(yt,{className:"h-3 w-3"}),"Accepted"]}),e[2]=u,e[3]=l):l=e[3];let h;e[4]!==m||e[5]!==l?(h=t.jsxs("div",{className:"flex items-center gap-2",children:[m,l]}),e[4]=m,e[5]=l,e[6]=h):h=e[6];let x;e[7]!==a.can_edit?(x=t.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:a.can_edit?t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Ue,{className:"h-3 w-3"}),"Can edit"]}):t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Le,{className:"h-3 w-3"}),"View only"]})}),e[7]=a.can_edit,e[8]=x):x=e[8];let j;e[9]!==h||e[10]!==x?(j=t.jsxs("div",{className:"flex-1 min-w-0",children:[h,x]}),e[9]=h,e[10]=x,e[11]=j):j=e[11];let g;e[12]!==a.can_edit||e[13]!==u||e[14]!==o||e[15]!==i?(g=!u&&t.jsx(tt,{checked:a.can_edit,onCheckedChange:i,disabled:o,"aria-label":"Toggle edit permission"}),e[12]=a.can_edit,e[13]=u,e[14]=o,e[15]=i,e[16]=g):g=e[16];let v;e[17]===Symbol.for("react.memo_cache_sentinel")?(v=t.jsx(bt,{className:"h-4 w-4"}),e[17]=v):v=e[17];let y;e[18]!==n||e[19]!==r?(y=t.jsx(K,{variant:"ghost",size:"icon",onClick:r,disabled:n,className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:v}),e[18]=n,e[19]=r,e[20]=y):y=e[20];let S;e[21]!==g||e[22]!==y?(S=t.jsxs("div",{className:"flex items-center gap-2",children:[g,y]}),e[21]=g,e[22]=y,e[23]=S):S=e[23];let P;return e[24]!==j||e[25]!==S?(P=t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border bg-card",children:[j,S]}),e[24]=j,e[25]=S,e[26]=P):P=e[26],P}function qa(){const s=G.c(22),e=et();let a;s[0]===Symbol.for("react.memo_cache_sentinel")?(a={queryKey:["pending-invitations"],queryFn:ya},s[0]=a):a=s[0];const{data:r,isLoading:i}=he(a);let n;s[1]!==e?(n={mutationFn:_a,onSuccess:()=>{e.invalidateQueries({queryKey:["pending-invitations"]}),e.invalidateQueries({queryKey:["shared-pets"]}),e.invalidateQueries({queryKey:["pets"]})}},s[1]=e,s[2]=n):n=s[2];const o=oe(n);let c;s[3]!==e?(c={mutationFn:Sa,onSuccess:()=>{e.invalidateQueries({queryKey:["pending-invitations"]})}},s[3]=e,s[4]=c):c=s[4];const u=oe(c);if(i){let g;s[5]===Symbol.for("react.memo_cache_sentinel")?(g=t.jsx(le,{children:t.jsxs(ne,{className:"flex items-center gap-2",children:[t.jsx(ht,{className:"h-5 w-5"}),"Pending Invitations"]})}),s[5]=g):g=s[5];let v;return s[6]===Symbol.for("react.memo_cache_sentinel")?(v=t.jsxs(ee,{children:[g,t.jsx(ie,{children:t.jsx(X,{className:"h-20 w-full"})})]}),s[6]=v):v=s[6],v}if(!r||r.length===0)return null;let m;s[7]===Symbol.for("react.memo_cache_sentinel")?(m=t.jsx(ht,{className:"h-5 w-5 text-primary"}),s[7]=m):m=s[7];let l;s[8]!==r.length?(l=t.jsx(le,{children:t.jsxs(ne,{className:"flex items-center gap-2",children:[m,"Pending Invitations",t.jsx(Y,{variant:"default",className:"ml-auto",children:r.length})]})}),s[8]=r.length,s[9]=l):l=s[9];let h;if(s[10]!==o||s[11]!==u||s[12]!==r){let g;s[14]!==o||s[15]!==u?(g=v=>t.jsx(Aa,{invitation:v,onAccept:()=>o.mutate(v.id),onDecline:()=>u.mutate(v.id),isAccepting:o.isPending,isDeclining:u.isPending},v.id),s[14]=o,s[15]=u,s[16]=g):g=s[16],h=r.map(g),s[10]=o,s[11]=u,s[12]=r,s[13]=h}else h=s[13];let x;s[17]!==h?(x=t.jsx(ie,{className:"space-y-3",children:h}),s[17]=h,s[18]=x):x=s[18];let j;return s[19]!==l||s[20]!==x?(j=t.jsxs(ee,{className:"border-primary/20 bg-primary/5",children:[l,x]}),s[19]=l,s[20]=x,s[21]=j):j=s[21],j}function Aa(s){const e=G.c(36),{invitation:a,onAccept:r,onDecline:i,isAccepting:n,isDeclining:o}=s,c=n||o;let u;e[0]!==a.pet_name?(u=t.jsx("span",{className:"font-semibold",children:a.pet_name}),e[0]=a.pet_name,e[1]=u):u=e[1];let m;e[2]!==a.can_edit?(m=a.can_edit?t.jsxs(Y,{variant:"secondary",className:"gap-1 text-xs",children:[t.jsx(Ue,{className:"h-3 w-3"}),"Can edit"]}):t.jsxs(Y,{variant:"outline",className:"gap-1 text-xs",children:[t.jsx(Le,{className:"h-3 w-3"}),"View only"]}),e[2]=a.can_edit,e[3]=m):m=e[3];let l;e[4]!==u||e[5]!==m?(l=t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[u,m]}),e[4]=u,e[5]=m,e[6]=l):l=e[6];const h=a.owner_name||a.owner_email||"Unknown";let x;e[7]!==h?(x=t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Shared by ",h]}),e[7]=h,e[8]=x):x=e[8];let j;e[9]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx(wt,{className:"h-3 w-3"}),e[9]=j):j=e[9];let g;e[10]!==a.created_at?(g=Jt(new Date(a.created_at),"MMM d, yyyy"),e[10]=a.created_at,e[11]=g):g=e[11];let v;e[12]!==g?(v=t.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[j,g]}),e[12]=g,e[13]=v):v=e[13];let y;e[14]!==l||e[15]!==x||e[16]!==v?(y=t.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[l,x,v]}),e[14]=l,e[15]=x,e[16]=v,e[17]=y):y=e[17];let S;e[18]!==n?(S=n?t.jsx(ze,{className:"h-4 w-4 animate-spin"}):t.jsx(yt,{className:"h-4 w-4"}),e[18]=n,e[19]=S):S=e[19];let P;e[20]!==c||e[21]!==r||e[22]!==S?(P=t.jsxs(K,{size:"sm",onClick:r,disabled:c,className:"gap-1",children:[S,"Accept"]}),e[20]=c,e[21]=r,e[22]=S,e[23]=P):P=e[23];let b;e[24]!==o?(b=o?t.jsx(ze,{className:"h-4 w-4 animate-spin"}):t.jsx(Xt,{className:"h-4 w-4"}),e[24]=o,e[25]=b):b=e[25];let C;e[26]!==c||e[27]!==i||e[28]!==b?(C=t.jsxs(K,{size:"sm",variant:"outline",onClick:i,disabled:c,className:"gap-1",children:[b,"Decline"]}),e[26]=c,e[27]=i,e[28]=b,e[29]=C):C=e[29];let E;e[30]!==P||e[31]!==C?(E=t.jsxs("div",{className:"flex items-center gap-2",children:[P,C]}),e[30]=P,e[31]=C,e[32]=E):E=e[32];let k;return e[33]!==E||e[34]!==y?(k=t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 p-4 rounded-lg border bg-background",children:[y,E]}),e[33]=E,e[34]=y,e[35]=k):k=e[35],k}function Fa(s){const e=G.c(4);let a;e[0]!==s?({...a}=s,e[0]=s,e[1]=a):a=e[1];let r;return e[2]!==a?(r=t.jsx(gs,{"data-slot":"popover",...a}),e[2]=a,e[3]=r):r=e[3],r}function Ia(s){const e=G.c(4);let a;e[0]!==s?({...a}=s,e[0]=s,e[1]=a):a=e[1];let r;return e[2]!==a?(r=t.jsx(vs,{"data-slot":"popover-trigger",...a}),e[2]=a,e[3]=r):r=e[3],r}function Ba(s){const e=G.c(12);let a,r,i,n;e[0]!==s?({className:a,align:i,sideOffset:n,...r}=s,e[0]=s,e[1]=a,e[2]=r,e[3]=i,e[4]=n):(a=e[1],r=e[2],i=e[3],n=e[4]);const o=i===void 0?"center":i,c=n===void 0?4:n;let u;e[5]!==a?(u=de("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",a),e[5]=a,e[6]=u):u=e[6];let m;return e[7]!==o||e[8]!==r||e[9]!==c||e[10]!==u?(m=t.jsx(js,{children:t.jsx(bs,{"data-slot":"popover-content",align:o,sideOffset:c,className:u,...r})}),e[7]=o,e[8]=r,e[9]=c,e[10]=u,e[11]=m):m=e[11],m}var At=1,$a=.9,za=.8,Oa=.17,dt=.1,mt=.999,La=.9999,Ua=.99,Va=/[\\\/_+.#"@\[\(\{&]/,Ka=/[\\\/_+.#"@\[\(\{&]/g,Qa=/[\s-]/,ns=/[\s-]/g;function gt(s,e,a,r,i,n,o){if(n===e.length)return i===s.length?At:Ua;var c=`${i},${n}`;if(o[c]!==void 0)return o[c];for(var u=r.charAt(n),m=a.indexOf(u,i),l=0,h,x,j,g;m>=0;)h=gt(s,e,a,r,m+1,n+1,o),h>l&&(m===i?h*=At:Va.test(s.charAt(m-1))?(h*=za,j=s.slice(i,m-1).match(Ka),j&&i>0&&(h*=Math.pow(mt,j.length))):Qa.test(s.charAt(m-1))?(h*=$a,g=s.slice(i,m-1).match(ns),g&&i>0&&(h*=Math.pow(mt,g.length))):(h*=Oa,i>0&&(h*=Math.pow(mt,m-i))),s.charAt(m)!==e.charAt(n)&&(h*=La)),(h<dt&&a.charAt(m-1)===r.charAt(n+1)||r.charAt(n+1)===r.charAt(n)&&a.charAt(m-1)!==r.charAt(n))&&(x=gt(s,e,a,r,m+1,n+2,o),x*dt>h&&(h=x*dt)),h>l&&(l=h),m=a.indexOf(u,m+1);return o[c]=l,l}function Ft(s){return s.toLowerCase().replace(ns," ")}function Wa(s,e,a){return s=a&&a.length>0?`${s+" "+a.join(" ")}`:s,gt(s,e,Ft(s),Ft(e),0,0,{})}var Fe='[cmdk-group=""]',ut='[cmdk-group-items=""]',Ga='[cmdk-group-heading=""]',ls='[cmdk-item=""]',It=`${ls}:not([aria-disabled="true"])`,vt="cmdk-item-select",Re="data-value",Ha=(s,e,a)=>Wa(s,e,a),os=f.createContext(void 0),Ve=()=>f.useContext(os),cs=f.createContext(void 0),Nt=()=>f.useContext(cs),ds=f.createContext(void 0),ms=f.forwardRef((s,e)=>{let a=Me(()=>{var p,_;return{search:"",value:(_=(p=s.value)!=null?p:s.defaultValue)!=null?_:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),r=Me(()=>new Set),i=Me(()=>new Map),n=Me(()=>new Map),o=Me(()=>new Set),c=us(s),{label:u,children:m,value:l,onValueChange:h,filter:x,shouldFilter:j,loop:g,disablePointerSelection:v=!1,vimBindings:y=!0,...S}=s,P=qe(),b=qe(),C=qe(),E=f.useRef(null),k=nr();pe(()=>{if(l!==void 0){let p=l.trim();a.current.value=p,d.emit()}},[l]),pe(()=>{k(6,R)},[]);let d=f.useMemo(()=>({subscribe:p=>(o.current.add(p),()=>o.current.delete(p)),snapshot:()=>a.current,setState:(p,_,T)=>{var w,D,q,z;if(!Object.is(a.current[p],_)){if(a.current[p]=_,p==="search")$(),A(),k(1,I);else if(p==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let U=document.getElementById(C);U?U.focus():(w=document.getElementById(P))==null||w.focus()}if(k(7,()=>{var U;a.current.selectedItemId=(U=O())==null?void 0:U.id,d.emit()}),T||k(5,R),((D=c.current)==null?void 0:D.value)!==void 0){let U=_??"";(z=(q=c.current).onValueChange)==null||z.call(q,U);return}}d.emit()}},emit:()=>{o.current.forEach(p=>p())}}),[]),B=f.useMemo(()=>({value:(p,_,T)=>{var w;_!==((w=n.current.get(p))==null?void 0:w.value)&&(n.current.set(p,{value:_,keywords:T}),a.current.filtered.items.set(p,M(_,T)),k(2,()=>{A(),d.emit()}))},item:(p,_)=>(r.current.add(p),_&&(i.current.has(_)?i.current.get(_).add(p):i.current.set(_,new Set([p]))),k(3,()=>{$(),A(),a.current.value||I(),d.emit()}),()=>{n.current.delete(p),r.current.delete(p),a.current.filtered.items.delete(p);let T=O();k(4,()=>{$(),T?.getAttribute("id")===p&&I(),d.emit()})}),group:p=>(i.current.has(p)||i.current.set(p,new Set),()=>{n.current.delete(p),i.current.delete(p)}),filter:()=>c.current.shouldFilter,label:u||s["aria-label"],getDisablePointerSelection:()=>c.current.disablePointerSelection,listId:P,inputId:C,labelId:b,listInnerRef:E}),[]);function M(p,_){var T,w;let D=(w=(T=c.current)==null?void 0:T.filter)!=null?w:Ha;return p?D(p,a.current.search,_):0}function A(){if(!a.current.search||c.current.shouldFilter===!1)return;let p=a.current.filtered.items,_=[];a.current.filtered.groups.forEach(w=>{let D=i.current.get(w),q=0;D.forEach(z=>{let U=p.get(z);q=Math.max(U,q)}),_.push([w,q])});let T=E.current;V().sort((w,D)=>{var q,z;let U=w.getAttribute("id"),te=D.getAttribute("id");return((q=p.get(te))!=null?q:0)-((z=p.get(U))!=null?z:0)}).forEach(w=>{let D=w.closest(ut);D?D.appendChild(w.parentElement===D?w:w.closest(`${ut} > *`)):T.appendChild(w.parentElement===T?w:w.closest(`${ut} > *`))}),_.sort((w,D)=>D[1]-w[1]).forEach(w=>{var D;let q=(D=E.current)==null?void 0:D.querySelector(`${Fe}[${Re}="${encodeURIComponent(w[0])}"]`);q?.parentElement.appendChild(q)})}function I(){let p=V().find(T=>T.getAttribute("aria-disabled")!=="true"),_=p?.getAttribute(Re);d.setState("value",_||void 0)}function $(){var p,_,T,w;if(!a.current.search||c.current.shouldFilter===!1){a.current.filtered.count=r.current.size;return}a.current.filtered.groups=new Set;let D=0;for(let q of r.current){let z=(_=(p=n.current.get(q))==null?void 0:p.value)!=null?_:"",U=(w=(T=n.current.get(q))==null?void 0:T.keywords)!=null?w:[],te=M(z,U);a.current.filtered.items.set(q,te),te>0&&D++}for(let[q,z]of i.current)for(let U of z)if(a.current.filtered.items.get(U)>0){a.current.filtered.groups.add(q);break}a.current.filtered.count=D}function R(){var p,_,T;let w=O();w&&(((p=w.parentElement)==null?void 0:p.firstChild)===w&&((T=(_=w.closest(Fe))==null?void 0:_.querySelector(Ga))==null||T.scrollIntoView({block:"nearest"})),w.scrollIntoView({block:"nearest"}))}function O(){var p;return(p=E.current)==null?void 0:p.querySelector(`${ls}[aria-selected="true"]`)}function V(){var p;return Array.from(((p=E.current)==null?void 0:p.querySelectorAll(It))||[])}function N(p){let _=V()[p];_&&d.setState("value",_.getAttribute(Re))}function L(p){var _;let T=O(),w=V(),D=w.findIndex(z=>z===T),q=w[D+p];(_=c.current)!=null&&_.loop&&(q=D+p<0?w[w.length-1]:D+p===w.length?w[0]:w[D+p]),q&&d.setState("value",q.getAttribute(Re))}function Q(p){let _=O(),T=_?.closest(Fe),w;for(;T&&!w;)T=p>0?rr(T,Fe):ir(T,Fe),w=T?.querySelector(It);w?d.setState("value",w.getAttribute(Re)):L(p)}let Z=()=>N(V().length-1),H=p=>{p.preventDefault(),p.metaKey?Z():p.altKey?Q(1):L(1)},J=p=>{p.preventDefault(),p.metaKey?N(0):p.altKey?Q(-1):L(-1)};return f.createElement(ue.div,{ref:e,tabIndex:-1,...S,"cmdk-root":"",onKeyDown:p=>{var _;(_=S.onKeyDown)==null||_.call(S,p);let T=p.nativeEvent.isComposing||p.keyCode===229;if(!(p.defaultPrevented||T))switch(p.key){case"n":case"j":{y&&p.ctrlKey&&H(p);break}case"ArrowDown":{H(p);break}case"p":case"k":{y&&p.ctrlKey&&J(p);break}case"ArrowUp":{J(p);break}case"Home":{p.preventDefault(),N(0);break}case"End":{p.preventDefault(),Z();break}case"Enter":{p.preventDefault();let w=O();if(w){let D=new Event(vt);w.dispatchEvent(D)}}}}},f.createElement("label",{"cmdk-label":"",htmlFor:B.inputId,id:B.labelId,style:or},u),at(s,p=>f.createElement(cs.Provider,{value:d},f.createElement(os.Provider,{value:B},p))))}),Ya=f.forwardRef((s,e)=>{var a,r;let i=qe(),n=f.useRef(null),o=f.useContext(ds),c=Ve(),u=us(s),m=(r=(a=u.current)==null?void 0:a.forceMount)!=null?r:o?.forceMount;pe(()=>{if(!m)return c.item(i,o?.id)},[m]);let l=hs(i,n,[s.value,s.children,n],s.keywords),h=Nt(),x=me(k=>k.value&&k.value===l.current),j=me(k=>m||c.filter()===!1?!0:k.search?k.filtered.items.get(i)>0:!0);f.useEffect(()=>{let k=n.current;if(!(!k||s.disabled))return k.addEventListener(vt,g),()=>k.removeEventListener(vt,g)},[j,s.onSelect,s.disabled]);function g(){var k,d;v(),(d=(k=u.current).onSelect)==null||d.call(k,l.current)}function v(){h.setState("value",l.current,!0)}if(!j)return null;let{disabled:y,value:S,onSelect:P,forceMount:b,keywords:C,...E}=s;return f.createElement(ue.div,{ref:Be(n,e),...E,id:i,"cmdk-item":"",role:"option","aria-disabled":!!y,"aria-selected":!!x,"data-disabled":!!y,"data-selected":!!x,onPointerMove:y||c.getDisablePointerSelection()?void 0:v,onClick:y?void 0:g},s.children)}),Xa=f.forwardRef((s,e)=>{let{heading:a,children:r,forceMount:i,...n}=s,o=qe(),c=f.useRef(null),u=f.useRef(null),m=qe(),l=Ve(),h=me(j=>i||l.filter()===!1?!0:j.search?j.filtered.groups.has(o):!0);pe(()=>l.group(o),[]),hs(o,c,[s.value,s.heading,u]);let x=f.useMemo(()=>({id:o,forceMount:i}),[i]);return f.createElement(ue.div,{ref:Be(c,e),...n,"cmdk-group":"",role:"presentation",hidden:h?void 0:!0},a&&f.createElement("div",{ref:u,"cmdk-group-heading":"","aria-hidden":!0,id:m},a),at(s,j=>f.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?m:void 0},f.createElement(ds.Provider,{value:x},j))))}),Ja=f.forwardRef((s,e)=>{let{alwaysRender:a,...r}=s,i=f.useRef(null),n=me(o=>!o.search);return!a&&!n?null:f.createElement(ue.div,{ref:Be(i,e),...r,"cmdk-separator":"",role:"separator"})}),Za=f.forwardRef((s,e)=>{let{onValueChange:a,...r}=s,i=s.value!=null,n=Nt(),o=me(m=>m.search),c=me(m=>m.selectedItemId),u=Ve();return f.useEffect(()=>{s.value!=null&&n.setState("search",s.value)},[s.value]),f.createElement(ue.input,{ref:e,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":u.listId,"aria-labelledby":u.labelId,"aria-activedescendant":c,id:u.inputId,type:"text",value:i?s.value:o,onChange:m=>{i||n.setState("search",m.target.value),a?.(m.target.value)}})}),er=f.forwardRef((s,e)=>{let{children:a,label:r="Suggestions",...i}=s,n=f.useRef(null),o=f.useRef(null),c=me(m=>m.selectedItemId),u=Ve();return f.useEffect(()=>{if(o.current&&n.current){let m=o.current,l=n.current,h,x=new ResizeObserver(()=>{h=requestAnimationFrame(()=>{let j=m.offsetHeight;l.style.setProperty("--cmdk-list-height",j.toFixed(1)+"px")})});return x.observe(m),()=>{cancelAnimationFrame(h),x.unobserve(m)}}},[]),f.createElement(ue.div,{ref:Be(n,e),...i,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":c,"aria-label":r,id:u.listId},at(s,m=>f.createElement("div",{ref:Be(o,u.listInnerRef),"cmdk-list-sizer":""},m)))}),tr=f.forwardRef((s,e)=>{let{open:a,onOpenChange:r,overlayClassName:i,contentClassName:n,container:o,...c}=s;return f.createElement(ws,{open:a,onOpenChange:r},f.createElement(ys,{container:o},f.createElement(Ns,{"cmdk-overlay":"",className:i}),f.createElement(_s,{"aria-label":s.label,"cmdk-dialog":"",className:n},f.createElement(ms,{ref:e,...c}))))}),sr=f.forwardRef((s,e)=>me(a=>a.filtered.count===0)?f.createElement(ue.div,{ref:e,...s,"cmdk-empty":"",role:"presentation"}):null),ar=f.forwardRef((s,e)=>{let{progress:a,children:r,label:i="Loading...",...n}=s;return f.createElement(ue.div,{ref:e,...n,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":i},at(s,o=>f.createElement("div",{"aria-hidden":!0},o)))}),Ae=Object.assign(ms,{List:er,Item:Ya,Input:Za,Group:Xa,Separator:Ja,Dialog:tr,Empty:sr,Loading:ar});function rr(s,e){let a=s.nextElementSibling;for(;a;){if(a.matches(e))return a;a=a.nextElementSibling}}function ir(s,e){let a=s.previousElementSibling;for(;a;){if(a.matches(e))return a;a=a.previousElementSibling}}function us(s){let e=f.useRef(s);return pe(()=>{e.current=s}),e}var pe=typeof window>"u"?f.useEffect:f.useLayoutEffect;function Me(s){let e=f.useRef();return e.current===void 0&&(e.current=s()),e}function me(s){let e=Nt(),a=()=>s(e.snapshot());return f.useSyncExternalStore(e.subscribe,a,a)}function hs(s,e,a,r=[]){let i=f.useRef(),n=Ve();return pe(()=>{var o;let c=(()=>{var m;for(let l of a){if(typeof l=="string")return l.trim();if(typeof l=="object"&&"current"in l)return l.current?(m=l.current.textContent)==null?void 0:m.trim():i.current}})(),u=r.map(m=>m.trim());n.value(s,c,u),(o=e.current)==null||o.setAttribute(Re,c),i.current=c}),i}var nr=()=>{let[s,e]=f.useState(),a=Me(()=>new Map);return pe(()=>{a.current.forEach(r=>r()),a.current=new Map},[s]),(r,i)=>{a.current.set(r,i),e({})}};function lr(s){let e=s.type;return typeof e=="function"?e(s.props):"render"in e?e.render(s.props):s}function at({asChild:s,children:e},a){return s&&f.isValidElement(e)?f.cloneElement(lr(e),{ref:e.ref},a(e.props.children)):a(e)}var or={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};function cr(s){const e=G.c(8);let a,r;e[0]!==s?({className:a,...r}=s,e[0]=s,e[1]=a,e[2]=r):(a=e[1],r=e[2]);let i;e[3]!==a?(i=de("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",a),e[3]=a,e[4]=i):i=e[4];let n;return e[5]!==r||e[6]!==i?(n=t.jsx(Ae,{"data-slot":"command",className:i,...r}),e[5]=r,e[6]=i,e[7]=n):n=e[7],n}function dr(s){const e=G.c(9);let a,r;e[0]!==s?({className:a,...r}=s,e[0]=s,e[1]=a,e[2]=r):(a=e[1],r=e[2]);let i;e[3]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx($s,{className:"size-4 shrink-0 opacity-50"}),e[3]=i):i=e[3];let n;e[4]!==a?(n=de("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",a),e[4]=a,e[5]=n):n=e[5];let o;return e[6]!==r||e[7]!==n?(o=t.jsxs("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[i,t.jsx(Ae.Input,{"data-slot":"command-input",className:n,...r})]}),e[6]=r,e[7]=n,e[8]=o):o=e[8],o}function mr(s){const e=G.c(8);let a,r;e[0]!==s?({className:a,...r}=s,e[0]=s,e[1]=a,e[2]=r):(a=e[1],r=e[2]);let i;e[3]!==a?(i=de("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",a),e[3]=a,e[4]=i):i=e[4];let n;return e[5]!==r||e[6]!==i?(n=t.jsx(Ae.List,{"data-slot":"command-list",className:i,...r}),e[5]=r,e[6]=i,e[7]=n):n=e[7],n}function ur(s){const e=G.c(4);let a;e[0]!==s?({...a}=s,e[0]=s,e[1]=a):a=e[1];let r;return e[2]!==a?(r=t.jsx(Ae.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...a}),e[2]=a,e[3]=r):r=e[3],r}function hr(s){const e=G.c(8);let a,r;e[0]!==s?({className:a,...r}=s,e[0]=s,e[1]=a,e[2]=r):(a=e[1],r=e[2]);let i;e[3]!==a?(i=de("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",a),e[3]=a,e[4]=i):i=e[4];let n;return e[5]!==r||e[6]!==i?(n=t.jsx(Ae.Group,{"data-slot":"command-group",className:i,...r}),e[5]=r,e[6]=i,e[7]=n):n=e[7],n}function pr(s){const e=G.c(8);let a,r;e[0]!==s?({className:a,...r}=s,e[0]=s,e[1]=a,e[2]=r):(a=e[1],r=e[2]);let i;e[3]!==a?(i=de("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",a),e[3]=a,e[4]=i):i=e[4];let n;return e[5]!==r||e[6]!==i?(n=t.jsx(Ae.Item,{"data-slot":"command-item",className:i,...r}),e[5]=r,e[6]=i,e[7]=n):n=e[7],n}const ps=[{name:"Golden Retriever",defaultColors:["Golden"]},{name:"Labrador Retriever",defaultColors:["Yellow","Black","Chocolate"]},{name:"German Shepherd",defaultColors:["Black/Tan","Sable","Black"]},{name:"French Bulldog",defaultColors:["Fawn","Brindle","Cream","Pied"]},{name:"Poodle",defaultColors:["White","Black","Apricot","Red"]},{name:"Bulldog",defaultColors:["Fawn","Brindle","White","Piebald"]},{name:"Beagle",defaultColors:["Tri-color","Lemon/White","Red/White"]},{name:"Rottweiler",defaultColors:["Black/Rust"]},{name:"Dachshund",defaultColors:["Red","Black/Tan","Chocolate/Tan","Dapple"]},{name:"Yorkshire Terrier",defaultColors:["Blue/Tan"]}],fs=[{name:"Bicolor / Tuxedo",defaultColors:["Black/White","Gray/White","Seal/White"]},{name:"Calico",defaultColors:["Black/Orange/White","Dilute (Blue/Cream/White)"]},{name:"Pointed",defaultColors:["Seal point","Blue point","Chocolate point","Lilac point","Flame point"]},{name:"Shaded",defaultColors:["Shaded Silver","Shaded Golden"]},{name:"Smoke",defaultColors:["Black Smoke","Blue Smoke"]},{name:"Solid",defaultColors:["Black","White","Blue/Gray","Red/Orange","Cream"]},{name:"Spotted",defaultColors:["Brown Spotted","Silver Spotted"]},{name:"Tabby",defaultColors:["Brown Tabby","Gray/Blue Tabby","Orange Tabby","Silver Tabby","Torbie"]},{name:"Tortoiseshell (Tortie)",defaultColors:["Black/Orange","Chocolate/Cream","Dilute (Blue/Cream)"]}];function fr(s,e){return!s||!e?[]:s==="dog"?ps.find(r=>r.name===e)?.defaultColors??[]:s==="cat"?fs.find(r=>r.name===e)?.defaultColors??[]:[]}const xr=ps.map(s=>s.name),gr=fs.map(s=>s.name);function vr({label:s="Photo",value:e,onChange:a,options:r,accept:i="image/*",className:n}){const o=f.useRef(null),[c,u]=f.useState(!1),[m,l]=f.useState(!1),[h,x]=f.useState(null),j=f.useCallback(()=>{o.current?.click()},[]),g=f.useCallback(()=>{a(null),x(null)},[a]),v=f.useCallback(async b=>{if(!b||!b.type.startsWith("image/")){x("Please select a valid image file");return}if(b.size>10*1024*1024){x("File size must be less than 10MB");return}x(null),u(!0);try{const C=await jr(b,r);a(C)}catch(C){x("Failed to optimize image. Please try another file."),console.error("Image optimization error:",C)}finally{u(!1)}},[r,a]),y=f.useCallback(b=>{b.preventDefault(),b.stopPropagation(),l(!0)},[]),S=f.useCallback(b=>{b.preventDefault(),b.stopPropagation(),l(!1)},[]),P=f.useCallback(b=>{b.preventDefault(),b.stopPropagation(),l(!1);const C=b.dataTransfer.files?.[0];C&&v(C)},[v]);return t.jsxs("div",{className:n,children:[t.jsx(W,{className:"mb-2 block font-medium",children:s}),e?t.jsx("div",{className:"border rounded-lg p-4 bg-card",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"relative group shrink-0",children:t.jsx("img",{src:e.dataUrl,alt:"preview",className:"h-24 w-24 rounded-lg object-cover border border-border"})}),t.jsxs("div",{className:"flex-1 min-w-0 space-y-3",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"font-medium text-sm truncate",children:e.original.name}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.width," x ",e.height,"px"]})]}),t.jsx(K,{type:"button",variant:"ghost",size:"sm",onClick:g,className:"h-8 w-8 p-0 shrink-0",children:t.jsx(Xt,{className:"h-4 w-4"})})]}),t.jsx(K,{type:"button",variant:"outline",size:"sm",onClick:j,className:"w-full",children:"Replace Image"})]})]})}):t.jsx("div",{onDragOver:y,onDragLeave:S,onDrop:P,onClick:j,className:`
            relative border-2 border-dashed rounded-lg p-8 transition-all cursor-pointer
            hover:border-primary/50 hover:bg-accent/50
            ${m?"border-primary bg-accent scale-[1.02]":"border-border"}
            ${c?"pointer-events-none opacity-60":""}
          `,children:t.jsx("div",{className:"flex flex-col items-center justify-center text-center space-y-3",children:c?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"}),t.jsx("p",{className:"text-sm font-medium",children:"Optimizing image..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"rounded-full bg-primary/10 p-3",children:t.jsx(zs,{className:"h-6 w-6 text-primary"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium mb-1",children:"Drop your image here, or click to browse"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG, WebP up to 10MB"})]})]})})}),h&&t.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-900 rounded-md px-3 py-2",children:h}),t.jsx(re,{ref:o,type:"file",accept:i,className:"hidden",onChange:b=>{const C=b.target.files?.[0];C&&v(C),b.currentTarget.value=""}})]})}async function jr(s,e){const a=await s.arrayBuffer(),r=new Blob([a]),i=await wr(r),n=e?.maxWidth??1200,o=e?.maxHeight??1200,{width:c,height:u}=br(i.width,i.height,n,o),m=document.createElement("canvas");m.width=c,m.height=u;const l=m.getContext("2d",{alpha:!0});l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(i,0,0,c,u);const h=e?.preferWebP??!0,x=e?.quality??.82,j=m.toDataURL("image/webp").startsWith("data:image/webp"),g=h&&j?"image/webp":"image/jpeg",v=await yr(m,g,x),y=await Nr(v);return{blob:v,dataUrl:y,width:c,height:u,approxKB:Math.round(v.size/1024),mimeType:g,original:{name:s.name,sizeKB:Math.round(s.size/1024),type:s.type}}}function br(s,e,a,r){const i=Math.min(a/s,r/e,1);return{width:Math.round(s*i),height:Math.round(e*i)}}function wr(s){return new Promise((e,a)=>{const r=URL.createObjectURL(s),i=new Image;i.onload=()=>{URL.revokeObjectURL(r),e(i)},i.onerror=()=>{URL.revokeObjectURL(r),a(new Error("Failed to load image"))},i.src=r})}function yr(s,e,a){return new Promise((r,i)=>{s.toBlob(n=>{n?r(n):i(new Error("Canvas to blob conversion failed"))},e,a)})}function Nr(s){return new Promise((e,a)=>{const r=new FileReader;r.onload=()=>e(String(r.result)),r.onerror=()=>a(new Error("Failed to read blob")),r.readAsDataURL(s)})}function _r(s){const[e,a]=f.useState(nt),[r,i]=f.useState(!0);return f.useEffect(()=>{if(!s){i(!1);return}(async()=>{try{const{data:u,error:m}=await F.from("pet_themes").select("theme_preset, custom_colors, background_image_url").eq("pet_id",s).maybeSingle();if(m)throw m;a(u?u.theme_preset:nt)}catch(u){console.error("Failed to load pet theme:",u),a(nt)}finally{i(!1)}})()},[s]),{themeId:e,isLoading:r,updatePetTheme:async c=>{if(s){a(c);try{const{error:u}=await F.from("pet_themes").upsert({pet_id:s,theme_preset:c,updated_at:new Date().toISOString()});if(u)throw u}catch(u){console.error("Failed to save pet theme:",u)}}},applyPetTheme:(c=!1)=>{Ss(e,c)}}}const Sr=xt({id:ae().optional(),name:ae().min(1,"Name is required"),species:Pt(["dog","cat","other"],{message:"Choose a species"}),breed:ae().optional(),color:ae().optional(),weight:Xs([Js().min(0,"Weight must be positive"),Zs(),ea()]).transform(s=>typeof s=="number"&&!isNaN(s)?s:void 0).optional(),birthdate:ae().optional(),microchipId:ae().optional(),description:ae().optional(),notes:ae().optional(),vaccinations:xt({rabies:es().default(!1),rabiesExpires:ae().optional()}).default({rabies:!1,rabiesExpires:""}),photoPreview:ae().optional(),environment:Pt(["indoor","outdoor","indoor_outdoor"]).default("indoor_outdoor")});async function Bt(s){return await(await fetch(s)).blob()}function $t({mode:s,open:e,onOpenChange:a,initialPet:r,onSubmit:i}){const{user:n}=jt(),[o,c]=f.useState(!1),{data:u,update:m}=Ot(),l=zt({resolver:Zt(Sr),defaultValues:{id:r?.id,name:r?.name??"",species:r?.species,breed:r?.breed??"",color:r?.color??"",weight:r?.weight??void 0,birthdate:r?.birthdate??"",microchipId:r?.microchipId??"",description:r?.description??"",notes:r?.notes??"",vaccinations:{rabies:r?.vaccinations?.rabies??!1,rabiesExpires:r?.vaccinations?.rabiesExpires??""},photoPreview:r?.photoPreview??"",environment:r?.environment??"indoor_outdoor"},mode:"onSubmit"}),h=l.watch("species"),x=l.watch("breed"),[j,g]=f.useState(!1),{themeId:v,updatePetTheme:y}=_r(r?.id),[S,P]=f.useState(v);f.useEffect(()=>{P(v)},[v]);const b=f.useRef(null),C=f.useMemo(()=>h==="dog"?xr:h==="cat"?gr:[],[h]),E=f.useMemo(()=>fr(h??"other",x),[h,x]),k=async d=>{if(!n?.id){alert("You must be signed in.");return}c(!0);const B={rabies:!!d.vaccinations?.rabies,rabiesExpires:d.vaccinations?.rabies&&d.vaccinations.rabiesExpires||void 0},M={owner_id:n.id,name:d.name,species:d.species,breed:d.breed||null,color:d.color||null,weight:typeof d.weight=="number"?d.weight:null,birthdate:d.birthdate||null,microchip_id:d.microchipId||null,description:d.description||null,notes:d.notes||null,vaccinations:B,environment:d.environment};try{let A;if(s==="add"){A=await na({...M});let I=b.current;if(!I&&d.photoPreview&&(I=await Bt(d.photoPreview)),I&&I.size>0){const $=await qt(n.id,A.id,I);A=await Mt(A.id,{photo_url:$})}}else{const I=d.id||r?.id;if(!I)throw new Error("Missing pet id for update.");let $=b.current;!$&&d.photoPreview&&($=await Bt(d.photoPreview));const R={name:M.name,species:M.species,breed:M.breed,color:M.color,weight:M.weight,birthdate:M.birthdate,microchip_id:M.microchip_id,description:M.description,notes:M.notes,vaccinations:M.vaccinations,environment:M.environment};if($&&$.size>0){const O=await qt(n.id,I,$);R.photo_url=O}A=await Mt(I,R)}A?.id&&await y(S),s==="add"&&u?.has_created_first_pet===!1&&await m.mutateAsync({has_created_first_pet:!0}),i?.(d),a(!1),s==="add"&&l.reset()}catch(A){console.error(A),alert(A?.message??"Failed to save pet")}finally{c(!1)}};return t.jsx(rs,{open:e,onOpenChange:d=>!o&&a(d),children:t.jsxs(is,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[t.jsx(ts,{className:"space-y-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center ring-4 ring-primary/5",children:t.jsx(ce,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx(ss,{className:"text-2xl",children:s==="add"?"Add New Pet":"Edit Pet"}),t.jsx(as,{className:"text-base",children:s==="add"?"Enter your pet's details to create their profile":"Update your pet's information"})]})]})}),t.jsxs("form",{onSubmit:l.handleSubmit(k),className:"space-y-6 mt-4",children:[t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[t.jsx(pt,{className:"h-4 w-4 text-primary"}),"Basic Information"]}),t.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-primary/20",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(W,{htmlFor:"name",className:"text-sm font-medium flex items-center gap-2",children:["Name ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(re,{id:"name",...l.register("name"),placeholder:"e.g., Milo, Luna, Max",className:"h-11 transition-all duration-200 focus:ring-2 focus:ring-primary/20"}),l.formState.errors.name&&t.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1.5 animate-in fade-in-50",children:[t.jsx(Ie,{className:"h-3.5 w-3.5"}),l.formState.errors.name.message]})]}),t.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(W,{className:"text-sm font-medium flex items-center gap-2",children:["Species ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsxs(Et,{value:h,onValueChange:d=>{l.setValue("species",d,{shouldValidate:!0}),l.setValue("breed",""),l.setValue("color","")},children:[t.jsx(Tt,{className:"h-11",children:t.jsx(Dt,{placeholder:"Select species"})}),t.jsxs(Rt,{children:[t.jsx(De,{value:"dog",children:"🐕 Dog"}),t.jsx(De,{value:"cat",children:"🐱 Cat"}),t.jsx(De,{value:"other",children:"🐾 Other"})]})]}),l.formState.errors.species&&t.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1.5",children:[t.jsx(Ie,{className:"h-3.5 w-3.5"}),l.formState.errors.species.message]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(W,{htmlFor:"birthdate",className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(Os,{className:"h-3.5 w-3.5"}),"Birthdate"]}),t.jsx(re,{id:"birthdate",type:"date",...l.register("birthdate"),className:"h-11"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(W,{className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(ce,{className:"h-3.5 w-3.5"}),h==="cat"?"Pattern":"Breed",h==="other"&&t.jsx("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(re,{placeholder:h==="dog"?"e.g., Golden Retriever":h==="cat"?"e.g., Tabby, Calico":"e.g., Rabbit, Guinea Pig",...l.register("breed"),className:"h-11 flex-1"}),C.length>0&&t.jsxs(Fa,{open:j,onOpenChange:g,children:[t.jsx(Ia,{asChild:!0,children:t.jsxs(K,{type:"button",variant:"outline",className:"w-36 justify-between h-11",children:["Suggestions ",t.jsx(Ls,{className:"h-4 w-4 opacity-60"})]})}),t.jsx(Ba,{className:"p-0 w-64",children:t.jsxs(cr,{children:[t.jsx(dr,{placeholder:"Search…"}),t.jsxs(mr,{children:[t.jsx(ur,{children:"No matches found."}),t.jsx(hr,{children:C.map(d=>t.jsx(pr,{value:d,onSelect:B=>{l.setValue("breed",B),g(!1)},children:d},d))})]})]})})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(W,{htmlFor:"color",className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(Ct,{className:"h-3.5 w-3.5"}),"Color"]}),t.jsx(re,{id:"color",...l.register("color"),placeholder:"e.g., Brown, White, Mixed",className:"h-11"}),E.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:E.map(d=>t.jsx("button",{type:"button",onClick:()=>l.setValue("color",d,{shouldValidate:!0}),className:"rounded-full border border-primary/20 bg-primary/5 px-3 py-1 text-xs font-medium hover:bg-primary/10 transition-colors",children:d},d))})]}),t.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(W,{htmlFor:"weight",className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(Us,{className:"h-3.5 w-3.5"}),"Weight (lbs)"]}),t.jsx(re,{id:"weight",type:"number",step:"0.1",placeholder:"e.g., 45.5",...l.register("weight",{valueAsNumber:!0}),className:"h-11"}),l.formState.errors.weight&&t.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1.5",children:[t.jsx(Ie,{className:"h-3.5 w-3.5"}),l.formState.errors.weight.message]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(W,{htmlFor:"microchipId",className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(Vs,{className:"h-3.5 w-3.5"}),"Microchip ID"]}),t.jsx(re,{id:"microchipId",...l.register("microchipId"),placeholder:"e.g., 981000012345678",className:"h-11"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(W,{className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(Ks,{className:"h-3.5 w-3.5"}),"Pet Environment"]}),t.jsxs(Et,{value:l.watch("environment"),onValueChange:d=>{l.setValue("environment",d,{shouldValidate:!0})},children:[t.jsx(Tt,{className:"h-11",children:t.jsx(Dt,{placeholder:"Select environment"})}),t.jsxs(Rt,{children:[t.jsx(De,{value:"indoor",children:"🏠 Indoor Only"}),t.jsx(De,{value:"outdoor",children:"🌳 Outdoor Only"}),t.jsx(De,{value:"indoor_outdoor",children:"🏡 Indoor & Outdoor"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(W,{htmlFor:"description",className:"text-sm font-medium",children:"Physical Description"}),t.jsx(re,{id:"description",...l.register("description"),placeholder:"e.g., White paws, brown spot on left ear",className:"h-11"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(W,{htmlFor:"notes",className:"text-sm font-medium",children:"Additional Notes"}),t.jsx(sa,{id:"notes",...l.register("notes"),placeholder:"Allergies, medications, behavioral notes, vet contact info...",className:"min-h-[80px] resize-none"})]})]})]}),t.jsx(ct,{}),t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[t.jsx(Qs,{className:"h-4 w-4 text-primary"}),"Vaccinations"]}),t.jsxs("div",{className:"space-y-3 pl-6 border-l-2 border-primary/20",children:[t.jsx(Je,{className:"border-blue-200 bg-blue-50 dark:border-blue-900 dark:bg-blue-950",children:t.jsx(Ze,{className:"text-xs text-blue-800 dark:text-blue-200",children:"Keep track of your pet's vaccination records for their health and safety"})}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 bg-secondary/30 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[t.jsx("input",{id:"rabies",type:"checkbox",className:"h-4 w-4 rounded border-primary text-primary focus:ring-primary",checked:!!l.watch("vaccinations.rabies"),onChange:d=>l.setValue("vaccinations.rabies",d.target.checked)}),t.jsx(W,{htmlFor:"rabies",className:"text-sm font-medium cursor-pointer",children:"Rabies Vaccination"})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:w-48",children:[t.jsx(W,{htmlFor:"rabiesExpires",className:"text-xs text-muted-foreground whitespace-nowrap",children:"Expires:"}),t.jsx(re,{id:"rabiesExpires",type:"date",disabled:!l.watch("vaccinations.rabies"),...l.register("vaccinations.rabiesExpires"),className:"h-9"})]})]})]})]}),t.jsx(ct,{}),t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[t.jsx(Ct,{className:"h-4 w-4 text-primary"}),"Page Theme"]}),t.jsxs("div",{className:"pl-6 border-l-2 border-primary/20",children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Choose a color theme for your pet's public page"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Object.values(Cs).map(d=>t.jsxs("button",{type:"button",onClick:()=>P(d.id),className:de("relative p-3 rounded-lg border-2 transition-all hover:scale-105",S===d.id?"border-primary shadow-md":"border-border hover:border-primary/50"),children:[t.jsx("div",{className:de("h-16 rounded-md mb-2 bg-gradient-to-br",d.previewGradient)}),t.jsx("p",{className:"text-xs font-medium text-center",children:d.name}),S===d.id&&t.jsx("div",{className:"absolute top-2 right-2 h-5 w-5 bg-primary rounded-full flex items-center justify-center",children:t.jsx(yt,{className:"h-3 w-3 text-primary-foreground"})})]},d.id))})]})]}),t.jsx(ct,{}),t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[t.jsx(Ws,{className:"h-4 w-4 text-primary"}),"Pet Photo"]}),t.jsx("div",{className:"pl-6 border-l-2 border-primary/20",children:t.jsx(vr,{label:"",value:l.watch("photoPreview")?{blob:new Blob,dataUrl:l.watch("photoPreview"),width:0,height:0,approxKB:0,mimeType:"image/*",original:{name:"",sizeKB:0,type:""}}:null,onChange:d=>{b.current=d?.blob??null,l.setValue("photoPreview",d?.dataUrl??"")},options:{maxWidth:1200,maxHeight:1200,quality:.82,preferWebP:!0}})})]}),t.jsxs(ta,{className:"gap-2 sm:gap-0 pt-4",children:[t.jsx(K,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:o,className:"transition-all hover:scale-105",children:"Cancel"}),t.jsx(K,{type:"submit",disabled:o,className:"transition-all hover:scale-105",children:o?t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s==="add"?"Creating...":"Updating..."]}):t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(ce,{className:"h-4 w-4"}),s==="add"?"Create Pet Profile":"Save Changes"]})})]})]})]})})}function ni(){const{user:s}=jt(),e=et(),a=s?.id??null,{data:r}=Ot(),{data:i,isLoading:n,isError:o}=he({queryKey:["pets",a],queryFn:async()=>a?la(a):[],enabled:!!a,staleTime:3e4}),{data:c,isLoading:u}=he({queryKey:["shared-pets"],queryFn:Na,enabled:!!a,staleTime:3e4}),[m,l]=f.useState(!1),[h,x]=f.useState(null),[j,g]=f.useState(null),[v,y]=f.useState(null),[S,P]=f.useState(null),[b,C]=f.useState(null),[E,k]=f.useState(!1),[d,B]=f.useState(!1);f.useEffect(()=>{if(!r||!i||n||d)return;const N=i.length===0,L=r.has_created_first_pet===!1;N&&L&&!m&&l(!0)},[r,i,n,m,d]);const M=N=>{const Q=`${window.location.origin}/p/${N.short_id}`;window.open(Q,"_blank")},A=async()=>{await e.invalidateQueries({queryKey:["pets",a]}),await e.invalidateQueries({queryKey:["shared-pets"]}),await e.invalidateQueries({queryKey:["profile",a]}),x(null),l(!1)},I=N=>{l(N),!N&&r?.has_created_first_pet===!1&&(!i||i.length===0)&&B(!0)},$=async()=>{await e.invalidateQueries({queryKey:["pets",a]}),g(null)},R=oe({mutationFn:async({id:N,missing:L})=>da(N,L),onSuccess:async()=>{await e.invalidateQueries({queryKey:["pets",a]}),await e.invalidateQueries({queryKey:["shared-pets"]})}}),O=async(N,L)=>{if(L)C(N);else try{k(!0),await R.mutateAsync({id:N.id,missing:!1})}catch(Q){alert(Q?.message??"Failed to update")}finally{k(!1)}},V=async()=>{if(b)try{k(!0),await R.mutateAsync({id:b.id,missing:!0})}catch(N){alert(N?.message??"Failed to update")}finally{k(!1),C(null)}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[t.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center ring-4 ring-primary/5",children:t.jsx(ce,{className:"h-5 w-5 text-primary"})}),"Dashboard"]}),t.jsx("p",{className:"text-muted-foreground",children:"Manage your pets, QR codes, and track activity"})]}),t.jsx(qa,{}),d&&r?.has_created_first_pet===!1&&(!i||i.length===0)&&t.jsxs(Je,{className:"border-primary/30 bg-primary/5 animate-in fade-in-50 slide-in-from-top-5",children:[t.jsx(pt,{className:"h-4 w-4 text-primary"}),t.jsxs(Ze,{className:"flex items-center justify-between gap-4",children:[t.jsx("span",{className:"text-sm",children:"Ready to get started? Create your first pet profile to activate your QR tag"}),t.jsxs(K,{size:"sm",onClick:()=>{B(!1),l(!0)},className:"gap-2 shrink-0",children:[t.jsx(ot,{className:"h-3.5 w-3.5"}),"Add Pet"]})]})]}),t.jsxs(ks,{defaultValue:"pets",className:"space-y-4",children:[t.jsxs(Ps,{className:"grid w-full max-w-3xl grid-cols-4",children:[t.jsxs(Ye,{value:"pets",className:"gap-2",children:[t.jsx(ce,{className:"h-4 w-4"}),"My Pets"]}),t.jsxs(Ye,{value:"shared",className:"gap-2",children:[t.jsx(ft,{className:"h-4 w-4"}),"Shared",c&&c.length>0&&t.jsx(Y,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:c.length})]}),t.jsxs(Ye,{value:"locations",className:"gap-2",children:[t.jsx(kt,{className:"h-4 w-4"}),"Locations"]}),t.jsxs(Ye,{value:"activity",className:"gap-2",children:[t.jsx(kt,{className:"h-4 w-4"}),"Activity"]})]}),t.jsxs(Xe,{value:"pets",className:"space-y-4",children:[t.jsxs(ee,{className:"shadow-lg border-primary/10",children:[t.jsx(le,{className:"space-y-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs(ne,{className:"text-2xl flex items-center gap-2",children:[t.jsx(pt,{className:"h-5 w-5 text-primary"}),"Registered Pets"]}),t.jsx($e,{className:"text-base",children:"Manage profiles, photos, QR tags, and missing status"})]}),t.jsxs(K,{onClick:()=>l(!0),disabled:!a,className:"gap-2 transition-all hover:scale-105",children:[t.jsx(ot,{className:"h-4 w-4"}),"Add Pet"]})]})}),t.jsx(ie,{children:n?t.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((N,L)=>t.jsxs(ee,{className:"p-4 space-y-3",children:[t.jsx(X,{className:"h-5 w-40"}),t.jsx(X,{className:"h-4 w-24"}),t.jsx(X,{className:"h-32 w-full rounded-md"}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsx(X,{className:"h-9 w-16"}),t.jsx(X,{className:"h-9 w-16"}),t.jsx(X,{className:"h-9 w-16"})]})]},L))}):o?t.jsxs(Je,{variant:"destructive",children:[t.jsx(Ie,{className:"h-4 w-4"}),t.jsx(Ze,{children:"Failed to load pets. Please try again."})]}):i&&i.length>0?t.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:i.map(N=>t.jsx(Cr,{pet:N,onEdit:()=>x(N),onView:()=>M(N),onQr:()=>y(N),onShare:()=>P(N),onDelete:()=>g(N),onToggleMissing:L=>O(N,L),togglingMissing:E||R.isPending},N.id))}):t.jsxs("div",{className:"text-center py-12 space-y-4",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"h-20 w-20 bg-primary/10 rounded-full flex items-center justify-center",children:t.jsx(ce,{className:"h-10 w-10 text-primary/60"})})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-lg font-medium text-foreground",children:"No pets yet"}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Click ",t.jsx("span",{className:"font-medium text-foreground",children:"Add Pet"})," to create your first pet profile"]})]}),t.jsxs(K,{onClick:()=>l(!0),className:"gap-2 mt-4",children:[t.jsx(ot,{className:"h-4 w-4"}),"Add Your First Pet"]})]})})]}),t.jsx($t,{mode:"add",open:m,onOpenChange:I,onSubmit:A}),h&&t.jsx($t,{mode:"edit",open:!!h,onOpenChange:N=>!N&&x(null),initialPet:{id:h.id,name:h.name,species:h.species,breed:h.breed??void 0,color:h.color??void 0,weight:h.weight??void 0,birthdate:h.birthdate??void 0,microchipId:h.microchip_id??void 0,description:h.description??void 0,notes:h.notes??void 0,vaccinations:h.vaccinations?{rabies:h.vaccinations.rabies??!1,rabiesExpires:h.vaccinations.rabiesExpires??void 0}:void 0,photoPreview:h.photo_url??void 0,environment:h.environment},onSubmit:A}),a&&t.jsx(Ms,{pet:v,open:!!v,onOpenChange:N=>!N&&y(null),ownerId:a}),t.jsx(ma,{pet:j,open:!!j,onOpenChange:N=>!N&&g(null),onDeleted:$}),t.jsx(Ta,{pet:S,open:!!S,onOpenChange:N=>!N&&P(null)}),t.jsx(Lt,{open:!!b,onOpenChange:N=>!N&&C(null),children:t.jsxs(Ut,{children:[t.jsxs(Vt,{children:[t.jsxs(Kt,{className:"flex items-center gap-2",children:[t.jsx(st,{className:"h-5 w-5 text-orange-500"}),"Mark ",b?.name," as missing?"]}),t.jsx(Qt,{children:"This helps highlight their profile and can trigger your outreach flow. You can turn this off later."})]}),t.jsxs(Wt,{children:[t.jsx(Gt,{disabled:E,children:"Cancel"}),t.jsx(Ht,{disabled:E,onClick:V,className:"gap-2",children:E?t.jsxs(t.Fragment,{children:[t.jsx(ze,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):"Yes, mark missing"})]})]})})]}),t.jsx(Xe,{value:"shared",className:"space-y-4",children:t.jsxs(ee,{className:"shadow-lg border-primary/10",children:[t.jsx(le,{children:t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs(ne,{className:"text-2xl flex items-center gap-2",children:[t.jsx(ft,{className:"h-5 w-5 text-primary"}),"Shared With Me"]}),t.jsx($e,{className:"text-base",children:"Pets that others have shared with you"})]})}),t.jsx(ie,{children:u?t.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:3}).map((N,L)=>t.jsxs(ee,{className:"p-4 space-y-3",children:[t.jsx(X,{className:"h-5 w-40"}),t.jsx(X,{className:"h-4 w-24"}),t.jsx(X,{className:"h-32 w-full rounded-md"})]},L))}):c&&c.length>0?t.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:c.map(N=>t.jsx(kr,{pet:N,onEdit:N.can_edit?()=>x(N):void 0,onView:()=>M(N),onToggleMissing:L=>O(N,L),togglingMissing:E||R.isPending},N.id))}):t.jsxs("div",{className:"text-center py-12 space-y-4",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"h-20 w-20 bg-primary/10 rounded-full flex items-center justify-center",children:t.jsx(Oe,{className:"h-10 w-10 text-primary/60"})})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-lg font-medium text-foreground",children:"No shared pets"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"When someone shares a pet with you, it will appear here"})]})]})})]})}),t.jsx(Xe,{value:"locations",className:"mt-4",children:t.jsx(ua,{})}),t.jsx(Xe,{value:"activity",className:"mt-4",children:t.jsx(ra,{days:30})})]})]})}function Cr(s){const e=G.c(74),{pet:a,onEdit:r,onView:i,onQr:n,onShare:o,onDelete:c,onToggleMissing:u,togglingMissing:m}=s;let l;e[0]!==a.id?(l={queryKey:["pet-share-count",a.id],queryFn:()=>Pa(a.id),staleTime:6e4},e[0]=a.id,e[1]=l):l=e[1];const{data:h}=he(l);let x;e[2]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(ce,{className:"h-4 w-4 text-primary flex-shrink-0"}),e[2]=x):x=e[2];let j;e[3]!==a.name?(j=t.jsxs(ne,{className:"text-lg truncate flex items-center gap-2",children:[x,a.name]}),e[3]=a.name,e[4]=j):j=e[4];let g;e[5]!==a.missing?(g=a.missing&&t.jsxs(Y,{variant:"destructive",className:"gap-1 animate-pulse",children:[t.jsx(st,{className:"h-3 w-3"}),"Missing"]}),e[5]=a.missing,e[6]=g):g=e[6];let v;e[7]!==h?(v=h&&h>0&&t.jsxs(Y,{variant:"outline",className:"gap-1 text-xs",children:[t.jsx(Oe,{className:"h-3 w-3"}),h," shared"]}),e[7]=h,e[8]=v):v=e[8];let y;e[9]!==a.subscription_status?(y=aa(a.subscription_status),e[9]=a.subscription_status,e[10]=y):y=e[10];let S;e[11]!==a.subscription_status?(S=a.subscription_status==="active"?t.jsxs(t.Fragment,{children:[t.jsx(Gs,{className:"h-3 w-3"}),"Active"]}):t.jsxs(t.Fragment,{children:[t.jsx(Hs,{className:"h-3 w-3"}),a.subscription_status==="expired"?"Expired":a.subscription_status==="cancelled"?"Cancelled":a.subscription_status==="pending"?"Pending":"Inactive"]}),e[11]=a.subscription_status,e[12]=S):S=e[12];let P;e[13]!==y||e[14]!==S?(P=t.jsx(Y,{variant:y,className:"gap-1 text-xs",children:S}),e[13]=y,e[14]=S,e[15]=P):P=e[15];let b;e[16]!==a.species?(b=t.jsx(Y,{variant:"secondary",className:"capitalize text-xs",children:a.species}),e[16]=a.species,e[17]=b):b=e[17];let C;e[18]!==g||e[19]!==v||e[20]!==P||e[21]!==b?(C=t.jsxs("div",{className:"flex flex-col gap-1.5 items-end",children:[g,v,P,b]}),e[18]=g,e[19]=v,e[20]=P,e[21]=b,e[22]=C):C=e[22];let E;e[23]!==C||e[24]!==j?(E=t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[j,C]}),e[23]=C,e[24]=j,e[25]=E):E=e[25];const k=a.breed||a.description||"No description";let d;e[26]!==k?(d=t.jsx($e,{className:"line-clamp-2 text-sm",children:k}),e[26]=k,e[27]=d):d=e[27];let B;e[28]!==E||e[29]!==d?(B=t.jsxs(le,{className:"pb-3",children:[E,d]}),e[28]=E,e[29]=d,e[30]=B):B=e[30];let M;e[31]!==a.name||e[32]!==a.photo_url?(M=a.photo_url&&t.jsx("div",{className:"px-4 pb-3",children:t.jsx("img",{src:a.photo_url,alt:`${a.name} photo`,className:"w-full h-40 rounded-lg object-cover ring-1 ring-primary/10",loading:"lazy"})}),e[31]=a.name,e[32]=a.photo_url,e[33]=M):M=e[33];let A;e[34]===Symbol.for("react.memo_cache_sentinel")?(A=t.jsx(Ue,{className:"h-3.5 w-3.5"}),e[34]=A):A=e[34];let I;e[35]!==r?(I=t.jsxs(K,{size:"sm",onClick:r,className:"gap-1.5 flex-1 transition-all hover:scale-105",children:[A,"Edit"]}),e[35]=r,e[36]=I):I=e[36];let $;e[37]===Symbol.for("react.memo_cache_sentinel")?($=t.jsx(Le,{className:"h-3.5 w-3.5"}),e[37]=$):$=e[37];let R;e[38]!==i?(R=t.jsxs(K,{size:"sm",variant:"outline",onClick:i,className:"gap-1.5 flex-1 transition-all hover:scale-105",children:[$,"View"]}),e[38]=i,e[39]=R):R=e[39];let O;e[40]===Symbol.for("react.memo_cache_sentinel")?(O=t.jsx(Ys,{className:"h-3.5 w-3.5"}),e[40]=O):O=e[40];let V;e[41]!==n?(V=t.jsxs(K,{size:"sm",variant:"outline",onClick:n,className:"gap-1.5 flex-1 transition-all hover:scale-105",title:"View QR Code",children:[O,"QR"]}),e[41]=n,e[42]=V):V=e[42];let N;e[43]!==I||e[44]!==R||e[45]!==V?(N=t.jsxs("div",{className:"flex flex-wrap gap-2",children:[I,R,V]}),e[43]=I,e[44]=R,e[45]=V,e[46]=N):N=e[46];let L;e[47]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsx(Oe,{className:"h-3.5 w-3.5"}),e[47]=L):L=e[47];let Q;e[48]!==o?(Q=t.jsx("div",{className:"flex flex-wrap gap-2",children:t.jsxs(K,{size:"sm",variant:"outline",onClick:o,className:"gap-1.5 flex-1 transition-all hover:scale-105",children:[L,"Share"]})}),e[48]=o,e[49]=Q):Q=e[49];const Z=`missing-${a.id}`;let H;e[50]!==Z?(H=t.jsx(W,{htmlFor:Z,className:"text-sm font-medium cursor-pointer",children:"Mark Missing"}),e[50]=Z,e[51]=H):H=e[51];const J=`missing-${a.id}`,p=!!a.missing;let _;e[52]!==u||e[53]!==J||e[54]!==p||e[55]!==m?(_=t.jsx(tt,{id:J,checked:p,disabled:m,onCheckedChange:u}),e[52]=u,e[53]=J,e[54]=p,e[55]=m,e[56]=_):_=e[56];let T;e[57]!==H||e[58]!==_?(T=t.jsxs("div",{className:"flex items-center gap-2",children:[H,_]}),e[57]=H,e[58]=_,e[59]=T):T=e[59];let w;e[60]===Symbol.for("react.memo_cache_sentinel")?(w=t.jsx(bt,{className:"h-3.5 w-3.5"}),e[60]=w):w=e[60];let D;e[61]!==c?(D=t.jsxs(K,{size:"sm",variant:"ghost",onClick:c,className:"gap-1.5 text-destructive hover:text-destructive hover:bg-destructive/10",children:[w,"Delete"]}),e[61]=c,e[62]=D):D=e[62];let q;e[63]!==T||e[64]!==D?(q=t.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[T,D]}),e[63]=T,e[64]=D,e[65]=q):q=e[65];let z;e[66]!==N||e[67]!==Q||e[68]!==q?(z=t.jsxs(ie,{className:"space-y-3 pt-3 border-t",children:[N,Q,q]}),e[66]=N,e[67]=Q,e[68]=q,e[69]=z):z=e[69];let U;return e[70]!==B||e[71]!==M||e[72]!==z?(U=t.jsxs(ee,{className:"overflow-hidden transition-all duration-200 hover:shadow-lg hover:scale-[1.02] border-primary/10",children:[B,M,z]}),e[70]=B,e[71]=M,e[72]=z,e[73]=U):U=e[73],U}function kr(s){const e=G.c(50),{pet:a,onEdit:r,onView:i,onToggleMissing:n,togglingMissing:o}=s;let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx(ce,{className:"h-4 w-4 text-primary flex-shrink-0"}),e[0]=c):c=e[0];let u;e[1]!==a.name?(u=t.jsxs(ne,{className:"text-lg truncate flex items-center gap-2",children:[c,a.name]}),e[1]=a.name,e[2]=u):u=e[2];let m;e[3]!==a.missing?(m=a.missing&&t.jsxs(Y,{variant:"destructive",className:"gap-1 animate-pulse",children:[t.jsx(st,{className:"h-3 w-3"}),"Missing"]}),e[3]=a.missing,e[4]=m):m=e[4];let l;e[5]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx(ft,{className:"h-3 w-3"}),e[5]=l):l=e[5];const h=a.can_edit?"Can edit":"View only";let x;e[6]!==h?(x=t.jsxs(Y,{variant:"outline",className:"gap-1 text-xs bg-primary/5",children:[l,h]}),e[6]=h,e[7]=x):x=e[7];let j;e[8]!==a.species?(j=t.jsx(Y,{variant:"secondary",className:"capitalize text-xs",children:a.species}),e[8]=a.species,e[9]=j):j=e[9];let g;e[10]!==m||e[11]!==x||e[12]!==j?(g=t.jsxs("div",{className:"flex flex-col gap-1.5 items-end",children:[m,x,j]}),e[10]=m,e[11]=x,e[12]=j,e[13]=g):g=e[13];let v;e[14]!==u||e[15]!==g?(v=t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[u,g]}),e[14]=u,e[15]=g,e[16]=v):v=e[16];const y=a.owner_name||a.owner_email||"Unknown";let S;e[17]!==y?(S=t.jsx($e,{className:"line-clamp-2 text-sm",children:t.jsxs("span",{className:"text-muted-foreground",children:["Shared by ",y]})}),e[17]=y,e[18]=S):S=e[18];let P;e[19]!==S||e[20]!==v?(P=t.jsxs(le,{className:"pb-3",children:[v,S]}),e[19]=S,e[20]=v,e[21]=P):P=e[21];let b;e[22]!==a.name||e[23]!==a.photo_url?(b=a.photo_url&&t.jsx("div",{className:"px-4 pb-3",children:t.jsx("img",{src:a.photo_url,alt:`${a.name} photo`,className:"w-full h-40 rounded-lg object-cover ring-1 ring-primary/10",loading:"lazy"})}),e[22]=a.name,e[23]=a.photo_url,e[24]=b):b=e[24];let C;e[25]!==r?(C=r&&t.jsxs(K,{size:"sm",onClick:r,className:"gap-1.5 flex-1 transition-all hover:scale-105",children:[t.jsx(Ue,{className:"h-3.5 w-3.5"}),"Edit"]}),e[25]=r,e[26]=C):C=e[26];let E;e[27]===Symbol.for("react.memo_cache_sentinel")?(E=t.jsx(Le,{className:"h-3.5 w-3.5"}),e[27]=E):E=e[27];let k;e[28]!==i?(k=t.jsxs(K,{size:"sm",variant:"outline",onClick:i,className:"gap-1.5 flex-1 transition-all hover:scale-105",children:[E,"View"]}),e[28]=i,e[29]=k):k=e[29];let d;e[30]!==C||e[31]!==k?(d=t.jsxs("div",{className:"flex flex-wrap gap-2",children:[C,k]}),e[30]=C,e[31]=k,e[32]=d):d=e[32];const B=`missing-shared-${a.id}`;let M;e[33]!==B?(M=t.jsx(W,{htmlFor:B,className:"text-sm font-medium cursor-pointer",children:"Mark Missing"}),e[33]=B,e[34]=M):M=e[34];const A=`missing-shared-${a.id}`,I=!!a.missing;let $;e[35]!==n||e[36]!==A||e[37]!==I||e[38]!==o?($=t.jsx(tt,{id:A,checked:I,disabled:o,onCheckedChange:n}),e[35]=n,e[36]=A,e[37]=I,e[38]=o,e[39]=$):$=e[39];let R;e[40]!==M||e[41]!==$?(R=t.jsx("div",{className:"flex items-center justify-between pt-2 border-t",children:t.jsxs("div",{className:"flex items-center gap-2",children:[M,$]})}),e[40]=M,e[41]=$,e[42]=R):R=e[42];let O;e[43]!==d||e[44]!==R?(O=t.jsxs(ie,{className:"space-y-3 pt-3 border-t",children:[d,R]}),e[43]=d,e[44]=R,e[45]=O):O=e[45];let V;return e[46]!==P||e[47]!==b||e[48]!==O?(V=t.jsxs(ee,{className:"overflow-hidden transition-all duration-200 hover:shadow-lg hover:scale-[1.02] border-primary/10",children:[P,b,O]}),e[46]=P,e[47]=b,e[48]=O,e[49]=V):V=e[49],V}export{ni as default};
