const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./browser-tq_lHK0Z.js","./index-DAmRCMs6.js","./index-vFrJB2ES.css"])))=>i.map(i=>d[i]);
import{r as i,j as s,c as B,u as ft,_ as ps,s as te,a as ht}from"./index-DAmRCMs6.js";import{u as At}from"./useQuery-D6KKTvAt.js";import{u as ms}from"./useMutation-Cr-vgvUo.js";import{a as et,b as tt,c as rt,d as st,C as De}from"./card-AO9X5G_u.js";import{B as ot}from"./badge-63Tbt0xk.js";import{A as Mt,a as Dt,b as Ot,c as Bt,d as $t,e as Lt,f as Ft,g as Vt,T as Ut,h as fs,i as hs,j as gs,k as jt,l as Nt}from"./textarea-DMoSokpd.js";import{u as Z,B as Q,c as zt,a as Ee}from"./button-CMJiYzf3.js";import{S as ye}from"./skeleton-0AurBvqP.js";import{c as gt,u as Be,a as L,b as xs,d as le,e as vs,f as ie,P as qt,g as ws,h as Ht,i as Wt,R as Kt,F as Qt,D as Gt,j as Yt,k as bs,l as ys,O as js,C as Ns}from"./index-BDHRXChV.js";import{u as Ss,T as at,c as Fe,R as Xt,A as xt,C as Zt,a as Jt,b as er}from"./index-DGb_C8xp.js";import{P as O,r as tr}from"./index-BHoHCWYW.js";import{c as V}from"./utils-CBfrqCZ4.js";import{L as X,I as ne}from"./input-rrX7hfbW.js";import{A as rr,a as sr}from"./alert-Cwgmgtc4.js";import{l as Cs,D as or,a as ar,b as nr,c as lr,d as ir,e as cr}from"./dialog-z3UF2Yn5.js";import{Q as dr}from"./qr-code-B0SiJIrW.js";import{c as G}from"./createLucideIcon-DZjPpD2b.js";import{u as ks,a as _s,o as St,s as ae,n as Ps,_ as Rs,b as Es}from"./zod-fUA3rUZ-.js";import{C as Ts}from"./check-DWR63ONa.js";import{S as nt}from"./separator-BMCy6OuU.js";import{P as ge}from"./paw-print-D-lbDCKc.js";import{C as Oe}from"./circle-alert-DirMIqTp.js";import{F as Is}from"./file-text-6vnEGqpm.js";import{E as As}from"./eye-CT3apXN6.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Ds=G("activity",Ms);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Bs=G("calendar",Os);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ls=G("camera",$s);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Vs=G("chevron-up",Fs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],zs=G("chevrons-up-down",Us);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Hs=G("copy",qs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ks=G("download",Ws);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],Gs=G("palette",Qs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ct=G("plus",Ys);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],$e=G("refresh-cw",Xs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Js=G("search",Zs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],ur=G("sparkles",eo);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ro=G("square-pen",to);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=[["path",{d:"m18 2 4 4",key:"22kx64"}],["path",{d:"m17 7 3-3",key:"1w1zoj"}],["path",{d:"M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5",key:"1exhtz"}],["path",{d:"m9 11 4 4",key:"rovt3i"}],["path",{d:"m5 19-3 3",key:"59f2uf"}],["path",{d:"m14 4 6 6",key:"yqp9t2"}]],oo=G("syringe",so);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]],no=G("weight",ao);function pr(r){const e=i.useRef({value:r,previous:r});return i.useMemo(()=>(e.current.value!==r&&(e.current.previous=e.current.value,e.current.value=r),e.current.previous),[r])}var Ve="Switch",[lo]=gt(Ve),[io,co]=lo(Ve),mr=i.forwardRef((r,e)=>{const{__scopeSwitch:t,name:o,checked:a,defaultChecked:n,required:l,disabled:d,value:c="on",onCheckedChange:u,form:p,...f}=r,[b,x]=i.useState(null),v=Z(e,S=>x(S)),h=i.useRef(!1),y=b?p||!!b.closest("form"):!0,[g,j]=Be({prop:a,defaultProp:n??!1,onChange:u,caller:Ve});return s.jsxs(io,{scope:t,checked:g,disabled:d,children:[s.jsx(O.button,{type:"button",role:"switch","aria-checked":g,"aria-required":l,"data-state":xr(g),"data-disabled":d?"":void 0,disabled:d,value:c,...f,ref:v,onClick:L(r.onClick,S=>{j(D=>!D),y&&(h.current=S.isPropagationStopped(),h.current||S.stopPropagation())})}),y&&s.jsx(gr,{control:b,bubbles:!h.current,name:o,value:c,checked:g,required:l,disabled:d,form:p,style:{transform:"translateX(-100%)"}})]})});mr.displayName=Ve;var fr="SwitchThumb",hr=i.forwardRef((r,e)=>{const{__scopeSwitch:t,...o}=r,a=co(fr,t);return s.jsx(O.span,{"data-state":xr(a.checked),"data-disabled":a.disabled?"":void 0,...o,ref:e})});hr.displayName=fr;var uo="SwitchBubbleInput",gr=i.forwardRef(({__scopeSwitch:r,control:e,checked:t,bubbles:o=!0,...a},n)=>{const l=i.useRef(null),d=Z(l,n),c=pr(t),u=Ss(e);return i.useEffect(()=>{const p=l.current;if(!p)return;const f=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(f,"checked").set;if(c!==t&&x){const v=new Event("click",{bubbles:o});x.call(p,t),p.dispatchEvent(v)}},[c,t,o]),s.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...a,tabIndex:-1,ref:d,style:{...a.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});gr.displayName=uo;function xr(r){return r?"checked":"unchecked"}var po=mr,mo=hr;function fo(r){const e=B.c(9);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),e[3]=t,e[4]=a):a=e[4];let n;e[5]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx(mo,{"data-slot":"switch-thumb",className:V("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")}),e[5]=n):n=e[5];let l;return e[6]!==o||e[7]!==a?(l=s.jsx(po,{"data-slot":"switch",className:a,...o,children:n}),e[6]=o,e[7]=a,e[8]=l):l=e[8],l}function ho(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("w-full caption-bottom text-sm",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:s.jsx("table",{"data-slot":"table",className:a,...o})}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}function go(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("[&_tr]:border-b",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx("thead",{"data-slot":"table-header",className:a,...o}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}function xo(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("[&_tr:last-child]:border-0",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx("tbody",{"data-slot":"table-body",className:a,...o}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}function vr(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx("tr",{"data-slot":"table-row",className:a,...o}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}function Ae(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx("th",{"data-slot":"table-head",className:a,...o}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}function Me(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx("td",{"data-slot":"table-cell",className:a,...o}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}function vo(r){const e=B.c(18),{days:t}=r,o=t===void 0?14:t,{user:a}=ft(),n=a?.id??null;let l,d;e[0]!==o||e[1]!==n?(l=["scan_events",n,o],d=()=>n?Cs(n,o):Promise.resolve([]),e[0]=o,e[1]=n,e[2]=l,e[3]=d):(l=e[2],d=e[3]);const c=!!n;let u;e[4]!==l||e[5]!==d||e[6]!==c?(u={queryKey:l,queryFn:d,enabled:c,staleTime:3e4},e[4]=l,e[5]=d,e[6]=c,e[7]=u):u=e[7];const{data:p,isLoading:f,isError:b}=At(u);let x;e[8]===Symbol.for("react.memo_cache_sentinel")?(x=s.jsx(tt,{children:"QR Scan Events"}),e[8]=x):x=e[8];let v;e[9]!==o?(v=s.jsxs(rt,{children:[x,s.jsxs(st,{children:["Last ",o," days"]})]}),e[9]=o,e[10]=v):v=e[10];let h;e[11]!==p||e[12]!==b||e[13]!==f?(h=s.jsx(et,{children:f?s.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}):b?s.jsx("div",{className:"text-sm text-destructive",children:"Failed to load scans."}):p?.length?s.jsxs(ho,{children:[s.jsx(go,{children:s.jsxs(vr,{children:[s.jsx(Ae,{children:"When"}),s.jsx(Ae,{children:"Pet"}),s.jsx(Ae,{children:"Location"}),s.jsx(Ae,{children:"Referrer"})]})}),s.jsx(xo,{children:p.map(wo)})]}):s.jsx("div",{className:"text-sm text-muted-foreground",children:"No scans yet."})}),e[11]=p,e[12]=b,e[13]=f,e[14]=h):h=e[14];let y;return e[15]!==v||e[16]!==h?(y=s.jsxs(De,{children:[v,h]}),e[15]=v,e[16]=h,e[17]=y):y=e[17],y}function wo(r){return s.jsxs(vr,{children:[s.jsx(Me,{className:"whitespace-nowrap",children:new Date(r.scanned_at).toLocaleString()}),s.jsx(Me,{className:"font-medium",children:r.pet_name}),s.jsx(Me,{className:"text-muted-foreground",children:r.city||r.region||r.country?[r.city,r.region,r.country].filter(Boolean).join(", "):s.jsx(ot,{variant:"outline",children:"unknown"})}),s.jsx(Me,{className:"truncate max-w-[240px] text-muted-foreground",children:r.referrer||"—"})]},r.id)}async function bo(r){return await(await ps(async()=>{const{default:t}=await import("./browser-tq_lHK0Z.js").then(o=>o.b);return{default:t}},__vite__mapDeps([0,1,2]),import.meta.url)).default.toDataURL(r,{errorCorrectionLevel:"M",margin:1,scale:8,color:{dark:"#000000",light:"#ffffff"}})}async function yo(r){return await(await fetch(r)).blob()}async function jo(r,e,t){const o=`${r}/${e}.png`,{error:a}=await te.storage.from("pet-qr").upload(o,t,{contentType:"image/png",upsert:!0});if(a)throw a;const{data:n}=te.storage.from("pet-qr").getPublicUrl(o);return n.publicUrl}async function vt(r,e){const t=`https://www.pawtraceqr.com/p/${e}`,o=await bo(t),a=await yo(o);return await jo(r,e,a)}let No=r=>crypto.getRandomValues(new Uint8Array(r)),So=(r,e,t)=>{let o=(2<<Math.log2(r.length-1))-1,a=-~(1.6*o*e/r.length);return(n=e)=>{let l="";for(;;){let d=t(a),c=a|0;for(;c--;)if(l+=r[d[c]&o]||"",l.length>=n)return l}}},Co=(r,e=21)=>So(r,e|0,No);const ko="0123456789abcdefghijklmnopqrstuvwxyz";function _o(r=4){return Co(ko,r)()}async function Po(r){let e=3;for(let t=0;t<7;t++){const o=_o(e),{data:a,error:n}=await te.from("pets").insert({...r,short_id:o}).select("*").single();if(!n)return a;if(n.code==="23505"&&n.message.includes("pets_short_id_key")){e++;continue}throw n}throw new Error("Could not generate a unique short id for pet.")}async function Re(r,e){const{error:t}=await te.from("pets").update(e).eq("id",r);if(t)throw t;const{data:o,error:a}=await te.from("pets").select("*").eq("id",r).maybeSingle();return a?(console.warn("updatePet: select after update blocked by RLS:",a?.message),{id:r,...e}):o??{id:r,...e}}async function Ro(r){const{data:e,error:t}=await te.from("pets").select("*").eq("owner_id",r).order("created_at",{ascending:!1});if(t)throw t;return e??[]}async function kt(r,e,t){if(!t||t.size===0)throw new Error("Empty image blob");const o=t.type||"image/webp",a=o==="image/jpeg"||o==="image/jpg"?"jpg":o==="image/png"?"png":o==="image/avif"?"avif":"webp",n=Date.now(),l=`${r}/${e}-${n}.${a}`,{error:d}=await te.storage.from("pet-photos").upload(l,t,{contentType:o,upsert:!1});if(d)throw console.error("storage.upload error:",d),d;const{data:c}=te.storage.from("pet-photos").getPublicUrl(l);return c.publicUrl}async function Eo(r){const{error:e}=await te.from("pets").delete().eq("id",r);if(e)throw e}async function To(r){if(!r)return;const e=r.indexOf("/pet-photos/");if(e===-1)return;const t=r.substring(e+12);if(!t)return;const{error:o}=await te.storage.from("pet-photos").remove([t]);o&&console.warn("storage.remove warning:",o.message)}async function Io(r){const{data:e,error:t}=await te.from("pets").select("id, qr_url").eq("owner_id",r);if(t)throw t;for(const o of e??[])if(!o.qr_url){const a=await vt(r,o.id),{error:n}=await te.from("pets").update({qr_url:a}).eq("id",o.id);if(n)throw n}}function Ao({pet:r,open:e,onOpenChange:t,ownerId:o}){const a=ht(),[n,l]=i.useState(!1),[d,c]=i.useState(r?.qr_url??null),u=async()=>{if(!(!r||d)){l(!0);try{const v=await vt(o,r.short_id);await Re(r.id,{qr_url:v}),c(v),await a.invalidateQueries({queryKey:["pets",o]})}catch(v){alert(v?.message??"Failed to generate QR code")}finally{l(!1)}}},p=v=>{v&&r&&!r.qr_url&&!d&&u(),t(v)},f=async v=>{if(v)try{await navigator.clipboard.writeText(v),alert("Copied to clipboard")}catch{alert("Failed to copy")}},b=v=>{if(!v||!r)return;const h=document.createElement("a");h.href=v,h.download=`${r.name}-qr.png`,h.target="_blank",h.rel="noopener noreferrer",h.click()},x=d||r?.qr_url;return s.jsx(or,{open:e,onOpenChange:p,children:s.jsxs(ar,{className:"sm:max-w-md bg-white dark:bg-[#1E1F24] border-2",children:[s.jsx(nr,{className:"space-y-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 bg-[#3B3A7A] rounded-xl flex items-center justify-center shadow-md",children:s.jsx(dr,{className:"h-5 w-5 text-white"})}),s.jsxs("div",{children:[s.jsxs(lr,{className:"text-xl text-foreground",children:["QR Code ",r?`– ${r.name}`:""]}),s.jsx(ir,{className:"text-muted-foreground",children:"Scan to open the public pet page"})]})]})}),s.jsx("div",{className:"flex flex-col items-center gap-4 py-4",children:n?s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground py-8",children:[s.jsx($e,{className:"h-4 w-4 animate-spin"}),"Generating QR code…"]}):x?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"p-8 bg-white rounded-md border-4 border-[#3B3A7A] shadow-lg",children:s.jsx("img",{src:x,alt:"QR code",className:"h-64 w-64 object-contain",style:{backgroundColor:"#ffffff"}})}),s.jsxs("div",{className:"w-full space-y-2",children:[s.jsx(X,{className:"text-sm font-semibold text-foreground",children:"QR Code URL"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(ne,{readOnly:!0,value:x,className:"text-xs bg-background text-foreground border-2"}),s.jsx(Q,{type:"button",variant:"outline",size:"icon",onClick:()=>f(x),className:"flex-shrink-0",title:"Copy URL",children:s.jsx(Hs,{className:"h-4 w-4"})})]}),s.jsxs(Q,{type:"button",onClick:()=>b(x),className:"w-full gap-2 bg-[#3B3A7A] hover:bg-[#3B3A7A]/90 text-white",children:[s.jsx(Ks,{className:"h-4 w-4"}),"Download QR Code"]})]})]}):s.jsx("div",{className:"text-sm text-muted-foreground py-8",children:"No QR code available"})}),s.jsx(cr,{children:s.jsx(Q,{type:"button",variant:"outline",onClick:()=>t(!1),className:"border-2",children:"Close"})})]})})}function Mo({pet:r,open:e,onOpenChange:t,onDeleted:o}){const[a,n]=i.useState(!1),l=async()=>{if(r){n(!0);try{r.photo_url&&await To(r.photo_url),await Eo(r.id),o(),t(!1)}catch(d){alert(d?.message??"Failed to delete pet")}finally{n(!1)}}};return r?s.jsx(Mt,{open:e,onOpenChange:t,children:s.jsxs(Dt,{children:[s.jsxs(Ot,{children:[s.jsxs(Bt,{className:"flex items-center gap-2",children:[s.jsx(at,{className:"h-5 w-5 text-destructive"}),"Delete ",r.name,"?"]}),s.jsxs($t,{children:["This will permanently remove the pet profile",r.photo_url?" and its photo":"",". This action cannot be undone."]})]}),s.jsxs(Lt,{children:[s.jsx(Ft,{disabled:a,children:"Cancel"}),s.jsx(Vt,{disabled:a,onClick:l,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 gap-2",children:a?s.jsxs(s.Fragment,{children:[s.jsx($e,{className:"h-4 w-4 animate-spin"}),"Deleting…"]}):s.jsxs(s.Fragment,{children:[s.jsx(Ut,{className:"h-4 w-4"}),"Delete"]})})]})]})}):null}function Do(r){const e=ht(),[t,o]=i.useState(!1);return{backfillAllQR:async()=>{if(r){o(!0);try{await Io(r),await e.invalidateQueries({queryKey:["pets",r]}),alert("QR backfill completed successfully")}catch(n){alert(n?.message??"Backfill failed")}finally{o(!1)}}},isBackfilling:t}}function _t(r,[e,t]){return Math.min(t,Math.max(e,r))}var wr=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Oo="VisuallyHidden",Bo=i.forwardRef((r,e)=>s.jsx(O.span,{...r,ref:e,style:{...wr,...r.style}}));Bo.displayName=Oo;var $o=[" ","Enter","ArrowUp","ArrowDown"],Lo=[" ","Enter"],xe="Select",[Ue,ze,Fo]=vs(xe),[Ce]=gt(xe,[Fo,Fe]),qe=Fe(),[Vo,de]=Ce(xe),[Uo,zo]=Ce(xe),br=r=>{const{__scopeSelect:e,children:t,open:o,defaultOpen:a,onOpenChange:n,value:l,defaultValue:d,onValueChange:c,dir:u,name:p,autoComplete:f,disabled:b,required:x,form:v}=r,h=qe(e),[y,g]=i.useState(null),[j,S]=i.useState(null),[D,I]=i.useState(!1),_=xs(u),[R,U]=Be({prop:o,defaultProp:a??!1,onChange:n,caller:xe}),[J,C]=Be({prop:l,defaultProp:d,onChange:c,caller:xe}),$=i.useRef(null),H=y?v||!!y.closest("form"):!0,[re,W]=i.useState(new Set),K=Array.from(re).map(z=>z.props.value).join(";");return s.jsx(Xt,{...h,children:s.jsxs(Vo,{required:x,scope:e,trigger:y,onTriggerChange:g,valueNode:j,onValueNodeChange:S,valueNodeHasChildren:D,onValueNodeHasChildrenChange:I,contentId:le(),value:J,onValueChange:C,open:R,onOpenChange:U,dir:_,triggerPointerDownPosRef:$,disabled:b,children:[s.jsx(Ue.Provider,{scope:e,children:s.jsx(Uo,{scope:r.__scopeSelect,onNativeOptionAdd:i.useCallback(z=>{W(Y=>new Set(Y).add(z))},[]),onNativeOptionRemove:i.useCallback(z=>{W(Y=>{const ee=new Set(Y);return ee.delete(z),ee})},[]),children:t})}),H?s.jsxs(Ur,{"aria-hidden":!0,required:x,tabIndex:-1,name:p,autoComplete:f,value:J,onChange:z=>C(z.target.value),disabled:b,form:v,children:[J===void 0?s.jsx("option",{value:""}):null,Array.from(re)]},K):null]})})};br.displayName=xe;var yr="SelectTrigger",jr=i.forwardRef((r,e)=>{const{__scopeSelect:t,disabled:o=!1,...a}=r,n=qe(t),l=de(yr,t),d=l.disabled||o,c=Z(e,l.onTriggerChange),u=ze(t),p=i.useRef("touch"),[f,b,x]=qr(h=>{const y=u().filter(S=>!S.disabled),g=y.find(S=>S.value===l.value),j=Hr(y,h,g);j!==void 0&&l.onValueChange(j.value)}),v=h=>{d||(l.onOpenChange(!0),x()),h&&(l.triggerPointerDownPosRef.current={x:Math.round(h.pageX),y:Math.round(h.pageY)})};return s.jsx(xt,{asChild:!0,...n,children:s.jsx(O.button,{type:"button",role:"combobox","aria-controls":l.contentId,"aria-expanded":l.open,"aria-required":l.required,"aria-autocomplete":"none",dir:l.dir,"data-state":l.open?"open":"closed",disabled:d,"data-disabled":d?"":void 0,"data-placeholder":zr(l.value)?"":void 0,...a,ref:c,onClick:L(a.onClick,h=>{h.currentTarget.focus(),p.current!=="mouse"&&v(h)}),onPointerDown:L(a.onPointerDown,h=>{p.current=h.pointerType;const y=h.target;y.hasPointerCapture(h.pointerId)&&y.releasePointerCapture(h.pointerId),h.button===0&&h.ctrlKey===!1&&h.pointerType==="mouse"&&(v(h),h.preventDefault())}),onKeyDown:L(a.onKeyDown,h=>{const y=f.current!=="";!(h.ctrlKey||h.altKey||h.metaKey)&&h.key.length===1&&b(h.key),!(y&&h.key===" ")&&$o.includes(h.key)&&(v(),h.preventDefault())})})})});jr.displayName=yr;var Nr="SelectValue",Sr=i.forwardRef((r,e)=>{const{__scopeSelect:t,className:o,style:a,children:n,placeholder:l="",...d}=r,c=de(Nr,t),{onValueNodeHasChildrenChange:u}=c,p=n!==void 0,f=Z(e,c.onValueNodeChange);return ie(()=>{u(p)},[u,p]),s.jsx(O.span,{...d,ref:f,style:{pointerEvents:"none"},children:zr(c.value)?s.jsx(s.Fragment,{children:l}):n})});Sr.displayName=Nr;var qo="SelectIcon",Cr=i.forwardRef((r,e)=>{const{__scopeSelect:t,children:o,...a}=r;return s.jsx(O.span,{"aria-hidden":!0,...a,ref:e,children:o||"▼"})});Cr.displayName=qo;var Ho="SelectPortal",kr=r=>s.jsx(qt,{asChild:!0,...r});kr.displayName=Ho;var ve="SelectContent",_r=i.forwardRef((r,e)=>{const t=de(ve,r.__scopeSelect),[o,a]=i.useState();if(ie(()=>{a(new DocumentFragment)},[]),!t.open){const n=o;return n?tr.createPortal(s.jsx(Pr,{scope:r.__scopeSelect,children:s.jsx(Ue.Slot,{scope:r.__scopeSelect,children:s.jsx("div",{children:r.children})})}),n):null}return s.jsx(Rr,{...r,ref:e})});_r.displayName=ve;var oe=10,[Pr,ue]=Ce(ve),Wo="SelectContentImpl",Ko=zt("SelectContent.RemoveScroll"),Rr=i.forwardRef((r,e)=>{const{__scopeSelect:t,position:o="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:n,onPointerDownOutside:l,side:d,sideOffset:c,align:u,alignOffset:p,arrowPadding:f,collisionBoundary:b,collisionPadding:x,sticky:v,hideWhenDetached:h,avoidCollisions:y,...g}=r,j=de(ve,t),[S,D]=i.useState(null),[I,_]=i.useState(null),R=Z(e,w=>D(w)),[U,J]=i.useState(null),[C,$]=i.useState(null),H=ze(t),[re,W]=i.useState(!1),K=i.useRef(!1);i.useEffect(()=>{if(S)return Ht(S)},[S]),Wt();const z=i.useCallback(w=>{const[T,...A]=H().map(q=>q.ref.current),[M]=A.slice(-1),F=document.activeElement;for(const q of w)if(q===F||(q?.scrollIntoView({block:"nearest"}),q===T&&I&&(I.scrollTop=0),q===M&&I&&(I.scrollTop=I.scrollHeight),q?.focus(),document.activeElement!==F))return},[H,I]),Y=i.useCallback(()=>z([U,S]),[z,U,S]);i.useEffect(()=>{re&&Y()},[re,Y]);const{onOpenChange:ee,triggerPointerDownPosRef:se}=j;i.useEffect(()=>{if(S){let w={x:0,y:0};const T=M=>{w={x:Math.abs(Math.round(M.pageX)-(se.current?.x??0)),y:Math.abs(Math.round(M.pageY)-(se.current?.y??0))}},A=M=>{w.x<=10&&w.y<=10?M.preventDefault():S.contains(M.target)||ee(!1),document.removeEventListener("pointermove",T),se.current=null};return se.current!==null&&(document.addEventListener("pointermove",T),document.addEventListener("pointerup",A,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",T),document.removeEventListener("pointerup",A,{capture:!0})}}},[S,ee,se]),i.useEffect(()=>{const w=()=>ee(!1);return window.addEventListener("blur",w),window.addEventListener("resize",w),()=>{window.removeEventListener("blur",w),window.removeEventListener("resize",w)}},[ee]);const[be,me]=qr(w=>{const T=H().filter(F=>!F.disabled),A=T.find(F=>F.ref.current===document.activeElement),M=Hr(T,w,A);M&&setTimeout(()=>M.ref.current.focus())}),m=i.useCallback((w,T,A)=>{const M=!K.current&&!A;(j.value!==void 0&&j.value===T||M)&&(J(w),M&&(K.current=!0))},[j.value]),k=i.useCallback(()=>S?.focus(),[S]),P=i.useCallback((w,T,A)=>{const M=!K.current&&!A;(j.value!==void 0&&j.value===T||M)&&$(w)},[j.value]),N=o==="popper"?lt:Er,E=N===lt?{side:d,sideOffset:c,align:u,alignOffset:p,arrowPadding:f,collisionBoundary:b,collisionPadding:x,sticky:v,hideWhenDetached:h,avoidCollisions:y}:{};return s.jsx(Pr,{scope:t,content:S,viewport:I,onViewportChange:_,itemRefCallback:m,selectedItem:U,onItemLeave:k,itemTextRefCallback:P,focusSelectedItem:Y,selectedItemText:C,position:o,isPositioned:re,searchRef:be,children:s.jsx(Kt,{as:Ko,allowPinchZoom:!0,children:s.jsx(Qt,{asChild:!0,trapped:j.open,onMountAutoFocus:w=>{w.preventDefault()},onUnmountAutoFocus:L(a,w=>{j.trigger?.focus({preventScroll:!0}),w.preventDefault()}),children:s.jsx(Gt,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:n,onPointerDownOutside:l,onFocusOutside:w=>w.preventDefault(),onDismiss:()=>j.onOpenChange(!1),children:s.jsx(N,{role:"listbox",id:j.contentId,"data-state":j.open?"open":"closed",dir:j.dir,onContextMenu:w=>w.preventDefault(),...g,...E,onPlaced:()=>W(!0),ref:R,style:{display:"flex",flexDirection:"column",outline:"none",...g.style},onKeyDown:L(g.onKeyDown,w=>{const T=w.ctrlKey||w.altKey||w.metaKey;if(w.key==="Tab"&&w.preventDefault(),!T&&w.key.length===1&&me(w.key),["ArrowUp","ArrowDown","Home","End"].includes(w.key)){let M=H().filter(F=>!F.disabled).map(F=>F.ref.current);if(["ArrowUp","End"].includes(w.key)&&(M=M.slice().reverse()),["ArrowUp","ArrowDown"].includes(w.key)){const F=w.target,q=M.indexOf(F);M=M.slice(q+1)}setTimeout(()=>z(M)),w.preventDefault()}})})})})})})});Rr.displayName=Wo;var Qo="SelectItemAlignedPosition",Er=i.forwardRef((r,e)=>{const{__scopeSelect:t,onPlaced:o,...a}=r,n=de(ve,t),l=ue(ve,t),[d,c]=i.useState(null),[u,p]=i.useState(null),f=Z(e,R=>p(R)),b=ze(t),x=i.useRef(!1),v=i.useRef(!0),{viewport:h,selectedItem:y,selectedItemText:g,focusSelectedItem:j}=l,S=i.useCallback(()=>{if(n.trigger&&n.valueNode&&d&&u&&h&&y&&g){const R=n.trigger.getBoundingClientRect(),U=u.getBoundingClientRect(),J=n.valueNode.getBoundingClientRect(),C=g.getBoundingClientRect();if(n.dir!=="rtl"){const F=C.left-U.left,q=J.left-F,fe=R.left-q,he=R.width+fe,Ke=Math.max(he,U.width),Qe=window.innerWidth-oe,Ge=_t(q,[oe,Math.max(oe,Qe-Ke)]);d.style.minWidth=he+"px",d.style.left=Ge+"px"}else{const F=U.right-C.right,q=window.innerWidth-J.right-F,fe=window.innerWidth-R.right-q,he=R.width+fe,Ke=Math.max(he,U.width),Qe=window.innerWidth-oe,Ge=_t(q,[oe,Math.max(oe,Qe-Ke)]);d.style.minWidth=he+"px",d.style.right=Ge+"px"}const $=b(),H=window.innerHeight-oe*2,re=h.scrollHeight,W=window.getComputedStyle(u),K=parseInt(W.borderTopWidth,10),z=parseInt(W.paddingTop,10),Y=parseInt(W.borderBottomWidth,10),ee=parseInt(W.paddingBottom,10),se=K+z+re+ee+Y,be=Math.min(y.offsetHeight*5,se),me=window.getComputedStyle(h),m=parseInt(me.paddingTop,10),k=parseInt(me.paddingBottom,10),P=R.top+R.height/2-oe,N=H-P,E=y.offsetHeight/2,w=y.offsetTop+E,T=K+z+w,A=se-T;if(T<=P){const F=$.length>0&&y===$[$.length-1].ref.current;d.style.bottom="0px";const q=u.clientHeight-h.offsetTop-h.offsetHeight,fe=Math.max(N,E+(F?k:0)+q+Y),he=T+fe;d.style.height=he+"px"}else{const F=$.length>0&&y===$[0].ref.current;d.style.top="0px";const fe=Math.max(P,K+h.offsetTop+(F?m:0)+E)+A;d.style.height=fe+"px",h.scrollTop=T-P+h.offsetTop}d.style.margin=`${oe}px 0`,d.style.minHeight=be+"px",d.style.maxHeight=H+"px",o?.(),requestAnimationFrame(()=>x.current=!0)}},[b,n.trigger,n.valueNode,d,u,h,y,g,n.dir,o]);ie(()=>S(),[S]);const[D,I]=i.useState();ie(()=>{u&&I(window.getComputedStyle(u).zIndex)},[u]);const _=i.useCallback(R=>{R&&v.current===!0&&(S(),j?.(),v.current=!1)},[S,j]);return s.jsx(Yo,{scope:t,contentWrapper:d,shouldExpandOnScrollRef:x,onScrollButtonChange:_,children:s.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:D},children:s.jsx(O.div,{...a,ref:f,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});Er.displayName=Qo;var Go="SelectPopperPosition",lt=i.forwardRef((r,e)=>{const{__scopeSelect:t,align:o="start",collisionPadding:a=oe,...n}=r,l=qe(t);return s.jsx(Zt,{...l,...n,ref:e,align:o,collisionPadding:a,style:{boxSizing:"border-box",...n.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});lt.displayName=Go;var[Yo,wt]=Ce(ve,{}),it="SelectViewport",Tr=i.forwardRef((r,e)=>{const{__scopeSelect:t,nonce:o,...a}=r,n=ue(it,t),l=wt(it,t),d=Z(e,n.onViewportChange),c=i.useRef(0);return s.jsxs(s.Fragment,{children:[s.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),s.jsx(Ue.Slot,{scope:t,children:s.jsx(O.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:d,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:L(a.onScroll,u=>{const p=u.currentTarget,{contentWrapper:f,shouldExpandOnScrollRef:b}=l;if(b?.current&&f){const x=Math.abs(c.current-p.scrollTop);if(x>0){const v=window.innerHeight-oe*2,h=parseFloat(f.style.minHeight),y=parseFloat(f.style.height),g=Math.max(h,y);if(g<v){const j=g+x,S=Math.min(v,j),D=j-S;f.style.height=S+"px",f.style.bottom==="0px"&&(p.scrollTop=D>0?D:0,f.style.justifyContent="flex-end")}}}c.current=p.scrollTop})})})]})});Tr.displayName=it;var Ir="SelectGroup",[Xo,Zo]=Ce(Ir),Jo=i.forwardRef((r,e)=>{const{__scopeSelect:t,...o}=r,a=le();return s.jsx(Xo,{scope:t,id:a,children:s.jsx(O.div,{role:"group","aria-labelledby":a,...o,ref:e})})});Jo.displayName=Ir;var Ar="SelectLabel",ea=i.forwardRef((r,e)=>{const{__scopeSelect:t,...o}=r,a=Zo(Ar,t);return s.jsx(O.div,{id:a.id,...o,ref:e})});ea.displayName=Ar;var Le="SelectItem",[ta,Mr]=Ce(Le),Dr=i.forwardRef((r,e)=>{const{__scopeSelect:t,value:o,disabled:a=!1,textValue:n,...l}=r,d=de(Le,t),c=ue(Le,t),u=d.value===o,[p,f]=i.useState(n??""),[b,x]=i.useState(!1),v=Z(e,j=>c.itemRefCallback?.(j,o,a)),h=le(),y=i.useRef("touch"),g=()=>{a||(d.onValueChange(o),d.onOpenChange(!1))};if(o==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return s.jsx(ta,{scope:t,value:o,disabled:a,textId:h,isSelected:u,onItemTextChange:i.useCallback(j=>{f(S=>S||(j?.textContent??"").trim())},[]),children:s.jsx(Ue.ItemSlot,{scope:t,value:o,disabled:a,textValue:p,children:s.jsx(O.div,{role:"option","aria-labelledby":h,"data-highlighted":b?"":void 0,"aria-selected":u&&b,"data-state":u?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...l,ref:v,onFocus:L(l.onFocus,()=>x(!0)),onBlur:L(l.onBlur,()=>x(!1)),onClick:L(l.onClick,()=>{y.current!=="mouse"&&g()}),onPointerUp:L(l.onPointerUp,()=>{y.current==="mouse"&&g()}),onPointerDown:L(l.onPointerDown,j=>{y.current=j.pointerType}),onPointerMove:L(l.onPointerMove,j=>{y.current=j.pointerType,a?c.onItemLeave?.():y.current==="mouse"&&j.currentTarget.focus({preventScroll:!0})}),onPointerLeave:L(l.onPointerLeave,j=>{j.currentTarget===document.activeElement&&c.onItemLeave?.()}),onKeyDown:L(l.onKeyDown,j=>{c.searchRef?.current!==""&&j.key===" "||(Lo.includes(j.key)&&g(),j.key===" "&&j.preventDefault())})})})})});Dr.displayName=Le;var Pe="SelectItemText",Or=i.forwardRef((r,e)=>{const{__scopeSelect:t,className:o,style:a,...n}=r,l=de(Pe,t),d=ue(Pe,t),c=Mr(Pe,t),u=zo(Pe,t),[p,f]=i.useState(null),b=Z(e,g=>f(g),c.onItemTextChange,g=>d.itemTextRefCallback?.(g,c.value,c.disabled)),x=p?.textContent,v=i.useMemo(()=>s.jsx("option",{value:c.value,disabled:c.disabled,children:x},c.value),[c.disabled,c.value,x]),{onNativeOptionAdd:h,onNativeOptionRemove:y}=u;return ie(()=>(h(v),()=>y(v)),[h,y,v]),s.jsxs(s.Fragment,{children:[s.jsx(O.span,{id:c.textId,...n,ref:b}),c.isSelected&&l.valueNode&&!l.valueNodeHasChildren?tr.createPortal(n.children,l.valueNode):null]})});Or.displayName=Pe;var Br="SelectItemIndicator",$r=i.forwardRef((r,e)=>{const{__scopeSelect:t,...o}=r;return Mr(Br,t).isSelected?s.jsx(O.span,{"aria-hidden":!0,...o,ref:e}):null});$r.displayName=Br;var ct="SelectScrollUpButton",Lr=i.forwardRef((r,e)=>{const t=ue(ct,r.__scopeSelect),o=wt(ct,r.__scopeSelect),[a,n]=i.useState(!1),l=Z(e,o.onScrollButtonChange);return ie(()=>{if(t.viewport&&t.isPositioned){let d=function(){const u=c.scrollTop>0;n(u)};const c=t.viewport;return d(),c.addEventListener("scroll",d),()=>c.removeEventListener("scroll",d)}},[t.viewport,t.isPositioned]),a?s.jsx(Vr,{...r,ref:l,onAutoScroll:()=>{const{viewport:d,selectedItem:c}=t;d&&c&&(d.scrollTop=d.scrollTop-c.offsetHeight)}}):null});Lr.displayName=ct;var dt="SelectScrollDownButton",Fr=i.forwardRef((r,e)=>{const t=ue(dt,r.__scopeSelect),o=wt(dt,r.__scopeSelect),[a,n]=i.useState(!1),l=Z(e,o.onScrollButtonChange);return ie(()=>{if(t.viewport&&t.isPositioned){let d=function(){const u=c.scrollHeight-c.clientHeight,p=Math.ceil(c.scrollTop)<u;n(p)};const c=t.viewport;return d(),c.addEventListener("scroll",d),()=>c.removeEventListener("scroll",d)}},[t.viewport,t.isPositioned]),a?s.jsx(Vr,{...r,ref:l,onAutoScroll:()=>{const{viewport:d,selectedItem:c}=t;d&&c&&(d.scrollTop=d.scrollTop+c.offsetHeight)}}):null});Fr.displayName=dt;var Vr=i.forwardRef((r,e)=>{const{__scopeSelect:t,onAutoScroll:o,...a}=r,n=ue("SelectScrollButton",t),l=i.useRef(null),d=ze(t),c=i.useCallback(()=>{l.current!==null&&(window.clearInterval(l.current),l.current=null)},[]);return i.useEffect(()=>()=>c(),[c]),ie(()=>{d().find(p=>p.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[d]),s.jsx(O.div,{"aria-hidden":!0,...a,ref:e,style:{flexShrink:0,...a.style},onPointerDown:L(a.onPointerDown,()=>{l.current===null&&(l.current=window.setInterval(o,50))}),onPointerMove:L(a.onPointerMove,()=>{n.onItemLeave?.(),l.current===null&&(l.current=window.setInterval(o,50))}),onPointerLeave:L(a.onPointerLeave,()=>{c()})})}),ra="SelectSeparator",sa=i.forwardRef((r,e)=>{const{__scopeSelect:t,...o}=r;return s.jsx(O.div,{"aria-hidden":!0,...o,ref:e})});sa.displayName=ra;var ut="SelectArrow",oa=i.forwardRef((r,e)=>{const{__scopeSelect:t,...o}=r,a=qe(t),n=de(ut,t),l=ue(ut,t);return n.open&&l.position==="popper"?s.jsx(Jt,{...a,...o,ref:e}):null});oa.displayName=ut;var aa="SelectBubbleInput",Ur=i.forwardRef(({__scopeSelect:r,value:e,...t},o)=>{const a=i.useRef(null),n=Z(o,a),l=pr(e);return i.useEffect(()=>{const d=a.current;if(!d)return;const c=window.HTMLSelectElement.prototype,p=Object.getOwnPropertyDescriptor(c,"value").set;if(l!==e&&p){const f=new Event("change",{bubbles:!0});p.call(d,e),d.dispatchEvent(f)}},[l,e]),s.jsx(O.select,{...t,style:{...wr,...t.style},ref:n,defaultValue:e})});Ur.displayName=aa;function zr(r){return r===""||r===void 0}function qr(r){const e=ws(r),t=i.useRef(""),o=i.useRef(0),a=i.useCallback(l=>{const d=t.current+l;e(d),(function c(u){t.current=u,window.clearTimeout(o.current),u!==""&&(o.current=window.setTimeout(()=>c(""),1e3))})(d)},[e]),n=i.useCallback(()=>{t.current="",window.clearTimeout(o.current)},[]);return i.useEffect(()=>()=>window.clearTimeout(o.current),[]),[t,a,n]}function Hr(r,e,t){const a=e.length>1&&Array.from(e).every(u=>u===e[0])?e[0]:e,n=t?r.indexOf(t):-1;let l=na(r,Math.max(n,0));a.length===1&&(l=l.filter(u=>u!==t));const c=l.find(u=>u.textValue.toLowerCase().startsWith(a.toLowerCase()));return c!==t?c:void 0}function na(r,e){return r.map((t,o)=>r[(e+o)%r.length])}var la=br,ia=jr,ca=Sr,da=Cr,ua=kr,pa=_r,ma=Tr,fa=Dr,ha=Or,ga=$r,xa=Lr,va=Fr;function wa(r){const e=B.c(4);let t;e[0]!==r?({...t}=r,e[0]=r,e[1]=t):t=e[1];let o;return e[2]!==t?(o=s.jsx(la,{"data-slot":"select",...t}),e[2]=t,e[3]=o):o=e[3],o}function ba(r){const e=B.c(4);let t;e[0]!==r?({...t}=r,e[0]=r,e[1]=t):t=e[1];let o;return e[2]!==t?(o=s.jsx(ca,{"data-slot":"select-value",...t}),e[2]=t,e[3]=o):o=e[3],o}function ya(r){const e=B.c(13);let t,o,a,n;e[0]!==r?({className:o,size:n,children:t,...a}=r,e[0]=r,e[1]=t,e[2]=o,e[3]=a,e[4]=n):(t=e[1],o=e[2],a=e[3],n=e[4]);const l=n===void 0?"default":n;let d;e[5]!==o?(d=V("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",o),e[5]=o,e[6]=d):d=e[6];let c;e[7]===Symbol.for("react.memo_cache_sentinel")?(c=s.jsx(da,{asChild:!0,children:s.jsx(er,{className:"size-4 opacity-50"})}),e[7]=c):c=e[7];let u;return e[8]!==t||e[9]!==a||e[10]!==l||e[11]!==d?(u=s.jsxs(ia,{"data-slot":"select-trigger","data-size":l,className:d,...a,children:[t,c]}),e[8]=t,e[9]=a,e[10]=l,e[11]=d,e[12]=u):u=e[12],u}function ja(r){const e=B.c(20);let t,o,a,n;e[0]!==r?({className:o,children:t,position:n,...a}=r,e[0]=r,e[1]=t,e[2]=o,e[3]=a,e[4]=n):(t=e[1],o=e[2],a=e[3],n=e[4]);const l=n===void 0?"popper":n,d=l==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1";let c;e[5]!==o||e[6]!==d?(c=V("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",d,o),e[5]=o,e[6]=d,e[7]=c):c=e[7];let u;e[8]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsx(Na,{}),e[8]=u):u=e[8];const p=l==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1";let f;e[9]!==p?(f=V("p-1",p),e[9]=p,e[10]=f):f=e[10];let b;e[11]!==t||e[12]!==f?(b=s.jsx(ma,{className:f,children:t}),e[11]=t,e[12]=f,e[13]=b):b=e[13];let x;e[14]===Symbol.for("react.memo_cache_sentinel")?(x=s.jsx(Sa,{}),e[14]=x):x=e[14];let v;return e[15]!==l||e[16]!==a||e[17]!==c||e[18]!==b?(v=s.jsx(ua,{children:s.jsxs(pa,{"data-slot":"select-content",className:c,position:l,...a,children:[u,b,x]})}),e[15]=l,e[16]=a,e[17]=c,e[18]=b,e[19]=v):v=e[19],v}function Ye(r){const e=B.c(13);let t,o,a;e[0]!==r?({className:o,children:t,...a}=r,e[0]=r,e[1]=t,e[2]=o,e[3]=a):(t=e[1],o=e[2],a=e[3]);let n;e[4]!==o?(n=V("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",o),e[4]=o,e[5]=n):n=e[5];let l;e[6]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:s.jsx(ga,{children:s.jsx(Ts,{className:"size-4"})})}),e[6]=l):l=e[6];let d;e[7]!==t?(d=s.jsx(ha,{children:t}),e[7]=t,e[8]=d):d=e[8];let c;return e[9]!==a||e[10]!==n||e[11]!==d?(c=s.jsxs(fa,{"data-slot":"select-item",className:n,...a,children:[l,d]}),e[9]=a,e[10]=n,e[11]=d,e[12]=c):c=e[12],c}function Na(r){const e=B.c(9);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("flex cursor-default items-center justify-center py-1",t),e[3]=t,e[4]=a):a=e[4];let n;e[5]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx(Vs,{className:"size-4"}),e[5]=n):n=e[5];let l;return e[6]!==o||e[7]!==a?(l=s.jsx(xa,{"data-slot":"select-scroll-up-button",className:a,...o,children:n}),e[6]=o,e[7]=a,e[8]=l):l=e[8],l}function Sa(r){const e=B.c(9);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("flex cursor-default items-center justify-center py-1",t),e[3]=t,e[4]=a):a=e[4];let n;e[5]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx(er,{className:"size-4"}),e[5]=n):n=e[5];let l;return e[6]!==o||e[7]!==a?(l=s.jsx(va,{"data-slot":"select-scroll-down-button",className:a,...o,children:n}),e[6]=o,e[7]=a,e[8]=l):l=e[8],l}var He="Popover",[Wr]=gt(He,[Fe]),Te=Fe(),[Ca,pe]=Wr(He),Kr=r=>{const{__scopePopover:e,children:t,open:o,defaultOpen:a,onOpenChange:n,modal:l=!1}=r,d=Te(e),c=i.useRef(null),[u,p]=i.useState(!1),[f,b]=Be({prop:o,defaultProp:a??!1,onChange:n,caller:He});return s.jsx(Xt,{...d,children:s.jsx(Ca,{scope:e,contentId:le(),triggerRef:c,open:f,onOpenChange:b,onOpenToggle:i.useCallback(()=>b(x=>!x),[b]),hasCustomAnchor:u,onCustomAnchorAdd:i.useCallback(()=>p(!0),[]),onCustomAnchorRemove:i.useCallback(()=>p(!1),[]),modal:l,children:t})})};Kr.displayName=He;var Qr="PopoverAnchor",ka=i.forwardRef((r,e)=>{const{__scopePopover:t,...o}=r,a=pe(Qr,t),n=Te(t),{onCustomAnchorAdd:l,onCustomAnchorRemove:d}=a;return i.useEffect(()=>(l(),()=>d()),[l,d]),s.jsx(xt,{...n,...o,ref:e})});ka.displayName=Qr;var Gr="PopoverTrigger",Yr=i.forwardRef((r,e)=>{const{__scopePopover:t,...o}=r,a=pe(Gr,t),n=Te(t),l=Z(e,a.triggerRef),d=s.jsx(O.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":ts(a.open),...o,ref:l,onClick:L(r.onClick,a.onOpenToggle)});return a.hasCustomAnchor?d:s.jsx(xt,{asChild:!0,...n,children:d})});Yr.displayName=Gr;var bt="PopoverPortal",[_a,Pa]=Wr(bt,{forceMount:void 0}),Xr=r=>{const{__scopePopover:e,forceMount:t,children:o,container:a}=r,n=pe(bt,e);return s.jsx(_a,{scope:e,forceMount:t,children:s.jsx(Yt,{present:t||n.open,children:s.jsx(qt,{asChild:!0,container:a,children:o})})})};Xr.displayName=bt;var Se="PopoverContent",Zr=i.forwardRef((r,e)=>{const t=Pa(Se,r.__scopePopover),{forceMount:o=t.forceMount,...a}=r,n=pe(Se,r.__scopePopover);return s.jsx(Yt,{present:o||n.open,children:n.modal?s.jsx(Ea,{...a,ref:e}):s.jsx(Ta,{...a,ref:e})})});Zr.displayName=Se;var Ra=zt("PopoverContent.RemoveScroll"),Ea=i.forwardRef((r,e)=>{const t=pe(Se,r.__scopePopover),o=i.useRef(null),a=Z(e,o),n=i.useRef(!1);return i.useEffect(()=>{const l=o.current;if(l)return Ht(l)},[]),s.jsx(Kt,{as:Ra,allowPinchZoom:!0,children:s.jsx(Jr,{...r,ref:a,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:L(r.onCloseAutoFocus,l=>{l.preventDefault(),n.current||t.triggerRef.current?.focus()}),onPointerDownOutside:L(r.onPointerDownOutside,l=>{const d=l.detail.originalEvent,c=d.button===0&&d.ctrlKey===!0,u=d.button===2||c;n.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:L(r.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ta=i.forwardRef((r,e)=>{const t=pe(Se,r.__scopePopover),o=i.useRef(!1),a=i.useRef(!1);return s.jsx(Jr,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:n=>{r.onCloseAutoFocus?.(n),n.defaultPrevented||(o.current||t.triggerRef.current?.focus(),n.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:n=>{r.onInteractOutside?.(n),n.defaultPrevented||(o.current=!0,n.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const l=n.target;t.triggerRef.current?.contains(l)&&n.preventDefault(),n.detail.originalEvent.type==="focusin"&&a.current&&n.preventDefault()}})}),Jr=i.forwardRef((r,e)=>{const{__scopePopover:t,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:n,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:p,...f}=r,b=pe(Se,t),x=Te(t);return Wt(),s.jsx(Qt,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:n,children:s.jsx(Gt,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:p,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:u,onDismiss:()=>b.onOpenChange(!1),children:s.jsx(Zt,{"data-state":ts(b.open),role:"dialog",id:b.contentId,...x,...f,ref:e,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),es="PopoverClose",Ia=i.forwardRef((r,e)=>{const{__scopePopover:t,...o}=r,a=pe(es,t);return s.jsx(O.button,{type:"button",...o,ref:e,onClick:L(r.onClick,()=>a.onOpenChange(!1))})});Ia.displayName=es;var Aa="PopoverArrow",Ma=i.forwardRef((r,e)=>{const{__scopePopover:t,...o}=r,a=Te(t);return s.jsx(Jt,{...a,...o,ref:e})});Ma.displayName=Aa;function ts(r){return r?"open":"closed"}var Da=Kr,Oa=Yr,Ba=Xr,$a=Zr;function La(r){const e=B.c(4);let t;e[0]!==r?({...t}=r,e[0]=r,e[1]=t):t=e[1];let o;return e[2]!==t?(o=s.jsx(Da,{"data-slot":"popover",...t}),e[2]=t,e[3]=o):o=e[3],o}function Fa(r){const e=B.c(4);let t;e[0]!==r?({...t}=r,e[0]=r,e[1]=t):t=e[1];let o;return e[2]!==t?(o=s.jsx(Oa,{"data-slot":"popover-trigger",...t}),e[2]=t,e[3]=o):o=e[3],o}function Va(r){const e=B.c(12);let t,o,a,n;e[0]!==r?({className:t,align:a,sideOffset:n,...o}=r,e[0]=r,e[1]=t,e[2]=o,e[3]=a,e[4]=n):(t=e[1],o=e[2],a=e[3],n=e[4]);const l=a===void 0?"center":a,d=n===void 0?4:n;let c;e[5]!==t?(c=V("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),e[5]=t,e[6]=c):c=e[6];let u;return e[7]!==l||e[8]!==o||e[9]!==d||e[10]!==c?(u=s.jsx(Ba,{children:s.jsx($a,{"data-slot":"popover-content",align:l,sideOffset:d,className:c,...o})}),e[7]=l,e[8]=o,e[9]=d,e[10]=c,e[11]=u):u=e[11],u}var Pt=1,Ua=.9,za=.8,qa=.17,Xe=.1,Ze=.999,Ha=.9999,Wa=.99,Ka=/[\\\/_+.#"@\[\(\{&]/,Qa=/[\\\/_+.#"@\[\(\{&]/g,Ga=/[\s-]/,rs=/[\s-]/g;function pt(r,e,t,o,a,n,l){if(n===e.length)return a===r.length?Pt:Wa;var d=`${a},${n}`;if(l[d]!==void 0)return l[d];for(var c=o.charAt(n),u=t.indexOf(c,a),p=0,f,b,x,v;u>=0;)f=pt(r,e,t,o,u+1,n+1,l),f>p&&(u===a?f*=Pt:Ka.test(r.charAt(u-1))?(f*=za,x=r.slice(a,u-1).match(Qa),x&&a>0&&(f*=Math.pow(Ze,x.length))):Ga.test(r.charAt(u-1))?(f*=Ua,v=r.slice(a,u-1).match(rs),v&&a>0&&(f*=Math.pow(Ze,v.length))):(f*=qa,a>0&&(f*=Math.pow(Ze,u-a))),r.charAt(u)!==e.charAt(n)&&(f*=Ha)),(f<Xe&&t.charAt(u-1)===o.charAt(n+1)||o.charAt(n+1)===o.charAt(n)&&t.charAt(u-1)!==o.charAt(n))&&(b=pt(r,e,t,o,u+1,n+2,l),b*Xe>f&&(f=b*Xe)),f>p&&(p=f),u=t.indexOf(c,u+1);return l[d]=p,p}function Rt(r){return r.toLowerCase().replace(rs," ")}function Ya(r,e,t){return r=t&&t.length>0?`${r+" "+t.join(" ")}`:r,pt(r,e,Rt(r),Rt(e),0,0,{})}var _e='[cmdk-group=""]',Je='[cmdk-group-items=""]',Xa='[cmdk-group-heading=""]',ss='[cmdk-item=""]',Et=`${ss}:not([aria-disabled="true"])`,mt="cmdk-item-select",je="data-value",Za=(r,e,t)=>Ya(r,e,t),os=i.createContext(void 0),Ie=()=>i.useContext(os),as=i.createContext(void 0),yt=()=>i.useContext(as),ns=i.createContext(void 0),ls=i.forwardRef((r,e)=>{let t=Ne(()=>{var m,k;return{search:"",value:(k=(m=r.value)!=null?m:r.defaultValue)!=null?k:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),o=Ne(()=>new Set),a=Ne(()=>new Map),n=Ne(()=>new Map),l=Ne(()=>new Set),d=is(r),{label:c,children:u,value:p,onValueChange:f,filter:b,shouldFilter:x,loop:v,disablePointerSelection:h=!1,vimBindings:y=!0,...g}=r,j=le(),S=le(),D=le(),I=i.useRef(null),_=dn();we(()=>{if(p!==void 0){let m=p.trim();t.current.value=m,R.emit()}},[p]),we(()=>{_(6,re)},[]);let R=i.useMemo(()=>({subscribe:m=>(l.current.add(m),()=>l.current.delete(m)),snapshot:()=>t.current,setState:(m,k,P)=>{var N,E,w,T;if(!Object.is(t.current[m],k)){if(t.current[m]=k,m==="search")H(),C(),_(1,$);else if(m==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let A=document.getElementById(D);A?A.focus():(N=document.getElementById(j))==null||N.focus()}if(_(7,()=>{var A;t.current.selectedItemId=(A=W())==null?void 0:A.id,R.emit()}),P||_(5,re),((E=d.current)==null?void 0:E.value)!==void 0){let A=k??"";(T=(w=d.current).onValueChange)==null||T.call(w,A);return}}R.emit()}},emit:()=>{l.current.forEach(m=>m())}}),[]),U=i.useMemo(()=>({value:(m,k,P)=>{var N;k!==((N=n.current.get(m))==null?void 0:N.value)&&(n.current.set(m,{value:k,keywords:P}),t.current.filtered.items.set(m,J(k,P)),_(2,()=>{C(),R.emit()}))},item:(m,k)=>(o.current.add(m),k&&(a.current.has(k)?a.current.get(k).add(m):a.current.set(k,new Set([m]))),_(3,()=>{H(),C(),t.current.value||$(),R.emit()}),()=>{n.current.delete(m),o.current.delete(m),t.current.filtered.items.delete(m);let P=W();_(4,()=>{H(),P?.getAttribute("id")===m&&$(),R.emit()})}),group:m=>(a.current.has(m)||a.current.set(m,new Set),()=>{n.current.delete(m),a.current.delete(m)}),filter:()=>d.current.shouldFilter,label:c||r["aria-label"],getDisablePointerSelection:()=>d.current.disablePointerSelection,listId:j,inputId:D,labelId:S,listInnerRef:I}),[]);function J(m,k){var P,N;let E=(N=(P=d.current)==null?void 0:P.filter)!=null?N:Za;return m?E(m,t.current.search,k):0}function C(){if(!t.current.search||d.current.shouldFilter===!1)return;let m=t.current.filtered.items,k=[];t.current.filtered.groups.forEach(N=>{let E=a.current.get(N),w=0;E.forEach(T=>{let A=m.get(T);w=Math.max(A,w)}),k.push([N,w])});let P=I.current;K().sort((N,E)=>{var w,T;let A=N.getAttribute("id"),M=E.getAttribute("id");return((w=m.get(M))!=null?w:0)-((T=m.get(A))!=null?T:0)}).forEach(N=>{let E=N.closest(Je);E?E.appendChild(N.parentElement===E?N:N.closest(`${Je} > *`)):P.appendChild(N.parentElement===P?N:N.closest(`${Je} > *`))}),k.sort((N,E)=>E[1]-N[1]).forEach(N=>{var E;let w=(E=I.current)==null?void 0:E.querySelector(`${_e}[${je}="${encodeURIComponent(N[0])}"]`);w?.parentElement.appendChild(w)})}function $(){let m=K().find(P=>P.getAttribute("aria-disabled")!=="true"),k=m?.getAttribute(je);R.setState("value",k||void 0)}function H(){var m,k,P,N;if(!t.current.search||d.current.shouldFilter===!1){t.current.filtered.count=o.current.size;return}t.current.filtered.groups=new Set;let E=0;for(let w of o.current){let T=(k=(m=n.current.get(w))==null?void 0:m.value)!=null?k:"",A=(N=(P=n.current.get(w))==null?void 0:P.keywords)!=null?N:[],M=J(T,A);t.current.filtered.items.set(w,M),M>0&&E++}for(let[w,T]of a.current)for(let A of T)if(t.current.filtered.items.get(A)>0){t.current.filtered.groups.add(w);break}t.current.filtered.count=E}function re(){var m,k,P;let N=W();N&&(((m=N.parentElement)==null?void 0:m.firstChild)===N&&((P=(k=N.closest(_e))==null?void 0:k.querySelector(Xa))==null||P.scrollIntoView({block:"nearest"})),N.scrollIntoView({block:"nearest"}))}function W(){var m;return(m=I.current)==null?void 0:m.querySelector(`${ss}[aria-selected="true"]`)}function K(){var m;return Array.from(((m=I.current)==null?void 0:m.querySelectorAll(Et))||[])}function z(m){let k=K()[m];k&&R.setState("value",k.getAttribute(je))}function Y(m){var k;let P=W(),N=K(),E=N.findIndex(T=>T===P),w=N[E+m];(k=d.current)!=null&&k.loop&&(w=E+m<0?N[N.length-1]:E+m===N.length?N[0]:N[E+m]),w&&R.setState("value",w.getAttribute(je))}function ee(m){let k=W(),P=k?.closest(_e),N;for(;P&&!N;)P=m>0?ln(P,_e):cn(P,_e),N=P?.querySelector(Et);N?R.setState("value",N.getAttribute(je)):Y(m)}let se=()=>z(K().length-1),be=m=>{m.preventDefault(),m.metaKey?se():m.altKey?ee(1):Y(1)},me=m=>{m.preventDefault(),m.metaKey?z(0):m.altKey?ee(-1):Y(-1)};return i.createElement(O.div,{ref:e,tabIndex:-1,...g,"cmdk-root":"",onKeyDown:m=>{var k;(k=g.onKeyDown)==null||k.call(g,m);let P=m.nativeEvent.isComposing||m.keyCode===229;if(!(m.defaultPrevented||P))switch(m.key){case"n":case"j":{y&&m.ctrlKey&&be(m);break}case"ArrowDown":{be(m);break}case"p":case"k":{y&&m.ctrlKey&&me(m);break}case"ArrowUp":{me(m);break}case"Home":{m.preventDefault(),z(0);break}case"End":{m.preventDefault(),se();break}case"Enter":{m.preventDefault();let N=W();if(N){let E=new Event(mt);N.dispatchEvent(E)}}}}},i.createElement("label",{"cmdk-label":"",htmlFor:U.inputId,id:U.labelId,style:pn},c),We(r,m=>i.createElement(as.Provider,{value:R},i.createElement(os.Provider,{value:U},m))))}),Ja=i.forwardRef((r,e)=>{var t,o;let a=le(),n=i.useRef(null),l=i.useContext(ns),d=Ie(),c=is(r),u=(o=(t=c.current)==null?void 0:t.forceMount)!=null?o:l?.forceMount;we(()=>{if(!u)return d.item(a,l?.id)},[u]);let p=cs(a,n,[r.value,r.children,n],r.keywords),f=yt(),b=ce(_=>_.value&&_.value===p.current),x=ce(_=>u||d.filter()===!1?!0:_.search?_.filtered.items.get(a)>0:!0);i.useEffect(()=>{let _=n.current;if(!(!_||r.disabled))return _.addEventListener(mt,v),()=>_.removeEventListener(mt,v)},[x,r.onSelect,r.disabled]);function v(){var _,R;h(),(R=(_=c.current).onSelect)==null||R.call(_,p.current)}function h(){f.setState("value",p.current,!0)}if(!x)return null;let{disabled:y,value:g,onSelect:j,forceMount:S,keywords:D,...I}=r;return i.createElement(O.div,{ref:Ee(n,e),...I,id:a,"cmdk-item":"",role:"option","aria-disabled":!!y,"aria-selected":!!b,"data-disabled":!!y,"data-selected":!!b,onPointerMove:y||d.getDisablePointerSelection()?void 0:h,onClick:y?void 0:v},r.children)}),en=i.forwardRef((r,e)=>{let{heading:t,children:o,forceMount:a,...n}=r,l=le(),d=i.useRef(null),c=i.useRef(null),u=le(),p=Ie(),f=ce(x=>a||p.filter()===!1?!0:x.search?x.filtered.groups.has(l):!0);we(()=>p.group(l),[]),cs(l,d,[r.value,r.heading,c]);let b=i.useMemo(()=>({id:l,forceMount:a}),[a]);return i.createElement(O.div,{ref:Ee(d,e),...n,"cmdk-group":"",role:"presentation",hidden:f?void 0:!0},t&&i.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:u},t),We(r,x=>i.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":t?u:void 0},i.createElement(ns.Provider,{value:b},x))))}),tn=i.forwardRef((r,e)=>{let{alwaysRender:t,...o}=r,a=i.useRef(null),n=ce(l=>!l.search);return!t&&!n?null:i.createElement(O.div,{ref:Ee(a,e),...o,"cmdk-separator":"",role:"separator"})}),rn=i.forwardRef((r,e)=>{let{onValueChange:t,...o}=r,a=r.value!=null,n=yt(),l=ce(u=>u.search),d=ce(u=>u.selectedItemId),c=Ie();return i.useEffect(()=>{r.value!=null&&n.setState("search",r.value)},[r.value]),i.createElement(O.input,{ref:e,...o,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":d,id:c.inputId,type:"text",value:a?r.value:l,onChange:u=>{a||n.setState("search",u.target.value),t?.(u.target.value)}})}),sn=i.forwardRef((r,e)=>{let{children:t,label:o="Suggestions",...a}=r,n=i.useRef(null),l=i.useRef(null),d=ce(u=>u.selectedItemId),c=Ie();return i.useEffect(()=>{if(l.current&&n.current){let u=l.current,p=n.current,f,b=new ResizeObserver(()=>{f=requestAnimationFrame(()=>{let x=u.offsetHeight;p.style.setProperty("--cmdk-list-height",x.toFixed(1)+"px")})});return b.observe(u),()=>{cancelAnimationFrame(f),b.unobserve(u)}}},[]),i.createElement(O.div,{ref:Ee(n,e),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":d,"aria-label":o,id:c.listId},We(r,u=>i.createElement("div",{ref:Ee(l,c.listInnerRef),"cmdk-list-sizer":""},u)))}),on=i.forwardRef((r,e)=>{let{open:t,onOpenChange:o,overlayClassName:a,contentClassName:n,container:l,...d}=r;return i.createElement(bs,{open:t,onOpenChange:o},i.createElement(ys,{container:l},i.createElement(js,{"cmdk-overlay":"",className:a}),i.createElement(Ns,{"aria-label":r.label,"cmdk-dialog":"",className:n},i.createElement(ls,{ref:e,...d}))))}),an=i.forwardRef((r,e)=>ce(t=>t.filtered.count===0)?i.createElement(O.div,{ref:e,...r,"cmdk-empty":"",role:"presentation"}):null),nn=i.forwardRef((r,e)=>{let{progress:t,children:o,label:a="Loading...",...n}=r;return i.createElement(O.div,{ref:e,...n,"cmdk-loading":"",role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},We(r,l=>i.createElement("div",{"aria-hidden":!0},l)))}),ke=Object.assign(ls,{List:sn,Item:Ja,Input:rn,Group:en,Separator:tn,Dialog:on,Empty:an,Loading:nn});function ln(r,e){let t=r.nextElementSibling;for(;t;){if(t.matches(e))return t;t=t.nextElementSibling}}function cn(r,e){let t=r.previousElementSibling;for(;t;){if(t.matches(e))return t;t=t.previousElementSibling}}function is(r){let e=i.useRef(r);return we(()=>{e.current=r}),e}var we=typeof window>"u"?i.useEffect:i.useLayoutEffect;function Ne(r){let e=i.useRef();return e.current===void 0&&(e.current=r()),e}function ce(r){let e=yt(),t=()=>r(e.snapshot());return i.useSyncExternalStore(e.subscribe,t,t)}function cs(r,e,t,o=[]){let a=i.useRef(),n=Ie();return we(()=>{var l;let d=(()=>{var u;for(let p of t){if(typeof p=="string")return p.trim();if(typeof p=="object"&&"current"in p)return p.current?(u=p.current.textContent)==null?void 0:u.trim():a.current}})(),c=o.map(u=>u.trim());n.value(r,d,c),(l=e.current)==null||l.setAttribute(je,d),a.current=d}),a}var dn=()=>{let[r,e]=i.useState(),t=Ne(()=>new Map);return we(()=>{t.current.forEach(o=>o()),t.current=new Map},[r]),(o,a)=>{t.current.set(o,a),e({})}};function un(r){let e=r.type;return typeof e=="function"?e(r.props):"render"in e?e.render(r.props):r}function We({asChild:r,children:e},t){return r&&i.isValidElement(e)?i.cloneElement(un(e),{ref:e.ref},t(e.props.children)):t(e)}var pn={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};function mn(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx(ke,{"data-slot":"command",className:a,...o}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}function fn(r){const e=B.c(9);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsx(Js,{className:"size-4 shrink-0 opacity-50"}),e[3]=a):a=e[3];let n;e[4]!==t?(n=V("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",t),e[4]=t,e[5]=n):n=e[5];let l;return e[6]!==o||e[7]!==n?(l=s.jsxs("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[a,s.jsx(ke.Input,{"data-slot":"command-input",className:n,...o})]}),e[6]=o,e[7]=n,e[8]=l):l=e[8],l}function hn(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx(ke.List,{"data-slot":"command-list",className:a,...o}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}function gn(r){const e=B.c(4);let t;e[0]!==r?({...t}=r,e[0]=r,e[1]=t):t=e[1];let o;return e[2]!==t?(o=s.jsx(ke.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...t}),e[2]=t,e[3]=o):o=e[3],o}function xn(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx(ke.Group,{"data-slot":"command-group",className:a,...o}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}function vn(r){const e=B.c(8);let t,o;e[0]!==r?({className:t,...o}=r,e[0]=r,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let a;e[3]!==t?(a=V("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),e[3]=t,e[4]=a):a=e[4];let n;return e[5]!==o||e[6]!==a?(n=s.jsx(ke.Item,{"data-slot":"command-item",className:a,...o}),e[5]=o,e[6]=a,e[7]=n):n=e[7],n}const ds=[{name:"Golden Retriever",defaultColors:["Golden"]},{name:"Labrador Retriever",defaultColors:["Yellow","Black","Chocolate"]},{name:"German Shepherd",defaultColors:["Black/Tan","Sable","Black"]},{name:"French Bulldog",defaultColors:["Fawn","Brindle","Cream","Pied"]},{name:"Poodle",defaultColors:["White","Black","Apricot","Red"]},{name:"Bulldog",defaultColors:["Fawn","Brindle","White","Piebald"]},{name:"Beagle",defaultColors:["Tri-color","Lemon/White","Red/White"]},{name:"Rottweiler",defaultColors:["Black/Rust"]},{name:"Dachshund",defaultColors:["Red","Black/Tan","Chocolate/Tan","Dapple"]},{name:"Yorkshire Terrier",defaultColors:["Blue/Tan"]}],us=[{name:"Bicolor / Tuxedo",defaultColors:["Black/White","Gray/White","Seal/White"]},{name:"Calico",defaultColors:["Black/Orange/White","Dilute (Blue/Cream/White)"]},{name:"Pointed",defaultColors:["Seal point","Blue point","Chocolate point","Lilac point","Flame point"]},{name:"Shaded",defaultColors:["Shaded Silver","Shaded Golden"]},{name:"Smoke",defaultColors:["Black Smoke","Blue Smoke"]},{name:"Solid",defaultColors:["Black","White","Blue/Gray","Red/Orange","Cream"]},{name:"Spotted",defaultColors:["Brown Spotted","Silver Spotted"]},{name:"Tabby",defaultColors:["Brown Tabby","Gray/Blue Tabby","Orange Tabby","Silver Tabby","Torbie"]},{name:"Tortoiseshell (Tortie)",defaultColors:["Black/Orange","Chocolate/Cream","Dilute (Blue/Cream)"]}];function wn(r,e){return!r||!e?[]:r==="dog"?ds.find(o=>o.name===e)?.defaultColors??[]:r==="cat"?us.find(o=>o.name===e)?.defaultColors??[]:[]}const bn=ds.map(r=>r.name),yn=us.map(r=>r.name);function jn({label:r="Photo",value:e,onChange:t,options:o,accept:a="image/*",className:n}){const l=i.useRef(null),d=()=>l.current?.click(),c=()=>t(null),u=async p=>{if(!p||!p.type.startsWith("image/"))return;const f=await Nn(p,o);t(f)};return s.jsxs("div",{className:n,children:[s.jsx(X,{className:"mb-2 block",children:r}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Q,{type:"button",variant:"outline",onClick:d,children:e?"Replace Image":"Upload Image"}),e&&s.jsx(Q,{type:"button",variant:"ghost",onClick:c,children:"Remove"})]}),s.jsx(ne,{ref:l,type:"file",accept:a,className:"hidden",onChange:p=>{const f=p.target.files?.[0];f&&u(f),p.currentTarget.value=""}}),e&&s.jsxs(s.Fragment,{children:[s.jsx(nt,{className:"my-3"}),s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("img",{src:e.dataUrl,alt:"preview",className:"h-24 w-24 rounded-md object-cover border"}),s.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-foreground",children:"Optimized:"})," ",e.mimeType]}),s.jsxs("div",{children:["Size: ~",e.approxKB.toLocaleString()," KB"]}),s.jsxs("div",{children:["Dims: ",e.width," × ",e.height]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"font-medium text-foreground",children:"Original:"})," ",e.original.name," — ",e.original.sizeKB.toLocaleString()," KB"]})]})]})]})]})}async function Nn(r,e){const t=await r.arrayBuffer(),o=new Blob([t]),a=await Cn(o),n=e?.maxWidth??1200,l=e?.maxHeight??1200,{width:d,height:c}=Sn(a.width,a.height,n,l),u=document.createElement("canvas");u.width=d,u.height=c,u.getContext("2d").drawImage(a,0,0,d,c);const f=e?.preferWebP??!0,b=e?.quality??.82,x=u.toDataURL("image/webp").startsWith("data:image/webp"),v=f&&x?"image/webp":"image/jpeg",h=await kn(u,v,b),y=await _n(h);return{blob:h,dataUrl:y,width:d,height:c,approxKB:Math.round(h.size/1024),mimeType:v,original:{name:r.name,sizeKB:Math.round(r.size/1024),type:r.type}}}function Sn(r,e,t,o){const a=Math.min(t/r,o/e,1);return{width:Math.round(r*a),height:Math.round(e*a)}}function Cn(r){return new Promise((e,t)=>{const o=URL.createObjectURL(r),a=new Image;a.onload=()=>{URL.revokeObjectURL(o),e(a)},a.onerror=t,a.src=o})}function kn(r,e,t){return new Promise(o=>r.toBlob(a=>o(a),e,t))}function _n(r){return new Promise(e=>{const t=new FileReader;t.onload=()=>e(String(t.result)),t.readAsDataURL(r)})}const Pn=St({id:ae().optional(),name:ae().min(1,"Name is required"),species:Rs(["dog","cat","other"],{message:"Choose a species"}),breed:ae().optional(),color:ae().optional(),weight:Ps().min(0,"Weight must be positive").optional(),birthdate:ae().optional(),microchipId:ae().optional(),description:ae().optional(),notes:ae().optional(),vaccinations:St({rabies:Es().default(!1),rabiesExpires:ae().optional()}).default({rabies:!1,rabiesExpires:""}),photoPreview:ae().optional()});async function Tt(r){return await(await fetch(r)).blob()}function It({mode:r,open:e,onOpenChange:t,initialPet:o,onSubmit:a}){const{user:n}=ft(),[l,d]=i.useState(!1),c=ks({resolver:_s(Pn),defaultValues:{id:o?.id,name:o?.name??"",species:o?.species,breed:o?.breed??"",color:o?.color??"",weight:o?.weight??void 0,birthdate:o?.birthdate??"",microchipId:o?.microchipId??"",description:o?.description??"",notes:o?.notes??"",vaccinations:{rabies:o?.vaccinations?.rabies??!1,rabiesExpires:o?.vaccinations?.rabiesExpires??""},photoPreview:o?.photoPreview??""},mode:"onSubmit"}),u=c.watch("species"),p=c.watch("breed"),[f,b]=i.useState(!1),x=i.useRef(null),v=i.useMemo(()=>u==="dog"?bn:u==="cat"?yn:[],[u]),h=i.useMemo(()=>wn(u??"other",p),[u,p]),y=async g=>{if(!n?.id){alert("You must be signed in.");return}d(!0);const j={rabies:!!g.vaccinations?.rabies,rabiesExpires:g.vaccinations?.rabies&&g.vaccinations.rabiesExpires||void 0},S={owner_id:n.id,name:g.name,species:g.species,breed:g.breed||null,color:g.color||null,weight:typeof g.weight=="number"?g.weight:null,birthdate:g.birthdate||null,microchip_id:g.microchipId||null,description:g.description||null,notes:g.notes||null,vaccinations:j};try{let D;if(r==="add"){D=await Po({...S});try{const _=await vt(n.id,D.short_id);await Re(D.id,{qr_url:_})}catch(_){console.warn("QR generation failed (non-blocking):",_?.message)}let I=x.current;if(!I&&g.photoPreview&&(I=await Tt(g.photoPreview)),I&&I.size>0){const _=await kt(n.id,D.id,I);D=await Re(D.id,{photo_url:_})}}else{const I=g.id||o?.id;if(!I)throw new Error("Missing pet id for update.");let _=x.current;!_&&g.photoPreview&&(_=await Tt(g.photoPreview));const R={name:S.name,species:S.species,breed:S.breed,color:S.color,weight:S.weight,birthdate:S.birthdate,microchip_id:S.microchip_id,description:S.description,notes:S.notes,vaccinations:S.vaccinations};if(_&&_.size>0){const U=await kt(n.id,I,_);R.photo_url=U}D=await Re(I,R)}a?.(g),t(!1),r==="add"&&c.reset()}catch(D){console.error(D),alert(D?.message??"Failed to save pet")}finally{d(!1)}};return s.jsx(or,{open:e,onOpenChange:g=>!l&&t(g),children:s.jsxs(ar,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900",children:[s.jsx(nr,{className:"space-y-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center ring-4 ring-primary/5",children:s.jsx(ge,{className:"h-5 w-5 text-primary"})}),s.jsxs("div",{children:[s.jsx(lr,{className:"text-2xl",children:r==="add"?"Add New Pet":"Edit Pet"}),s.jsx(ir,{className:"text-base",children:r==="add"?"Enter your pet's details to create their profile":"Update your pet's information"})]})]})}),s.jsxs("form",{onSubmit:c.handleSubmit(y),className:"space-y-6 mt-4",children:[s.jsxs("section",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[s.jsx(ur,{className:"h-4 w-4 text-primary"}),"Basic Information"]}),s.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-primary/20",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(X,{htmlFor:"name",className:"text-sm font-medium flex items-center gap-2",children:["Name ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(ne,{id:"name",...c.register("name"),placeholder:"e.g., Milo, Luna, Max",className:"h-11 transition-all duration-200 focus:ring-2 focus:ring-primary/20"}),c.formState.errors.name&&s.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1.5 animate-in fade-in-50",children:[s.jsx(Oe,{className:"h-3.5 w-3.5"}),c.formState.errors.name.message]})]}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(X,{className:"text-sm font-medium flex items-center gap-2",children:["Species ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs(wa,{value:u,onValueChange:g=>{c.setValue("species",g,{shouldValidate:!0}),c.setValue("breed",""),c.setValue("color","")},children:[s.jsx(ya,{className:"h-11",children:s.jsx(ba,{placeholder:"Select species"})}),s.jsxs(ja,{children:[s.jsx(Ye,{value:"dog",children:"🐕 Dog"}),s.jsx(Ye,{value:"cat",children:"🐱 Cat"}),s.jsx(Ye,{value:"other",children:"🐾 Other"})]})]}),c.formState.errors.species&&s.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1.5",children:[s.jsx(Oe,{className:"h-3.5 w-3.5"}),c.formState.errors.species.message]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(X,{htmlFor:"birthdate",className:"text-sm font-medium flex items-center gap-2",children:[s.jsx(Bs,{className:"h-3.5 w-3.5"}),"Birthdate"]}),s.jsx(ne,{id:"birthdate",type:"date",...c.register("birthdate"),className:"h-11"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(X,{className:"text-sm font-medium flex items-center gap-2",children:[s.jsx(ge,{className:"h-3.5 w-3.5"}),u==="cat"?"Pattern":"Breed",u==="other"&&s.jsx("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(ne,{placeholder:u==="dog"?"e.g., Golden Retriever":u==="cat"?"e.g., Tabby, Calico":"e.g., Rabbit, Guinea Pig",...c.register("breed"),className:"h-11 flex-1"}),v.length>0&&s.jsxs(La,{open:f,onOpenChange:b,children:[s.jsx(Fa,{asChild:!0,children:s.jsxs(Q,{type:"button",variant:"outline",className:"w-36 justify-between h-11",children:["Suggestions ",s.jsx(zs,{className:"h-4 w-4 opacity-60"})]})}),s.jsx(Va,{className:"p-0 w-64",children:s.jsxs(mn,{children:[s.jsx(fn,{placeholder:"Search…"}),s.jsxs(hn,{children:[s.jsx(gn,{children:"No matches found."}),s.jsx(xn,{children:v.map(g=>s.jsx(vn,{value:g,onSelect:j=>{c.setValue("breed",j),b(!1)},children:g},g))})]})]})})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(X,{htmlFor:"color",className:"text-sm font-medium flex items-center gap-2",children:[s.jsx(Gs,{className:"h-3.5 w-3.5"}),"Color"]}),s.jsx(ne,{id:"color",...c.register("color"),placeholder:"e.g., Brown, White, Mixed",className:"h-11"}),h.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:h.map(g=>s.jsx("button",{type:"button",onClick:()=>c.setValue("color",g,{shouldValidate:!0}),className:"rounded-full border border-primary/20 bg-primary/5 px-3 py-1 text-xs font-medium hover:bg-primary/10 transition-colors",children:g},g))})]}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(X,{htmlFor:"weight",className:"text-sm font-medium flex items-center gap-2",children:[s.jsx(no,{className:"h-3.5 w-3.5"}),"Weight (lbs)"]}),s.jsx(ne,{id:"weight",type:"number",step:"0.1",placeholder:"e.g., 45.5",...c.register("weight",{valueAsNumber:!0}),className:"h-11"}),c.formState.errors.weight&&s.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1.5",children:[s.jsx(Oe,{className:"h-3.5 w-3.5"}),c.formState.errors.weight.message]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(X,{htmlFor:"microchipId",className:"text-sm font-medium flex items-center gap-2",children:[s.jsx(Is,{className:"h-3.5 w-3.5"}),"Microchip ID"]}),s.jsx(ne,{id:"microchipId",...c.register("microchipId"),placeholder:"e.g., 981000012345678",className:"h-11"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(X,{htmlFor:"description",className:"text-sm font-medium",children:"Physical Description"}),s.jsx(ne,{id:"description",...c.register("description"),placeholder:"e.g., White paws, brown spot on left ear",className:"h-11"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(X,{htmlFor:"notes",className:"text-sm font-medium",children:"Additional Notes"}),s.jsx(fs,{id:"notes",...c.register("notes"),placeholder:"Allergies, medications, behavioral notes, vet contact info...",className:"min-h-[80px] resize-none"})]})]})]}),s.jsx(nt,{}),s.jsxs("section",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[s.jsx(oo,{className:"h-4 w-4 text-primary"}),"Vaccinations"]}),s.jsxs("div",{className:"space-y-3 pl-6 border-l-2 border-primary/20",children:[s.jsx(rr,{className:"border-blue-200 bg-blue-50 dark:border-blue-900 dark:bg-blue-950",children:s.jsx(sr,{className:"text-xs text-blue-800 dark:text-blue-200",children:"Keep track of your pet's vaccination records for their health and safety"})}),s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 bg-secondary/30 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.jsx("input",{id:"rabies",type:"checkbox",className:"h-4 w-4 rounded border-primary text-primary focus:ring-primary",checked:!!c.watch("vaccinations.rabies"),onChange:g=>c.setValue("vaccinations.rabies",g.target.checked)}),s.jsx(X,{htmlFor:"rabies",className:"text-sm font-medium cursor-pointer",children:"Rabies Vaccination"})]}),s.jsxs("div",{className:"flex items-center gap-2 sm:w-48",children:[s.jsx(X,{htmlFor:"rabiesExpires",className:"text-xs text-muted-foreground whitespace-nowrap",children:"Expires:"}),s.jsx(ne,{id:"rabiesExpires",type:"date",disabled:!c.watch("vaccinations.rabies"),...c.register("vaccinations.rabiesExpires"),className:"h-9"})]})]})]})]}),s.jsx(nt,{}),s.jsxs("section",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[s.jsx(Ls,{className:"h-4 w-4 text-primary"}),"Pet Photo"]}),s.jsx("div",{className:"pl-6 border-l-2 border-primary/20",children:s.jsx(jn,{label:"",value:c.watch("photoPreview")?{blob:new Blob,dataUrl:c.watch("photoPreview"),width:0,height:0,approxKB:0,mimeType:"image/*",original:{name:"",sizeKB:0,type:""}}:null,onChange:g=>{x.current=g?.blob??null,c.setValue("photoPreview",g?.dataUrl??"")},options:{maxWidth:1200,maxHeight:1200,quality:.82,preferWebP:!0}})})]}),s.jsxs(cr,{className:"gap-2 sm:gap-0 pt-4",children:[s.jsx(Q,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:l,className:"transition-all hover:scale-105",children:"Cancel"}),s.jsx(Q,{type:"submit",disabled:l,className:"transition-all hover:scale-105",children:l?s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r==="add"?"Creating...":"Updating..."]}):s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(ge,{className:"h-4 w-4"}),r==="add"?"Create Pet Profile":"Save Changes"]})})]})]})]})})}function Jn(){const{user:r}=ft(),e=ht(),t=r?.id??null,{backfillAllQR:o,isBackfilling:a}=Do(t),{data:n,isLoading:l,isError:d}=At({queryKey:["pets",t],queryFn:async()=>t?Ro(t):[],enabled:!!t,staleTime:3e4}),[c,u]=i.useState(!1),[p,f]=i.useState(null),[b,x]=i.useState(null),[v,h]=i.useState(null),[y,g]=i.useState(null),[j,S]=i.useState(!1),D=C=>{const H=`${window.location.origin}/p/${C.short_id}`;window.open(H,"_blank")},I=async()=>{await e.invalidateQueries({queryKey:["pets",t]}),f(null),u(!1)},_=async()=>{await e.invalidateQueries({queryKey:["pets",t]}),x(null)},R=ms({mutationFn:async({id:C,missing:$})=>Re(C,{missing:$,missing_since:$?new Date().toISOString():null}),onSuccess:async()=>{await e.invalidateQueries({queryKey:["pets",t]})}}),U=async(C,$)=>{if($)g(C);else try{S(!0),await R.mutateAsync({id:C.id,missing:!1})}catch(H){alert(H?.message??"Failed to update")}finally{S(!1)}},J=async()=>{if(y)try{S(!0),await R.mutateAsync({id:y.id,missing:!0})}catch(C){alert(C?.message??"Failed to update")}finally{S(!1),g(null)}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center ring-4 ring-primary/5",children:s.jsx(ge,{className:"h-5 w-5 text-primary"})}),"Dashboard"]}),s.jsx("p",{className:"text-muted-foreground",children:"Manage your pets, QR codes, and track activity"})]}),s.jsxs(hs,{defaultValue:"pets",className:"space-y-4",children:[s.jsxs(gs,{className:"grid w-full max-w-md grid-cols-2",children:[s.jsxs(jt,{value:"pets",className:"gap-2",children:[s.jsx(ge,{className:"h-4 w-4"}),"My Pets"]}),s.jsxs(jt,{value:"activity",className:"gap-2",children:[s.jsx(Ds,{className:"h-4 w-4"}),"Recent Activity"]})]}),s.jsxs(Nt,{value:"pets",className:"space-y-4",children:[s.jsxs(De,{className:"shadow-lg border-primary/10",children:[s.jsx(rt,{className:"space-y-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[s.jsxs("div",{className:"space-y-1.5",children:[s.jsxs(tt,{className:"text-2xl flex items-center gap-2",children:[s.jsx(ur,{className:"h-5 w-5 text-primary"}),"Registered Pets"]}),s.jsx(st,{className:"text-base",children:"Manage profiles, photos, QR tags, and missing status"})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsxs(Q,{variant:"outline",onClick:o,disabled:!t||a,className:"gap-2 transition-all hover:scale-105",children:[s.jsx($e,{className:`h-4 w-4 ${a?"animate-spin":""}`}),a?"Working…":"Backfill QR"]}),s.jsxs(Q,{onClick:()=>u(!0),disabled:!t,className:"gap-2 transition-all hover:scale-105",children:[s.jsx(Ct,{className:"h-4 w-4"}),"Add Pet"]})]})]})}),s.jsx(et,{children:l?s.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((C,$)=>s.jsxs(De,{className:"p-4 space-y-3",children:[s.jsx(ye,{className:"h-5 w-40"}),s.jsx(ye,{className:"h-4 w-24"}),s.jsx(ye,{className:"h-32 w-full rounded-md"}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx(ye,{className:"h-9 w-16"}),s.jsx(ye,{className:"h-9 w-16"}),s.jsx(ye,{className:"h-9 w-16"})]})]},$))}):d?s.jsxs(rr,{variant:"destructive",children:[s.jsx(Oe,{className:"h-4 w-4"}),s.jsx(sr,{children:"Failed to load pets. Please try again."})]}):n&&n.length>0?s.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:n.map(C=>s.jsxs(De,{className:"overflow-hidden transition-all duration-200 hover:shadow-lg hover:scale-[1.02] border-primary/10",children:[s.jsxs(rt,{className:"pb-3",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs(tt,{className:"text-lg truncate flex items-center gap-2",children:[s.jsx(ge,{className:"h-4 w-4 text-primary flex-shrink-0"}),C.name]}),s.jsxs("div",{className:"flex flex-col gap-1.5 items-end",children:[C.missing&&s.jsxs(ot,{variant:"destructive",className:"gap-1 animate-pulse",children:[s.jsx(at,{className:"h-3 w-3"}),"Missing"]}),s.jsx(ot,{variant:"secondary",className:"capitalize text-xs",children:C.species})]})]}),s.jsx(st,{className:"line-clamp-2 text-sm",children:C.breed||C.description||"No description"})]}),C.photo_url&&s.jsx("div",{className:"px-4 pb-3",children:s.jsx("img",{src:C.photo_url,alt:`${C.name} photo`,className:"w-full h-40 rounded-lg object-cover ring-1 ring-primary/10",loading:"lazy"})}),s.jsxs(et,{className:"space-y-3 pt-3 border-t",children:[s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(Q,{size:"sm",onClick:()=>f(C),className:"gap-1.5 flex-1 transition-all hover:scale-105",children:[s.jsx(ro,{className:"h-3.5 w-3.5"}),"Edit"]}),s.jsxs(Q,{size:"sm",variant:"outline",onClick:()=>D(C),className:"gap-1.5 flex-1 transition-all hover:scale-105",children:[s.jsx(As,{className:"h-3.5 w-3.5"}),"View"]}),s.jsxs(Q,{size:"sm",variant:C.qr_url?"outline":"secondary",onClick:()=>h(C),className:"gap-1.5 flex-1 transition-all hover:scale-105",title:C.qr_url?"View QR":"Generate QR",children:[s.jsx(dr,{className:"h-3.5 w-3.5"}),C.qr_url?"QR":"Create"]})]}),s.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(X,{htmlFor:`missing-${C.id}`,className:"text-sm font-medium cursor-pointer",children:"Mark Missing"}),s.jsx(fo,{id:`missing-${C.id}`,checked:!!C.missing,disabled:j||R.isPending,onCheckedChange:$=>U(C,$)})]}),s.jsxs(Q,{size:"sm",variant:"ghost",onClick:()=>x(C),className:"gap-1.5 text-destructive hover:text-destructive hover:bg-destructive/10",children:[s.jsx(Ut,{className:"h-3.5 w-3.5"}),"Delete"]})]})]})]},C.id))}):s.jsxs("div",{className:"text-center py-12 space-y-4",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"h-20 w-20 bg-primary/10 rounded-full flex items-center justify-center",children:s.jsx(ge,{className:"h-10 w-10 text-primary/60"})})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-lg font-medium text-foreground",children:"No pets yet"}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Click ",s.jsx("span",{className:"font-medium text-foreground",children:"Add Pet"})," to create your first pet profile"]})]}),s.jsxs(Q,{onClick:()=>u(!0),className:"gap-2 mt-4",children:[s.jsx(Ct,{className:"h-4 w-4"}),"Add Your First Pet"]})]})})]}),s.jsx(It,{mode:"add",open:c,onOpenChange:u,onSubmit:I}),p&&s.jsx(It,{mode:"edit",open:!!p,onOpenChange:C=>!C&&f(null),initialPet:{id:p.id,name:p.name,species:p.species,breed:p.breed??void 0,color:p.color??void 0,weight:p.weight??void 0,birthdate:p.birthdate??void 0,microchipId:p.microchip_id??void 0,description:p.description??void 0,notes:p.notes??void 0,vaccinations:p.vaccinations?{rabies:p.vaccinations.rabies??!1,rabiesExpires:p.vaccinations.rabiesExpires??void 0}:void 0,photoPreview:p.photo_url??void 0},onSubmit:I}),t&&s.jsx(Ao,{pet:v,open:!!v,onOpenChange:C=>!C&&h(null),ownerId:t}),s.jsx(Mo,{pet:b,open:!!b,onOpenChange:C=>!C&&x(null),onDeleted:_}),s.jsx(Mt,{open:!!y,onOpenChange:C=>!C&&g(null),children:s.jsxs(Dt,{children:[s.jsxs(Ot,{children:[s.jsxs(Bt,{className:"flex items-center gap-2",children:[s.jsx(at,{className:"h-5 w-5 text-orange-500"}),"Mark ",y?.name," as missing?"]}),s.jsx($t,{children:"This helps highlight their profile and can trigger your outreach flow. You can turn this off later."})]}),s.jsxs(Lt,{children:[s.jsx(Ft,{disabled:j,children:"Cancel"}),s.jsx(Vt,{disabled:j,onClick:J,className:"gap-2",children:j?s.jsxs(s.Fragment,{children:[s.jsx($e,{className:"h-4 w-4 animate-spin"}),"Saving…"]}):"Yes, mark missing"})]})]})})]}),s.jsx(Nt,{value:"activity",className:"mt-4",children:s.jsx(vo,{days:30})})]})]})}export{Jn as default};
