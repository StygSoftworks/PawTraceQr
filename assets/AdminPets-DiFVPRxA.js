import{j as s}from"./radix-ui-Dl2NiEpv.js";import{r as n}from"./forms-BenlWNMe.js";import{u as U}from"./react-query-CCwEfxX5.js";import{u as Y}from"./useAdminCheck-olTdF-My.js";import{s as K}from"./index-djmkGsBh.js";import{d as t,C as r,b as D,a as P,c as W}from"./card-JrpAFQcq.js";import{B as w}from"./button-DAfSnszG.js";import{I as G}from"./input-Di22cJqv.js";import{B as f}from"./badge-DFlhK-kx.js";import{T as J,a as X,b as y,c,d as Z,e as l,Q as ss}from"./QRCodeDialog-trzbByvq.js";import{S as C,a as S,b as T,c as A,d as i}from"./select-DJ4plmKP.js";import{b as es,A as as,a as is}from"./avatar-DC-8I2mP.js";import{g as ts}from"./billing-X1lU7Ov_.js";import{h as rs,f as E,ab as ls,ac as ns,S as cs,w as ds,x as os,e as xs,Q as ms,ad as hs,ae as js,H as us}from"./icons-1Q_-oHEE.js";import{f as F}from"./date-fns-CSQe5d3I.js";import"./react-dom-CWqaeSHD.js";import"./pdf-DO90N-Wx.js";import"./supabase-Dq_AJ6PJ.js";import"./router-fBLXKt6a.js";import"./utils-CBfrqCZ4.js";import"./index-CdJFUDDL.js";import"./dialog-BnEVA_8F.js";import"./qr-CwZfYiFM.js";import"./opentype-CPIVssqb.js";async function gs(){const{data:j,error:u}=await K.rpc("get_all_pets_admin");if(u)throw u;return j??[]}function Is(){const{isAdmin:j,isLoading:u}=Y(),[d,L]=n.useState(""),[m,Q]=n.useState("all"),[h,R]=n.useState("all"),[o,V]=n.useState("all"),[v,k]=n.useState(null),[g,M]=n.useState(null),{data:a,isLoading:z,isError:B}=U({queryKey:["admin-all-pets"],queryFn:gs,enabled:j,staleTime:3e4}),p=n.useMemo(()=>a?a.filter(e=>{const N=d===""||e.pet_name.toLowerCase().includes(d.toLowerCase())||e.owner_email?.toLowerCase().includes(d.toLowerCase())||e.short_id.toLowerCase().includes(d.toLowerCase()),b=m==="all"||e.species===m,q=h==="all"||e.tag_type===h,H=o==="all"||o==="missing"&&e.missing||o==="not_missing"&&!e.missing;return N&&b&&q&&H}):[],[a,d,m,h,o]),x=n.useMemo(()=>a?{total:a.length,dogs:a.filter(e=>e.species==="dog").length,cats:a.filter(e=>e.species==="cat").length,other:a.filter(e=>e.species==="other").length,missing:a.filter(e=>e.missing).length,active:a.filter(e=>e.subscription_status==="active").length}:{total:0,dogs:0,cats:0,other:0,missing:0,active:0},[a]),_=e=>{const b=`${window.location.origin}/p/${e.short_id}`;window.open(b,"_blank")},I=e=>{const N={id:e.pet_id,owner_id:e.owner_id,name:e.pet_name,species:e.species,breed:e.breed,color:e.color,weight:e.weight,birthdate:e.birthdate,microchip_id:e.microchip_id,description:e.description,notes:e.notes,vaccinations:e.vaccinations,photo_url:e.photo_url,created_at:e.created_at,updated_at:e.updated_at,missing:e.missing,missing_since:e.missing_since,qr_url:e.qr_url,short_id:e.short_id,tag_type:e.tag_type,environment:e.environment,paypal_subscription_id:e.paypal_subscription_id,subscription_status:e.subscription_status,subscription_activated_at:e.subscription_activated_at,subscription_expires_at:e.subscription_expires_at,subscription_plan_id:e.subscription_plan_id};M(N)},O=e=>{k(v===e?null:e)},$=e=>{switch(e){case"indoor":return s.jsx(us,{className:"h-3.5 w-3.5"});case"outdoor":return s.jsx(js,{className:"h-3.5 w-3.5"});case"indoor_outdoor":return s.jsx(hs,{className:"h-3.5 w-3.5"});default:return null}};return u?s.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-10",children:s.jsx("p",{className:"text-muted-foreground",children:"Loading..."})}):j?s.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-10 max-w-7xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:"All Pets"}),s.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage all pets across all users"})]}),s.jsx(E,{className:"h-8 w-8 text-primary"})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4 mb-6",children:[s.jsx(t,{children:s.jsxs(r,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold",children:x.total}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Pets"})]})}),s.jsx(t,{children:s.jsxs(r,{className:"pt-6",children:[s.jsxs("div",{className:"text-2xl font-bold flex items-center gap-2",children:[s.jsx(ls,{className:"h-5 w-5"}),x.dogs]}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Dogs"})]})}),s.jsx(t,{children:s.jsxs(r,{className:"pt-6",children:[s.jsxs("div",{className:"text-2xl font-bold flex items-center gap-2",children:[s.jsx(ns,{className:"h-5 w-5"}),x.cats]}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Cats"})]})}),s.jsx(t,{children:s.jsxs(r,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold",children:x.other}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Other"})]})}),s.jsx(t,{children:s.jsxs(r,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-destructive",children:x.missing}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Missing"})]})}),s.jsx(t,{children:s.jsxs(r,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.active}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Subs"})]})})]}),s.jsxs(t,{className:"mb-6",children:[s.jsx(D,{children:s.jsx(P,{className:"text-lg",children:"Filters"})}),s.jsx(r,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(cs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(G,{placeholder:"Search by name, email, or ID...",value:d,onChange:e=>L(e.target.value),className:"pl-10"})]}),s.jsxs(C,{value:m,onValueChange:Q,children:[s.jsx(S,{children:s.jsx(T,{placeholder:"All Species"})}),s.jsxs(A,{children:[s.jsx(i,{value:"all",children:"All Species"}),s.jsx(i,{value:"dog",children:"Dogs"}),s.jsx(i,{value:"cat",children:"Cats"}),s.jsx(i,{value:"other",children:"Other"})]})]}),s.jsxs(C,{value:h,onValueChange:R,children:[s.jsx(S,{children:s.jsx(T,{placeholder:"All Tag Types"})}),s.jsxs(A,{children:[s.jsx(i,{value:"all",children:"All Tag Types"}),s.jsx(i,{value:"dog",children:"Dog Tags"}),s.jsx(i,{value:"cat",children:"Cat Tags"})]})]}),s.jsxs(C,{value:o,onValueChange:V,children:[s.jsx(S,{children:s.jsx(T,{placeholder:"All Status"})}),s.jsxs(A,{children:[s.jsx(i,{value:"all",children:"All Status"}),s.jsx(i,{value:"missing",children:"Missing Only"}),s.jsx(i,{value:"not_missing",children:"Not Missing"})]})]})]})})]}),s.jsxs(t,{children:[s.jsxs(D,{children:[s.jsxs(P,{children:["Pets (",p.length,")"]}),s.jsx(W,{children:d||m!=="all"||h!=="all"||o!=="all"?`Showing ${p.length} of ${a?.length??0} pets`:`Total of ${a?.length??0} pets`})]}),s.jsx(r,{children:z?s.jsx("p",{className:"text-muted-foreground",children:"Loading pets..."}):B?s.jsx("p",{className:"text-destructive",children:"Error loading pets"}):p.length===0?s.jsx("p",{className:"text-muted-foreground",children:"No pets found"}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(J,{children:[s.jsx(X,{children:s.jsxs(y,{children:[s.jsx(c,{className:"w-[50px]"}),s.jsx(c,{children:"Pet"}),s.jsx(c,{children:"Owner"}),s.jsx(c,{children:"Species"}),s.jsx(c,{children:"Tag Type"}),s.jsx(c,{children:"Status"}),s.jsx(c,{children:"Created"}),s.jsx(c,{className:"text-right",children:"Actions"})]})}),s.jsx(Z,{children:p.map(e=>s.jsxs(s.Fragment,{children:[s.jsxs(y,{className:"group",children:[s.jsx(l,{children:s.jsx(w,{variant:"ghost",size:"icon",onClick:()=>O(e.pet_id),className:"h-8 w-8",children:v===e.pet_id?s.jsx(ds,{className:"h-4 w-4"}):s.jsx(os,{className:"h-4 w-4"})})}),s.jsx(l,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(es,{className:"h-10 w-10",children:e.photo_url?s.jsx(as,{src:e.photo_url,alt:e.pet_name}):s.jsx(is,{children:s.jsx(E,{className:"h-5 w-5"})})}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.pet_name}),s.jsx("div",{className:"text-xs text-muted-foreground font-mono",children:e.short_id})]})]})}),s.jsx(l,{children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",children:e.owner_email??"Unknown"}),e.owner_name&&s.jsx("div",{className:"text-xs text-muted-foreground",children:e.owner_name})]})}),s.jsx(l,{children:s.jsx(f,{variant:"outline",className:"capitalize",children:e.species})}),s.jsx(l,{children:s.jsx(f,{variant:e.tag_type==="dog"?"default":"secondary",children:e.tag_type==="dog"?"Dog Size":"Cat Size"})}),s.jsx(l,{children:s.jsxs("div",{className:"flex flex-col gap-1",children:[e.missing&&s.jsx(f,{variant:"destructive",className:"w-fit",children:"Missing"}),s.jsx(f,{variant:ts(e.subscription_status),className:"w-fit capitalize",children:e.subscription_status})]})}),s.jsx(l,{children:s.jsx("div",{className:"text-sm",children:F(new Date(e.created_at),"MMM d, yyyy")})}),s.jsx(l,{className:"text-right",children:s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(w,{variant:"ghost",size:"icon",onClick:()=>_(e),title:"View public page",children:s.jsx(xs,{className:"h-4 w-4"})}),s.jsx(w,{variant:"ghost",size:"icon",onClick:()=>I(e),title:"View QR code",children:s.jsx(ms,{className:"h-4 w-4"})})]})})]},e.pet_id),v===e.pet_id&&s.jsx(y,{children:s.jsx(l,{colSpan:8,className:"bg-muted/50",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 py-4 px-2",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:"Pet Details"}),s.jsxs("dl",{className:"space-y-1 text-sm",children:[e.breed&&s.jsxs(s.Fragment,{children:[s.jsx("dt",{className:"text-muted-foreground inline",children:"Breed: "}),s.jsx("dd",{className:"inline",children:e.breed}),s.jsx("br",{})]}),e.color&&s.jsxs(s.Fragment,{children:[s.jsx("dt",{className:"text-muted-foreground inline",children:"Color: "}),s.jsx("dd",{className:"inline",children:e.color}),s.jsx("br",{})]}),e.weight&&s.jsxs(s.Fragment,{children:[s.jsx("dt",{className:"text-muted-foreground inline",children:"Weight: "}),s.jsxs("dd",{className:"inline",children:[e.weight," lbs"]}),s.jsx("br",{})]}),e.birthdate&&s.jsxs(s.Fragment,{children:[s.jsx("dt",{className:"text-muted-foreground inline",children:"Birthdate: "}),s.jsx("dd",{className:"inline",children:F(new Date(e.birthdate),"MMM d, yyyy")}),s.jsx("br",{})]}),e.microchip_id&&s.jsxs(s.Fragment,{children:[s.jsx("dt",{className:"text-muted-foreground inline",children:"Microchip: "}),s.jsx("dd",{className:"inline font-mono",children:e.microchip_id}),s.jsx("br",{})]}),s.jsx("dt",{className:"text-muted-foreground inline",children:"Environment: "}),s.jsxs("dd",{className:"inline flex items-center gap-1",children:[$(e.environment),s.jsx("span",{className:"capitalize",children:e.environment.replace("_"," ")})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:"Additional Info"}),s.jsxs("dl",{className:"space-y-1 text-sm",children:[e.description&&s.jsxs(s.Fragment,{children:[s.jsx("dt",{className:"text-muted-foreground",children:"Description:"}),s.jsx("dd",{className:"mb-2",children:e.description})]}),e.notes&&s.jsxs(s.Fragment,{children:[s.jsx("dt",{className:"text-muted-foreground",children:"Notes:"}),s.jsx("dd",{className:"mb-2",children:e.notes})]}),e.vaccinations?.rabies&&s.jsxs(s.Fragment,{children:[s.jsx("dt",{className:"text-muted-foreground inline",children:"Rabies Vaccination: "}),s.jsxs("dd",{className:"inline",children:["Yes",e.vaccinations.rabiesExpires&&` (expires ${F(new Date(e.vaccinations.rabiesExpires),"MMM d, yyyy")})`]})]})]})]})]})})})]}))})]})})})]}),g&&s.jsx(ss,{pet:g,open:!!g,onOpenChange:e=>!e&&M(null),ownerId:g.owner_id})]}):s.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-10",children:s.jsx(t,{children:s.jsx(r,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[s.jsx(rs,{className:"h-5 w-5"}),s.jsx("p",{children:"You don't have permission to view this page. (Admins/Owners only)"})]})})})})}export{Is as default};
