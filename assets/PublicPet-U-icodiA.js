import{r as B,s as O,c as z,j as e,d as K,L as Q}from"./index-CyRwK8zl.js";import{u as R}from"./useQuery-XJKUzcE2.js";import{C as $,c as E,b as F,d as J,a as I}from"./card-CCAJ_q2W.js";import{B as b}from"./badge-BTJxIdG4.js";import{B as C}from"./button-B-1CPjV4.js";import{S as w}from"./skeleton-Cf90mVNo.js";import{f as U,T as M,b as V,c as W,a as X,D as Y}from"./dialog-Ds9LbjkK.js";import{A as P,a as S}from"./alert-DJx_XrQi.js";import{H as Z}from"./Header-DCpJi6Wj.js";import{c as A}from"./createLucideIcon-gPBMwgoN.js";import{P as H}from"./paw-print-JjZ2T7oj.js";import{H as ee,M as se}from"./map-pin-ZN2rm4ih.js";import{I as ae}from"./info-CAIMXuoJ.js";import{M as L}from"./mail-BhbKGWK2.js";import"./utils-CBfrqCZ4.js";import"./index-CZ39MDKL.js";import"./index-BWrJMVUx.js";import"./x-D6c15y1O.js";import"./separator-CjyRgRRA.js";import"./index-BSAMU7Ph.js";import"./useProfile-Bqara-UN.js";import"./useMutation-CDUD3ZYd.js";import"./Logo-DxckYoV_.js";import"./log-in-BGK4oVck.js";import"./user-plus-Dck3FrGd.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],re=A("clock",te);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],ie=A("house",le);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],T=A("phone",ne);function ce({shortId:s,askGeo:t=!0}){return B.useEffect(()=>{if(!s)return;let c=!1;return(async()=>{try{let i={};if(t&&"geolocation"in navigator)try{const r=await new Promise((n,l)=>navigator.geolocation.getCurrentPosition(n,l,{timeout:3e3}));i={lat:r.coords.latitude,lng:r.coords.longitude}}catch{}if(c)return;await O.rpc("log_scan",{p_short_id:s,p_referrer:document.referrer||null,p_ua:navigator.userAgent,p_city:null,p_region:null,p_country:null,p_lat:i.lat??null,p_lng:i.lng??null})}catch(i){console.warn("log_scan failed:",i)}})(),()=>{c=!0}},[s,t]),null}function oe(s){const t=z.c(14),{petId:c,days:x,label:i}=s,r=x===void 0?30:x,n=i===void 0?"Scans":i;let l,a;t[0]!==r||t[1]!==c?(l=["pet_scan_count",c,r],a=()=>U(c,r),t[0]=r,t[1]=c,t[2]=l,t[3]=a):(l=t[2],a=t[3]);const p=!!c;let h;t[4]!==l||t[5]!==a||t[6]!==p?(h={queryKey:l,queryFn:a,staleTime:3e4,enabled:p},t[4]=l,t[5]=a,t[6]=p,t[7]=h):h=t[7];const{data:d,isLoading:u,isError:f}=R(h);if(!c)return null;if(u||f){let m;return t[8]!==n?(m=e.jsxs(b,{variant:"outline",children:[n,": â€”"]}),t[8]=n,t[9]=m):m=t[9],m}let o;return t[10]!==d||t[11]!==r||t[12]!==n?(o=e.jsxs(b,{variant:"secondary",children:[n," (",r,"d): ",d]}),t[10]=d,t[11]=r,t[12]=n,t[13]=o):o=t[13],o}function q(s){if(!s)return"";const t=new Date(s).getTime(),c=Date.now();if(isNaN(t)||c<=t)return"just now";const x=c-t,i=Math.floor(x/(1e3*60)),r=Math.floor(i/60),n=Math.floor(r/24);if(n>0){const l=r%24;return`${n} day${n>1?"s":""}${l?`, ${l} hour${l>1?"s":""}`:""}`}if(r>0){const l=i%60;return`${r} hour${r>1?"s":""}${l?`, ${l} min`:""}`}return`${i} min`}function Ee(){const s=z.c(33),{id:t}=K(),[c,x]=B.useState(!1);let i;s[0]!==t?(i=["public-pet",t],s[0]=t,s[1]=i):i=s[1];const r=!!t;let n;s[2]!==t?(n=async()=>{const{data:G,error:D}=await O.from("public_pets").select("*").eq("short_id",t).maybeSingle();if(D)throw D;return G},s[2]=t,s[3]=n):n=s[3];let l;s[4]!==i||s[5]!==r||s[6]!==n?(l={queryKey:i,enabled:r,queryFn:n,staleTime:6e4},s[4]=i,s[5]=r,s[6]=n,s[7]=l):l=s[7];const{data:a,isLoading:p,isError:h}=R(l);let d;s[8]!==t?(d=e.jsx(ce,{shortId:t,askGeo:!0}),s[8]=t,s[9]=d):d=s[9];let u,f;s[10]===Symbol.for("react.memo_cache_sentinel")?(u=e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-primary/5 rounded-full blur-3xl"})]}),f=e.jsx(Z,{}),s[10]=u,s[11]=f):(u=s[10],f=s[11]);let o;s[12]!==a||s[13]!==h||s[14]!==p?(o=e.jsx("main",{className:"relative mx-auto max-w-5xl px-4 sm:px-6 py-8 md:py-12",children:p?e.jsx($,{className:"overflow-hidden shadow-xl",children:e.jsxs("div",{className:"grid gap-6 p-6 lg:grid-cols-[400px,1fr]",children:[e.jsx(w,{className:"h-96 w-full rounded-lg"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{className:"h-8 w-48"}),e.jsx(w,{className:"h-6 w-64"}),e.jsx(w,{className:"h-4 w-full"}),e.jsx(w,{className:"h-4 w-full"}),e.jsx(w,{className:"h-24 w-full"})]})]})}):h||!a?e.jsxs($,{className:"shadow-xl",children:[e.jsx(E,{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 bg-destructive/10 rounded-xl flex items-center justify-center",children:e.jsx(M,{className:"h-6 w-6 text-destructive"})}),e.jsxs("div",{children:[e.jsx(F,{className:"text-2xl",children:"Pet Not Found"}),e.jsx(J,{className:"text-base",children:"This QR code may be invalid or the pet profile is no longer available"})]})]})}),e.jsx(I,{children:e.jsx(C,{asChild:!0,className:"gap-2",children:e.jsxs(Q,{to:"/",children:[e.jsx(ie,{className:"h-4 w-4"}),"Go to Homepage"]})})})]}):e.jsxs("div",{className:"space-y-6",children:[a.missing&&e.jsxs(P,{variant:"destructive",className:"animate-in fade-in-50 slide-in-from-top-2 duration-300",children:[e.jsx(M,{className:"h-5 w-5"}),e.jsxs(S,{className:"text-base font-medium",children:[e.jsx("span",{className:"block mb-1",children:"ðŸš¨ This pet is currently MISSING!"}),a.missing_since&&e.jsxs("span",{className:"text-sm opacity-90",children:["Missing for ",q(a.missing_since)]})]})]}),e.jsxs($,{className:"overflow-hidden shadow-xl border-primary/10",children:[e.jsx(E,{className:"space-y-4 bg-slate-50/50 dark:bg-slate-900/50",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center ring-4 ring-primary/5",children:e.jsx(H,{className:"h-5 w-5 text-primary"})}),e.jsx(F,{className:"text-3xl tracking-tight",children:a.name})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(b,{variant:"secondary",className:"capitalize text-sm px-3 py-1",children:[a.species==="dog"?"ðŸ•":a.species==="cat"?"ðŸ±":"ðŸ¾"," ",a.species]}),a.breed&&e.jsx(b,{variant:"outline",className:"text-sm px-3 py-1",children:a.breed}),a.color&&e.jsx(b,{variant:"outline",className:"text-sm px-3 py-1",children:a.color})]})]}),e.jsx(b,{variant:a.missing?"destructive":"default",className:`text-sm px-4 py-2 gap-2 ${a.missing?"animate-pulse":""}`,children:a.missing?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4"}),"Missing"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4"}),"Safe at Home"]})})]})}),e.jsxs(I,{className:"grid gap-8 p-6 lg:grid-cols-[1fr,400px]",children:[e.jsxs("div",{className:"space-y-6 order-2 lg:order-1",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(ae,{className:"h-5 w-5 text-primary"}),"About ",a.name]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:a.description||"No additional description provided."})]}),(a.owner_email||a.owner_phone)&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(T,{className:"h-5 w-5 text-primary"}),"Contact Owner"]}),e.jsx(P,{className:"border-blue-200 bg-blue-50 dark:border-blue-900 dark:bg-blue-950",children:e.jsx(S,{className:"text-blue-800 dark:text-blue-200",children:"If you've found this pet, please contact the owner using the information below"})}),e.jsxs("div",{className:"space-y-3 pl-4 border-l-2 border-primary/20",children:[a.owner_phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Phone"}),e.jsx("a",{href:`tel:${a.owner_phone}`,className:"text-primary hover:underline font-medium",children:a.owner_phone})]})]}),a.owner_email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Email"}),e.jsx("a",{href:`mailto:${a.owner_email}`,className:"text-primary hover:underline font-medium",children:a.owner_email})]})]}),a.missing&&e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("div",{className:"h-10 w-10 bg-orange-100 dark:bg-orange-950 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Last Seen"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.missing_since?q(a.missing_since)+" ago":"Recently"})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(oe,{petId:a.id,days:30,label:"Scans"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[a.owner_phone&&e.jsx(C,{asChild:!0,className:"flex-1 gap-2",variant:"success",children:e.jsxs("a",{href:`tel:${a.owner_phone}`,children:[e.jsx(T,{className:"h-4 w-4"}),"Call Owner"]})}),a.owner_email&&e.jsx(C,{asChild:!0,variant:"outline",className:"flex-1 gap-2",children:e.jsxs("a",{href:`mailto:${a.owner_email}`,children:[e.jsx(L,{className:"h-4 w-4"}),"Send Email"]})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(se,{className:"h-5 w-5 text-primary"}),"Found This Pet?"]}),e.jsx(P,{children:e.jsx(S,{className:"space-y-2",children:e.jsx("p",{className:"text-sm",children:"Please share your location with the owner when you contact them. This helps reunite pets faster!"})})})]})]}),e.jsx("div",{className:"space-y-4 order-1 lg:order-2",children:a.photo_url?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>x(!0),className:"group relative w-full overflow-hidden rounded-xl border-2 border-primary/10 ring-4 ring-primary/5 transition-all hover:scale-[1.02] hover:shadow-lg cursor-pointer",children:[e.jsx("img",{src:a.photo_url,alt:`${a.name}`,className:"w-full h-auto max-h-[600px] object-contain bg-white"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity bg-black/70 px-4 py-2 rounded-lg text-sm",children:"Click to enlarge"})})]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Click image to view full size"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 rounded-xl border-2 border-dashed border-primary/20 bg-slate-50 dark:bg-slate-900",children:[e.jsx(H,{className:"h-16 w-16 text-primary/30 mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No photo provided"})]})})]})]})]})}),s[12]=a,s[13]=h,s[14]=p,s[15]=o):o=s[15];let m;s[16]===Symbol.for("react.memo_cache_sentinel")?(m=e.jsx(H,{className:"h-5 w-5"}),s[16]=m):m=s[16];const k=a?.name;let g;s[17]!==k?(g=e.jsx(V,{className:"p-6 pb-0",children:e.jsxs(W,{className:"flex items-center gap-2",children:[m,k,"'s Photo"]})}),s[17]=k,s[18]=g):g=s[18];let j;s[19]!==a?(j=a?.photo_url&&e.jsx("div",{className:"p-6 pt-4 overflow-auto",children:e.jsx("img",{src:a.photo_url,alt:`${a.name} full size`,className:"w-full h-auto rounded-lg"})}),s[19]=a,s[20]=j):j=s[20];let N;s[21]!==g||s[22]!==j?(N=e.jsxs(X,{className:"max-w-4xl max-h-[90vh] p-0",children:[g,j]}),s[21]=g,s[22]=j,s[23]=N):N=s[23];let y;s[24]!==c||s[25]!==N?(y=e.jsx(Y,{open:c,onOpenChange:x,children:N}),s[24]=c,s[25]=N,s[26]=y):y=s[26];let v;s[27]!==y||s[28]!==o?(v=e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950",children:[u,f,o,y]}),s[27]=y,s[28]=o,s[29]=v):v=s[29];let _;return s[30]!==v||s[31]!==d?(_=e.jsxs(e.Fragment,{children:[d,v]}),s[30]=v,s[31]=d,s[32]=_):_=s[32],_}export{Ee as default};
