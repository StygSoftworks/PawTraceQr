import{c as A,a as E,j as t,s as F}from"./index-BbKp4zPU.js";import{u as M}from"./useQuery-QASy4dUe.js";import{u as Q}from"./useMutation-P_qaI4YU.js";import{S as K,b as L,e as R,d as B}from"./feedback-DyrCFiJQ.js";import{d as z,b as T,a as U,c as $,C as H}from"./card-C7KkwrQa.js";import{B as _}from"./button-BZAk-lot.js";import{B as q}from"./badge-CIiP1QF3.js";import{X as O}from"./x-tsoDNb3U.js";import{C as P}from"./check-hv9Tl6YY.js";import"./createLucideIcon-fGcX-bqL.js";import"./index-PvI5a1q7.js";async function X(){const{data:{user:e}}=await F.auth.getUser();if(!e)return null;const{data:a,error:r}=await F.from("profiles").select("role").eq("id",e.id).single();if(r)throw r;return a?.role??"free"}function oe(){const e=A.c(22),a=E();let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r={queryKey:["my-role"],queryFn:X,staleTime:6e4},e[0]=r):r=e[0];const{data:d,isLoading:S,isError:D}=M(r);let c;e[1]===Symbol.for("react.memo_cache_sentinel")?(c=["feedback_moderation"],e[1]=c):c=e[1];const y=d==="admin"||d==="owner";let m;e[2]!==y?(m={queryKey:c,queryFn:L,staleTime:1e4,enabled:y},e[2]=y,e[3]=m):m=e[3];const{data:u,isLoading:j,isError:b}=M(m);let p;e[4]!==a?(p={mutationFn:G,onMutate:async s=>{await a.cancelQueries({queryKey:["feedback_moderation"]});const k=a.getQueryData(["feedback_moderation"]);return a.setQueryData(["feedback_moderation"],o=>(o??[]).map(C=>C.id===s.id?{...C,approved:s.approve}:C)),{prev:k}},onError:(s,k,o)=>{o?.prev&&a.setQueryData(["feedback_moderation"],o.prev)},onSettled:()=>a.invalidateQueries({queryKey:["feedback_moderation"]})},e[4]=a,e[5]=p):p=e[5];const f=Q(p);let x;e[6]!==a?(x={mutationFn:Y,onSuccess:()=>a.invalidateQueries({queryKey:["feedback_moderation"]})},e[6]=a,e[7]=x):x=e[7];const g=Q(x),i=d==="admin"||d==="owner";let h;e[8]===Symbol.for("react.memo_cache_sentinel")?(h=t.jsx("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:"Moderate Reviews"}),e[8]=h):h=e[8];const w=i?"default":"outline",N=S?"…":D?"unknown":d??"guest";let n;e[9]!==w||e[10]!==N?(n=t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[h,t.jsx(q,{variant:w,children:N})]}),e[9]=w,e[10]=N,e[11]=n):n=e[11];let l;e[12]!==f||e[13]!==i||e[14]!==u||e[15]!==g||e[16]!==b||e[17]!==j?(l=i?j?t.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}):b?t.jsx("div",{className:"text-sm text-destructive",children:"Failed to load feedback."}):u?.length?t.jsx("div",{className:"grid gap-4",children:u.map(s=>t.jsxs(z,{children:[t.jsxs(T,{className:"flex flex-row items-center justify-between",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs(U,{className:"text-base",children:[s.display_name||"Anonymous"," •"," ",t.jsx("span",{className:"text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleString()})]}),t.jsxs($,{className:"flex items-center gap-2",children:[t.jsx("span",{className:"flex items-center gap-1",children:Array.from({length:5}).map((k,o)=>t.jsx(K,{className:`h-4 w-4 ${o<s.rating?"fill-yellow-400 text-yellow-500":"text-muted-foreground/40"}`},o))}),s.approved?t.jsx(q,{variant:"secondary",children:"Approved"}):t.jsx(q,{variant:"outline",children:"Pending"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[s.approved?t.jsxs(_,{size:"sm",variant:"outline",onClick:()=>f.mutate({id:s.id,approve:!1}),disabled:!i,children:[t.jsx(O,{className:"h-4 w-4 mr-1"})," Unpublish"]}):t.jsxs(_,{size:"sm",onClick:()=>f.mutate({id:s.id,approve:!0}),disabled:!i,children:[t.jsx(P,{className:"h-4 w-4 mr-1"})," Approve"]}),t.jsx(_,{size:"sm",variant:"destructive",onClick:()=>{confirm("Delete this review?")&&g.mutate(s.id)},disabled:!i,children:"Delete"})]})]}),t.jsx(H,{children:t.jsx("p",{className:"text-sm",children:s.comment})})]},s.id))}):t.jsx("div",{className:"text-sm text-muted-foreground",children:"No reviews yet."}):t.jsx("div",{className:"text-sm text-muted-foreground",children:"You don’t have permission to view this page. (Admins/Owners only)"}),e[12]=f,e[13]=i,e[14]=u,e[15]=g,e[16]=b,e[17]=j,e[18]=l):l=e[18];let v;return e[19]!==l||e[20]!==n?(v=t.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-10 md:py-14 max-w-5xl",children:[n,l]}),e[19]=l,e[20]=n,e[21]=v):v=e[21],v}function Y(e){return B(e)}function G(e){const{id:a,approve:r}=e;return R(a,r)}export{oe as default};
