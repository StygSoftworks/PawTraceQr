import{c as Te,j as s,u as Ye,r as o,s as ve}from"./index-BfkNNUKq.js";import{a as Y,b as me,c as ue,d as xe,C as N}from"./card-LZUtl_Rv.js";import{B as De}from"./button-Cxkkd8_p.js";import{B as Re}from"./badge-xTOY_PIg.js";import{c as ke}from"./utils-BfMtu9C5.js";import{C as Le}from"./credit-card-pupTV6bl.js";import{L as $}from"./loader-circle-aS2dHYbY.js";import{C as Me}from"./circle-alert-Uevh-KeM.js";import"./index-WWdD7rrj.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Pe=ke("circle-check-big",$e);function Ue(e){const t=Te.c(16),{hasBase:u,addonCount:x,petLimit:i,subscription:m,isActive:c,nextBilling:b}=e;let y;t[0]===Symbol.for("react.memo_cache_sentinel")?(y=s.jsx(me,{children:"Your plan summary"}),t[0]=y):y=t[0];const j=u?"Base plan active":"No base plan";let a;t[1]!==i?(a=s.jsx("span",{className:"font-medium",children:i}),t[1]=i,t[2]=a):a=t[2];let h;t[3]!==x||t[4]!==j||t[5]!==a?(h=s.jsxs(ue,{children:[y,s.jsxs(xe,{children:[j," ‚Ä¢ ",x," add-on(s) ‚Ä¢ Pet limit:"," ",a]})]}),t[3]=x,t[4]=j,t[5]=a,t[6]=h):h=t[6];let r;t[7]!==x||t[8]!==u||t[9]!==c||t[10]!==b||t[11]!==m?(r=s.jsx(Y,{children:m?s.jsxs("div",{className:"divide-y",children:[u&&s.jsxs("div",{className:"flex justify-between items-center py-3",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:"PawTrace Base Plan"}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:["Status: ",s.jsx(Re,{variant:"outline",className:"uppercase",children:m.status})," ",b&&s.jsxs(s.Fragment,{children:["‚Ä¢ Renews: ",b]})]})]}),c?s.jsx(Pe,{className:"h-5 w-5 text-green-500"}):s.jsx(Le,{className:"h-5 w-5 text-muted-foreground"})]}),m.paypal_addon_subs&&m.paypal_addon_subs.length>0&&x>0&&s.jsxs("div",{className:"flex justify-between items-center py-3",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium",children:["Extra Pets Add-ons (",x,")"]}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:["Status: ",s.jsx(Re,{variant:"outline",className:"uppercase",children:m.status})," ",b&&s.jsxs(s.Fragment,{children:["‚Ä¢ Renews: ",b]})]})]}),c?s.jsx(Pe,{className:"h-5 w-5 text-green-500"}):s.jsx(Le,{className:"h-5 w-5 text-muted-foreground"})]})]}):s.jsx("div",{className:"text-sm text-muted-foreground",children:"No subscription on file."})}),t[7]=x,t[8]=u,t[9]=c,t[10]=b,t[11]=m,t[12]=r):r=t[12];let g;return t[13]!==h||t[14]!==r?(g=s.jsxs(N,{className:"mb-8",children:[h,r]}),t[13]=h,t[14]=r,t[15]=g):g=t[15],g}function Ze(){const e=Te.c(75),{user:t}=Ye(),[u,x]=o.useState(!0),[i,m]=o.useState(null),[c,b]=o.useState(null),[y,j]=o.useState(!1),[a,h]=o.useState(!1),[r,g]=o.useState(null),fe="P-74N21144BH7224146NDSS6MY",pe="P-002596997V2924715NDSS6MY",he="P-55P549186J183725GNDSS6NA",be="P-4R0311392G060980KNDSS6NA",k="sandbox",ye="ASTs7RPUPWK7sDBRk1-xhU0SwD-nalsSEJ0yx8l8M7YQxBmv-a0NfnXzDHpYQM7O_0mHhcdowmurqIg9",we=o.useRef(null),Ce=o.useRef(null),Be=o.useRef(null),Ae=o.useRef(null);let U,H;e[0]===Symbol.for("react.memo_cache_sentinel")?(U=()=>{const n=[];n.length>0&&(g(n.join(". ")),console.error("PayPal configuration errors:",n)),console.log("PayPal environment:",k),console.log("Plan IDs configured:",{baseMonthly:!0,baseYearly:!0,addonMonthly:!0,addonYearly:!0})},H=[ye,fe,pe,he,be,k],e[0]=U,e[1]=H):(U=e[0],H=e[1]),o.useEffect(U,H);let q,F;e[2]===Symbol.for("react.memo_cache_sentinel")?(q=()=>{if(document.querySelector('script[src*="sandbox.paypal.com/sdk/js"]')){h(!0);return}const l=document.createElement("script");console.log(k);const f=`https://www.sandbox.paypal.com/sdk/js?client-id=${ye}&vault=true&intent=subscription`;return l.src=f,l.async=!0,l.onload=()=>{console.log("‚úÖ PayPal SDK loaded successfully for:",k),h(!0)},l.onerror=()=>{console.error("‚ùå Failed to load PayPal SDK"),g("Failed to load PayPal SDK. Please refresh the page.")},document.body.appendChild(l),Fe},F=[ye,k],e[2]=q,e[3]=F):(q=e[2],F=e[3]),o.useEffect(q,F);let O;e[4]===Symbol.for("react.memo_cache_sentinel")?(O=()=>{let n=!0;new URLSearchParams(window.location.search).get("subscribed")==="true"&&(j(!0),window.history.replaceState({},"","/billing"),setTimeout(()=>j(!1),1e4));const f=async function(){x(!0);const{data:I}=await ve.auth.getUser(),p=I.user?.id??null;if(!n)return;if(b(p),!p){m(null),x(!1);return}const{data:Ie,error:Ee}=await ve.from("subscriptions").select("*").eq("user_id",p).maybeSingle();n&&(Ee?(console.error("load subscription error:",Ee),m(null)):m(Ie),x(!1))};f();const M=()=>document.visibilityState==="visible"&&f();return document.addEventListener("visibilitychange",M),()=>{n=!1,document.removeEventListener("visibilitychange",M)}},e[4]=O):O=e[4];let K;e[5]!==t?(K=[t],e[5]=t,e[6]=K):K=e[6],o.useEffect(O,K);const J=!!i?.paypal_sub_id_base,V=i?.addon_quantity??0,z=i?.status==="active",je=(J&&z?3:0)+V;let G;e[7]!==V||e[8]!==J||e[9]!==z||e[10]!==je?(G={hasBase:J,addonCount:V,petLimit:je,isActive:z},e[7]=V,e[8]=J,e[9]=z,e[10]=je,e[11]=G):G=e[11];const{hasBase:d,addonCount:ge,petLimit:Ne,isActive:Se}=G;let Q,X;if(e[12]!==r||e[13]!==d||e[14]!==u||e[15]!==a||e[16]!==c?(Q=()=>{if(u||!c||!a||!window.paypal||r){console.log("Not ready for buttons:",{loading:u,userId:c,paypalLoaded:a,configError:r});return}console.log("üîµ Creating PayPal buttons...");const n=setTimeout(()=>{const l=(f,M,T)=>{if(!f){console.error(`‚ùå Container missing for ${T}`);return}if(!M){console.error(`‚ùå Plan ID missing for ${T}`),f.innerHTML='<p class="text-xs text-red-500">Plan not configured</p>';return}f.innerHTML="";try{window.paypal.Buttons({style:{shape:"rect",color:"gold",layout:"vertical",label:"subscribe"},createSubscription:(I,p)=>(console.log(`Creating subscription for ${T} with plan:`,M.slice(0,10)+"..."),p.subscription.create({plan_id:M,custom_id:c})),onApprove:async I=>{console.log("‚úÖ Subscription approved:",I.subscriptionID),j(!0),setTimeout(()=>j(!1),1e4),setTimeout(async()=>{const{data:p}=await ve.from("subscriptions").select("*").eq("user_id",c).maybeSingle();p&&m(p)},1e4)},onCancel:qe,onError:He}).render(f),console.log(`‚úÖ Button rendered for ${T}`)}catch(I){const p=I;console.error(`‚ùå Failed to create button for ${T}:`,p),f.innerHTML='<p class="text-xs text-red-500">Button error</p>'}};d||(l(we.current,fe,"Base Monthly"),l(Ce.current,pe,"Base Yearly")),l(Be.current,he,"Addon Monthly"),l(Ae.current,be,"Addon Yearly")},200);return()=>clearTimeout(n)},X=[u,a,c,d,r,fe,pe,he,be],e[12]=r,e[13]=d,e[14]=u,e[15]=a,e[16]=c,e[17]=Q,e[18]=X):(Q=e[17],X=e[18]),o.useEffect(Q,X),u){let n;e[19]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-8 tracking-tight",children:"Billing & Subscription"}),e[19]=n):n=e[19];let l;return e[20]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-10 md:py-14 max-w-3xl",children:[n,s.jsx("div",{className:"flex justify-center items-center py-12",children:s.jsx($,{className:"animate-spin h-8 w-8 text-primary"})})]}),e[20]=l):l=e[20],l}if(!c){let n;e[21]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-8 tracking-tight",children:"Billing & Subscription"}),e[21]=n):n=e[21];let l;return e[22]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-10 md:py-14 max-w-3xl",children:[n,s.jsx(N,{className:"mb-8",children:s.jsxs(ue,{children:[s.jsx(me,{children:"Sign in required"}),s.jsx(xe,{children:"Please sign in to view or manage your subscription."})]})})]}),e[22]=l):l=e[22],l}let W;e[23]!==i?(W=i?.next_billing_time?new Date(i.next_billing_time).toLocaleDateString():null,e[23]=i,e[24]=W):W=e[24];const _e=W;let Z;e[25]===Symbol.for("react.memo_cache_sentinel")?(Z=s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-8 tracking-tight",children:"Billing & Subscription"}),e[25]=Z):Z=e[25];let S;e[26]!==r?(S=r&&s.jsx(N,{className:"mb-6 border-red-200 bg-red-50",children:s.jsx(Y,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Me,{className:"h-5 w-5 text-red-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-red-900",children:"Configuration Error"}),s.jsx("p",{className:"text-sm text-red-700 mt-1",children:r}),s.jsx("p",{className:"text-xs text-red-600 mt-2",children:"Running in SANDBOX mode"})]})]})})}),e[26]=r,e[27]=S):S=e[27];let _;e[28]!==y?(_=y&&s.jsx(N,{className:"mb-6 border-green-200 bg-green-50",children:s.jsx(Y,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Pe,{className:"h-5 w-5 text-green-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-green-900",children:"Subscription successful!"}),s.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Your subscription is being processed. It may take a few moments to appear below."})]})]})})}),e[28]=y,e[29]=_):_=e[29];let v;e[30]!==ge||e[31]!==d||e[32]!==Se||e[33]!==_e||e[34]!==Ne||e[35]!==i?(v=s.jsx(Ue,{hasBase:d,addonCount:ge,petLimit:Ne,subscription:i,isActive:Se,nextBilling:_e}),e[30]=ge,e[31]=d,e[32]=Se,e[33]=_e,e[34]=Ne,e[35]=i,e[36]=v):v=e[36];let ee;e[37]===Symbol.for("react.memo_cache_sentinel")?(ee=s.jsxs(ue,{children:[s.jsx(me,{children:"PawTrace Base"}),s.jsx(xe,{children:"Up to 3 pets included"})]}),e[37]=ee):ee=e[37];let se;e[38]===Symbol.for("react.memo_cache_sentinel")?(se=s.jsx("div",{className:"text-2xl font-bold",children:"$3 / mo"}),e[38]=se):se=e[38];let P;e[39]!==d||e[40]!==a?(P=d?s.jsx(De,{className:"w-full",disabled:!0,children:"Already Subscribed"}):s.jsx("div",{ref:we,className:"min-h-[45px]",children:!a&&s.jsx($,{className:"animate-spin h-5 w-5 mx-auto"})}),e[39]=d,e[40]=a,e[41]=P):P=e[41];let te,ae;e[42]===Symbol.for("react.memo_cache_sentinel")?(te=s.jsx("div",{className:"text-sm text-muted-foreground",children:"or"}),ae=s.jsx("div",{className:"text-2xl font-bold",children:"$30 / yr"}),e[42]=te,e[43]=ae):(te=e[42],ae=e[43]);let w;e[44]!==d||e[45]!==a?(w=d?s.jsx(De,{className:"w-full",variant:"outline",disabled:!0,children:"Already Subscribed"}):s.jsx("div",{ref:Ce,className:"min-h-[45px]",children:!a&&s.jsx($,{className:"animate-spin h-5 w-5 mx-auto"})}),e[44]=d,e[45]=a,e[46]=w):w=e[46];let C;e[47]!==P||e[48]!==w?(C=s.jsxs(N,{children:[ee,s.jsxs(Y,{className:"space-y-3",children:[se,P,te,ae,w]})]}),e[47]=P,e[48]=w,e[49]=C):C=e[49];let le;e[50]===Symbol.for("react.memo_cache_sentinel")?(le=s.jsxs(ue,{children:[s.jsx(me,{children:"Extra Pets Add-on"}),s.jsx(xe,{children:"Each add-on adds 1 pet"})]}),e[50]=le):le=e[50];let ne;e[51]===Symbol.for("react.memo_cache_sentinel")?(ne=s.jsx("div",{className:"text-2xl font-bold",children:"$1.50 / mo"}),e[51]=ne):ne=e[51];let B;e[52]!==a?(B=!a&&s.jsx($,{className:"animate-spin h-5 w-5 mx-auto"}),e[52]=a,e[53]=B):B=e[53];let A;e[54]!==B?(A=s.jsx("div",{ref:Be,className:"min-h-[45px]",children:B}),e[54]=B,e[55]=A):A=e[55];let re,ie;e[56]===Symbol.for("react.memo_cache_sentinel")?(re=s.jsx("div",{className:"text-sm text-muted-foreground",children:"or"}),ie=s.jsx("div",{className:"text-2xl font-bold",children:"$18 / yr"}),e[56]=re,e[57]=ie):(re=e[56],ie=e[57]);let E;e[58]!==a?(E=!a&&s.jsx($,{className:"animate-spin h-5 w-5 mx-auto"}),e[58]=a,e[59]=E):E=e[59];let D;e[60]!==E?(D=s.jsx("div",{ref:Ae,className:"min-h-[45px]",children:E}),e[60]=E,e[61]=D):D=e[61];let R;e[62]!==A||e[63]!==D?(R=s.jsxs(N,{children:[le,s.jsxs(Y,{className:"space-y-3",children:[ne,A,re,ie,D]})]}),e[62]=A,e[63]=D,e[64]=R):R=e[64];let L;e[65]!==C||e[66]!==R?(L=s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[C,R]}),e[65]=C,e[66]=R,e[67]=L):L=e[67];let oe;e[68]===Symbol.for("react.memo_cache_sentinel")?(oe=s.jsx(Me,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e[68]=oe):oe=e[68];let ce;e[69]===Symbol.for("react.memo_cache_sentinel")?(ce=s.jsx(N,{className:"mt-6 border-blue-200 bg-blue-50",children:s.jsx(Y,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[oe,s.jsxs("div",{className:"text-sm text-blue-900",children:[s.jsx("p",{className:"font-medium mb-1",children:"About subscriptions"}),s.jsx("p",{children:"Payments are handled by PayPal. After subscribing, it can take up to 60 seconds for your subscription to appear here. To cancel or manage your subscription, log in to PayPal and go to Settings ‚Üí Payments ‚Üí Manage automatic payments."})]})]})})}),e[69]=ce):ce=e[69];let de;return e[70]!==S||e[71]!==_||e[72]!==v||e[73]!==L?(de=s.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-10 md:py-14 max-w-3xl",children:[Z,S,_,v,L,ce]}),e[70]=S,e[71]=_,e[72]=v,e[73]=L,e[74]=de):de=e[74],de}function He(e){console.error("‚ùå PayPal subscription error:",e);const t=e?.message||"An error occurred with PayPal";t.includes("RESOURCE_NOT_FOUND")||t.includes("INVALID_RESOURCE_ID")?alert("The subscription plan is not available. Please contact support."):alert("An error occurred. Please try again or contact support.")}function qe(){console.log("‚ÑπÔ∏è Subscription cancelled by user")}function Fe(){}export{Ze as default};
