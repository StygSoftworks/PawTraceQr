import{c as we,d as Ie,u as Oe,a as _e,j as s,s as We}from"./index-BrQ1kaVe.js";import{u as Ce}from"./useQuery-Cph-vAgB.js";import{u as pe}from"./useMutation-_MRBwrqQ.js";import{a as Te,u as Pe,o as Ye,s as Ae,n as Ue}from"./zod-8VOkz032.js";import{S as Ne,l as Ge,c as Je,u as Xe,d as Ze}from"./feedback-Q4AgOfUE.js";import{C as X,d as ye,c as et,b as tt,a as st,e as at}from"./card-srctd-FK.js";import{T as qe,A as Re,e as lt,f as it,g as Ee,h as Le,i as Me,j as $e,k as Ke,l as Qe,m as Ve,d as je,b as nt,c as be,a as rt}from"./textarea-DLG4lxoV.js";import{I as ze,L as ue}from"./label-gRaS46qL.js";import{B as ve}from"./button-D-J66a_0.js";import{A as De,a as Fe}from"./alert-DBB0UjR5.js";import{S as J}from"./skeleton-04qvWPpH.js";import{c as ct}from"./createLucideIcon-B7gIsfRZ.js";import"./utils-CBfrqCZ4.js";import"./index-DueQn3pS.js";import"./index-CZ-Y2t3-.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ot=ct("pencil",mt);function Be(e){const t=we.c(6),{value:r,onChange:o,disabled:l,size:k}=e,c=k===void 0?20:k,[y,C]=_e.useState(null),u=y??r;let a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=[1,2,3,4,5],t[0]=a):a=t[0];let x;return t[1]!==u||t[2]!==l||t[3]!==o||t[4]!==c?(x=s.jsx("div",{className:"flex gap-1",children:a.map(d=>{const A=u>=d;return s.jsx("button",{type:"button",className:`p-1 rounded-md transition-colors ${l?"opacity-60 cursor-not-allowed":"hover:bg-secondary/60"}`,onMouseEnter:()=>!l&&C(d),onMouseLeave:()=>!l&&C(null),onClick:()=>!l&&o(d),"aria-label":`${d} star${d>1?"s":""}`,children:s.jsx(Ne,{className:`${A?"fill-yellow-400 text-yellow-500":"text-muted-foreground/50"}`,style:{width:c,height:c}})},d)})}),t[1]=u,t[2]=l,t[3]=o,t[4]=c,t[5]=x):x=t[5],x}const He=Ye({rating:Ue().min(1,"Please select a rating").max(5),comment:Ae().min(6,"Please write a few words (6+ chars)").max(2e3),display_name:Ae().max(60).optional()});async function dt(e=20){const{data:t,error:r}=await We.from("feedback_public").select("*").order("created_at",{ascending:!1}).limit(e);if(r)throw r;return t??[]}function ut(e){const t=we.c(66),{open:r,onOpenChange:o,review:l,onSave:k,saving:c}=e;let y;t[0]===Symbol.for("react.memo_cache_sentinel")?(y=Te(He),t[0]=y):y=t[0];const C=l.display_name??"";let u;t[1]!==l.comment||t[2]!==l.rating||t[3]!==C?(u={resolver:y,defaultValues:{rating:l.rating,comment:l.comment,display_name:C}},t[1]=l.comment,t[2]=l.rating,t[3]=C,t[4]=u):u=t[4];const{register:a,handleSubmit:x,setValue:d,watch:A,formState:O}=Pe(u),{errors:n,isSubmitting:D}=O;let B;t[5]!==A?(B=A("rating"),t[5]=A,t[6]=B):B=t[6];const F=B;let W;t[7]===Symbol.for("react.memo_cache_sentinel")?(W=s.jsxs(Le,{children:[s.jsx(Me,{children:"Edit your review"}),s.jsx($e,{children:"Update your rating or comment. Changes may require re-approval."})]}),t[7]=W):W=t[7];let T;t[8]!==o||t[9]!==k?(T=async j=>{await k({rating:j.rating,comment:j.comment,display_name:j.display_name??null}),o(!1)},t[8]=o,t[9]=k,t[10]=T):T=t[10];let P;t[11]!==x||t[12]!==T?(P=x(T),t[11]=x,t[12]=T,t[13]=P):P=t[13];let Y;t[14]===Symbol.for("react.memo_cache_sentinel")?(Y=s.jsx(ue,{children:"Rating"}),t[14]=Y):Y=t[14];let U;t[15]!==d?(U=j=>d("rating",j,{shouldValidate:!0}),t[15]=d,t[16]=U):U=t[16];const m=c||D;let q;t[17]!==F||t[18]!==U||t[19]!==m?(q=s.jsx(Be,{value:F,onChange:U,disabled:m}),t[17]=F,t[18]=U,t[19]=m,t[20]=q):q=t[20];let b;t[21]!==n.rating?(b=n.rating&&s.jsx("p",{className:"text-sm text-destructive",children:n.rating.message}),t[21]=n.rating,t[22]=b):b=t[22];let R;t[23]!==q||t[24]!==b?(R=s.jsxs("div",{className:"grid gap-2",children:[Y,q,b]}),t[23]=q,t[24]=b,t[25]=R):R=t[25];let H;t[26]===Symbol.for("react.memo_cache_sentinel")?(H=s.jsx(ue,{htmlFor:"display_name",children:"Display name (optional)"}),t[26]=H):H=t[26];let E;t[27]!==a?(E=a("display_name"),t[27]=a,t[28]=E):E=t[28];const L=c||D;let M;t[29]!==E||t[30]!==L?(M=s.jsx(ze,{id:"display_name",...E,disabled:L}),t[29]=E,t[30]=L,t[31]=M):M=t[31];let v;t[32]!==n.display_name?(v=n.display_name&&s.jsx("p",{className:"text-sm text-destructive",children:n.display_name.message}),t[32]=n.display_name,t[33]=v):v=t[33];let $;t[34]!==M||t[35]!==v?($=s.jsxs("div",{className:"grid gap-2",children:[H,M,v]}),t[34]=M,t[35]=v,t[36]=$):$=t[36];let I;t[37]===Symbol.for("react.memo_cache_sentinel")?(I=s.jsx(ue,{htmlFor:"comment",children:"Comment"}),t[37]=I):I=t[37];let _;t[38]!==a?(_=a("comment"),t[38]=a,t[39]=_):_=t[39];const G=c||D;let h;t[40]!==_||t[41]!==G?(h=s.jsx(qe,{id:"comment",rows:5,..._,disabled:G}),t[40]=_,t[41]=G,t[42]=h):h=t[42];let f;t[43]!==n.comment?(f=n.comment&&s.jsx("p",{className:"text-sm text-destructive",children:n.comment.message}),t[43]=n.comment,t[44]=f):f=t[44];let w;t[45]!==h||t[46]!==f?(w=s.jsxs("div",{className:"grid gap-2",children:[I,h,f]}),t[45]=h,t[46]=f,t[47]=w):w=t[47];const K=c||D;let Q;t[48]!==K?(Q=s.jsx(Qe,{disabled:K,children:"Cancel"}),t[48]=K,t[49]=Q):Q=t[49];const V=c||D,z=c||D?"Savingâ€¦":"Save changes";let g;t[50]!==V||t[51]!==z?(g=s.jsx(Ve,{type:"submit",disabled:V,children:z}),t[50]=V,t[51]=z,t[52]=g):g=t[52];let N;t[53]!==Q||t[54]!==g?(N=s.jsxs(Ke,{children:[Q,g]}),t[53]=Q,t[54]=g,t[55]=N):N=t[55];let p;t[56]!==R||t[57]!==$||t[58]!==w||t[59]!==N||t[60]!==P?(p=s.jsxs(Ee,{children:[W,s.jsxs("form",{onSubmit:P,className:"grid gap-4",children:[R,$,w,N]})]}),t[56]=R,t[57]=$,t[58]=w,t[59]=N,t[60]=P,t[61]=p):p=t[61];let S;return t[62]!==o||t[63]!==r||t[64]!==p?(S=s.jsx(Re,{open:r,onOpenChange:o,children:p}),t[62]=o,t[63]=r,t[64]=p,t[65]=S):S=t[65],S}function Lt(){const e=we.c(91),t=Ie(),{user:r}=Oe();let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o={queryKey:["feedback_public"],queryFn:bt,staleTime:6e4},e[0]=o):o=e[0];const{data:l,isLoading:k}=Ce(o);let c;e[1]===Symbol.for("react.memo_cache_sentinel")?(c={queryKey:["my-feedback"],queryFn:Ge,staleTime:3e4},e[1]=c):c=e[1];const{data:y,isLoading:C}=Ce(c);let u;e[2]!==t?(u={mutationFn:Je,onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:["feedback_public"]}),t.invalidateQueries({queryKey:["my-feedback"]})])}},e[2]=t,e[3]=u):u=e[3];const a=pe(u);let x;e[4]!==t?(x={mutationFn:jt,onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:["feedback_public"]}),t.invalidateQueries({queryKey:["my-feedback"]})])}},e[4]=t,e[5]=x):x=e[5];const d=pe(x);let A;e[6]!==t?(A={mutationFn:yt,onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:["feedback_public"]}),t.invalidateQueries({queryKey:["my-feedback"]})])}},e[6]=t,e[7]=A):A=e[7];const O=pe(A);let n;e[8]===Symbol.for("react.memo_cache_sentinel")?(n=Te(He),e[8]=n):n=e[8];const D=r?.user_metadata?.name??"";let B;e[9]!==D?(B={resolver:n,defaultValues:{rating:5,comment:"",display_name:D}},e[9]=D,e[10]=B):B=e[10];const{register:F,handleSubmit:W,setValue:T,watch:P,reset:Y,formState:U}=Pe(B),{errors:m,isSubmitting:q}=U;let b;e[11]!==P?(b=P("rating"),e[11]=P,e[12]=b):b=e[12];const R=b;let H;e[13]!==a||e[14]!==Y||e[15]!==r?.user_metadata?.name?(H=async i=>{await a.mutateAsync(i),Y({rating:5,comment:"",display_name:r?.user_metadata?.name??""})},e[13]=a,e[14]=Y,e[15]=r?.user_metadata?.name,e[16]=H):H=e[16];const E=H,[L,M]=_e.useState(null),[v,$]=_e.useState(null);let I;e[17]===Symbol.for("react.memo_cache_sentinel")?(I=s.jsxs("div",{className:"text-center mb-10 space-y-2",children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:"Feedback"}),s.jsx("p",{className:"text-muted-foreground",children:"Share your experience with PawTrace. Reviews appear publicly after moderation."})]}),e[17]=I):I=e[17];let _;e[18]===Symbol.for("react.memo_cache_sentinel")?(_=s.jsxs(nt,{className:"grid grid-cols-3 max-w-lg mx-auto",children:[s.jsx(be,{value:"write",children:"Write a review"}),s.jsx(be,{value:"mine",children:"My reviews"}),s.jsx(be,{value:"public",children:"Public reviews"})]}),e[18]=_):_=e[18];let G;e[19]===Symbol.for("react.memo_cache_sentinel")?(G=s.jsxs(et,{children:[s.jsx(tt,{children:"Leave a review"}),s.jsx(ye,{children:"Rate PawTrace and add a short comment."})]}),e[19]=G):G=e[19];let h;e[20]!==a.error||e[21]!==a.isError?(h=a.isError&&s.jsx(De,{variant:"destructive",children:s.jsx(Fe,{children:a.error?.message??"Failed to submit feedback"})}),e[20]=a.error,e[21]=a.isError,e[22]=h):h=e[22];let f;e[23]!==a.isSuccess?(f=a.isSuccess&&s.jsx(De,{children:s.jsx(Fe,{children:"Thanks! Your review was submitted and will be visible after approval."})}),e[23]=a.isSuccess,e[24]=f):f=e[24];let w;e[25]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx(ue,{children:"Rating"}),e[25]=w):w=e[25];let K;e[26]!==T?(K=i=>T("rating",i,{shouldValidate:!0}),e[26]=T,e[27]=K):K=e[27];const Q=q||a.isPending;let V;e[28]!==R||e[29]!==K||e[30]!==Q?(V=s.jsx(Be,{value:R,onChange:K,disabled:Q}),e[28]=R,e[29]=K,e[30]=Q,e[31]=V):V=e[31];let z;e[32]!==m.rating?(z=m.rating&&s.jsx("p",{className:"text-sm text-destructive",children:m.rating.message}),e[32]=m.rating,e[33]=z):z=e[33];let g;e[34]!==V||e[35]!==z?(g=s.jsxs("div",{className:"grid gap-2",children:[w,V,z]}),e[34]=V,e[35]=z,e[36]=g):g=e[36];let N;e[37]===Symbol.for("react.memo_cache_sentinel")?(N=s.jsx(ue,{htmlFor:"display_name",children:"Display name (optional)"}),e[37]=N):N=e[37];let p;e[38]!==F?(p=F("display_name"),e[38]=F,e[39]=p):p=e[39];let S;e[40]!==p?(S=s.jsx(ze,{id:"display_name",placeholder:"e.g., Collin",...p}),e[40]=p,e[41]=S):S=e[41];let j;e[42]!==m.display_name?(j=m.display_name&&s.jsx("p",{className:"text-sm text-destructive",children:m.display_name.message}),e[42]=m.display_name,e[43]=j):j=e[43];let Z;e[44]!==S||e[45]!==j?(Z=s.jsxs("div",{className:"grid gap-2",children:[N,S,j]}),e[44]=S,e[45]=j,e[46]=Z):Z=e[46];let xe;e[47]===Symbol.for("react.memo_cache_sentinel")?(xe=s.jsx(ue,{htmlFor:"comment",children:"Comment"}),e[47]=xe):xe=e[47];let ee;e[48]!==F?(ee=F("comment"),e[48]=F,e[49]=ee):ee=e[49];let te;e[50]!==ee?(te=s.jsx(qe,{id:"comment",placeholder:"What do you like? What should we improve?",rows:5,...ee}),e[50]=ee,e[51]=te):te=e[51];let se;e[52]!==m.comment?(se=m.comment&&s.jsx("p",{className:"text-sm text-destructive",children:m.comment.message}),e[52]=m.comment,e[53]=se):se=e[53];let ae;e[54]!==te||e[55]!==se?(ae=s.jsxs("div",{className:"grid gap-2",children:[xe,te,se]}),e[54]=te,e[55]=se,e[56]=ae):ae=e[56];let le;e[57]!==h||e[58]!==f||e[59]!==g||e[60]!==Z||e[61]!==ae?(le=s.jsxs(st,{className:"space-y-5",children:[h,f,g,Z,ae]}),e[57]=h,e[58]=f,e[59]=g,e[60]=Z,e[61]=ae,e[62]=le):le=e[62];let ie;e[63]!==W||e[64]!==E?(ie=W(E),e[63]=W,e[64]=E,e[65]=ie):ie=e[65];const fe=q||a.isPending,ge=q||a.isPending?"Submittingâ€¦":"Submit review";let ne;e[66]!==ie||e[67]!==fe||e[68]!==ge?(ne=s.jsx(at,{children:s.jsx(ve,{onClick:ie,disabled:fe,className:"w-full",children:ge})}),e[66]=ie,e[67]=fe,e[68]=ge,e[69]=ne):ne=e[69];let re;e[70]!==le||e[71]!==ne?(re=s.jsx(je,{value:"write",className:"mt-6",children:s.jsxs(X,{children:[G,le,ne]})}),e[70]=le,e[71]=ne,e[72]=re):re=e[72];let ce;e[73]!==O||e[74]!==v||e[75]!==C||e[76]!==y?(ce=s.jsx("div",{className:"space-y-4",children:C?s.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:Array.from({length:4}).map(gt)}):y&&y.length>0?s.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:y.map(i=>s.jsxs(X,{className:"p-4 flex flex-col gap-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:5}).map((Se,ke)=>s.jsx(Ne,{className:`h-4 w-4 ${ke<i.rating?"fill-yellow-400 text-yellow-500":"text-muted-foreground/40"}`},ke))}),s.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(i.created_at).toLocaleDateString()})]}),s.jsx("div",{className:"text-sm",children:i.comment}),i.display_name&&s.jsxs("div",{className:"text-xs text-muted-foreground",children:["â€” ",i.display_name]}),s.jsxs("div",{className:"mt-2 flex gap-2",children:[s.jsxs(ve,{size:"sm",variant:"outline",onClick:()=>M(i),children:[s.jsx(ot,{className:"h-4 w-4 mr-1"})," Edit"]}),s.jsxs(Re,{open:!!v&&v.id===i.id,onOpenChange:Se=>!Se&&$(null),children:[s.jsx(lt,{asChild:!0,children:s.jsxs(ve,{size:"sm",variant:"destructive",onClick:()=>$(i),children:[s.jsx(it,{className:"h-4 w-4 mr-1"})," Delete"]})}),s.jsxs(Ee,{children:[s.jsxs(Le,{children:[s.jsx(Me,{children:"Delete this review?"}),s.jsx($e,{children:"This will permanently remove your review. This action cannot be undone."})]}),s.jsxs(Ke,{children:[s.jsx(Qe,{disabled:O.isPending,children:"Cancel"}),s.jsx(Ve,{disabled:O.isPending,onClick:async()=>{await O.mutateAsync(i.id),$(null)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:O.isPending?"Deletingâ€¦":"Delete"})]})]})]})]})]},i.id))}):s.jsx(X,{className:"p-6",children:s.jsx(ye,{children:"You havenâ€™t written any reviews yet."})})}),e[73]=O,e[74]=v,e[75]=C,e[76]=y,e[77]=ce):ce=e[77];let me;e[78]!==L||e[79]!==d?(me=L&&s.jsx(ut,{open:!!L,onOpenChange:i=>!i&&M(null),review:L,saving:d.isPending,onSave:async i=>{await d.mutateAsync({id:L.id,patch:i}),M(null)}}),e[78]=L,e[79]=d,e[80]=me):me=e[80];let oe;e[81]!==ce||e[82]!==me?(oe=s.jsxs(je,{value:"mine",className:"mt-6",children:[ce,me]}),e[81]=ce,e[82]=me,e[83]=oe):oe=e[83];let de;e[84]!==k||e[85]!==l?(de=s.jsx(je,{value:"public",className:"mt-6",children:k?s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map(ht)}):l&&l.length>0?s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(xt)}):s.jsx(X,{className:"p-6",children:s.jsx(ye,{children:"No public reviews yet. Be the first to share your experience!"})})}),e[84]=k,e[85]=l,e[86]=de):de=e[86];let he;return e[87]!==re||e[88]!==oe||e[89]!==de?(he=s.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-10 md:py-14 max-w-6xl",children:[I,s.jsxs(rt,{defaultValue:"write",children:[_,re,oe,de]})]}),e[87]=re,e[88]=oe,e[89]=de,e[90]=he):he=e[90],he}function xt(e){return s.jsxs(X,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:5}).map((t,r)=>s.jsx(Ne,{className:`h-4 w-4 ${r<e.rating?"fill-yellow-400 text-yellow-500":"text-muted-foreground/40"}`},r))}),s.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()})]}),s.jsx("div",{className:"mt-2 text-sm",children:e.comment}),e.display_name&&s.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["â€” ",e.display_name]})]},e.id)}function ht(e,t){return s.jsxs(X,{className:"p-4",children:[s.jsx(J,{className:"h-4 w-1/3 mb-3"}),s.jsx("div",{className:"flex gap-2 mb-3",children:Array.from({length:5}).map(ft)}),s.jsx(J,{className:"h-4 w-3/4 mb-2"}),s.jsx(J,{className:"h-4 w-2/3"})]},t)}function ft(e,t){return s.jsx(J,{className:"h-5 w-5 rounded"},t)}function gt(e,t){return s.jsxs(X,{className:"p-4",children:[s.jsx(J,{className:"h-4 w-1/3 mb-3"}),s.jsx("div",{className:"flex gap-2 mb-3",children:Array.from({length:5}).map(pt)}),s.jsx(J,{className:"h-4 w-3/4 mb-2"}),s.jsx(J,{className:"h-4 w-2/3"})]},t)}function pt(e,t){return s.jsx(J,{className:"h-5 w-5 rounded"},t)}function yt(e){return Ze(e)}function jt(e){return Xe(e.id,e.patch)}function bt(){return dt(24)}export{Lt as default};
