import{s as he,c as Ne,d as We,u as Ye,a as we,j as s}from"./index-BYyCR7a8.js";import{u as Ae}from"./useQuery-X6qfuXyI.js";import{u as ye}from"./useMutation-B-9nTQiB.js";import{a as Pe,u as qe,o as Ue,s as De,n as Ge}from"./zod-BnwIaGvH.js";import{C as X,d as je,c as Je,b as Xe,a as Ze,e as et}from"./card-CxkrYs2T.js";import{T as Le,A as Re,e as tt,f as st,g as Ee,h as Me,i as $e,j as Ke,k as Qe,l as Ve,m as ze,d as be,b as at,c as ve,a as lt}from"./textarea-Cbf09810.js";import{I as Be,L as ue}from"./label-Cf7E3JeO.js";import{B as _e}from"./button-kJQSyUeG.js";import{A as Fe,a as Te}from"./alert-BUmMUQDD.js";import{S as J}from"./skeleton-DoXRyjb-.js";import{c as He}from"./createLucideIcon-o3bzkOq8.js";import"./index-BPw6z_qz.js";import"./index-_bnbTYx0.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],nt=He("pencil",it);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Se=He("star",rt);async function ct(e){const{data:t,error:l}=await he.from("feedback").insert({rating:e.rating,comment:e.comment,display_name:e.display_name??null}).select().single();if(l)throw l;return t}async function mt(){const{data:e,error:t}=await he.from("feedback").select("*").order("created_at",{ascending:!1});if(t)throw t;return e??[]}async function ot(e,t){const{data:l,error:n}=await he.from("feedback").update(t).eq("id",e).select().single();if(n)throw n;return l}async function dt(e){const{error:t}=await he.from("feedback").delete().eq("id",e);if(t)throw t;return!0}function Ie(e){const t=Ne.c(6),{value:l,onChange:n,disabled:i,size:k}=e,m=k===void 0?20:k,[y,C]=we.useState(null),u=y??l;let a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=[1,2,3,4,5],t[0]=a):a=t[0];let h;return t[1]!==u||t[2]!==i||t[3]!==n||t[4]!==m?(h=s.jsx("div",{className:"flex gap-1",children:a.map(d=>{const A=u>=d;return s.jsx("button",{type:"button",className:`p-1 rounded-md transition-colors ${i?"opacity-60 cursor-not-allowed":"hover:bg-secondary/60"}`,onMouseEnter:()=>!i&&C(d),onMouseLeave:()=>!i&&C(null),onClick:()=>!i&&n(d),"aria-label":`${d} star${d>1?"s":""}`,children:s.jsx(Se,{className:`${A?"fill-yellow-400 text-yellow-500":"text-muted-foreground/50"}`,style:{width:m,height:m}})},d)})}),t[1]=u,t[2]=i,t[3]=n,t[4]=m,t[5]=h):h=t[5],h}const Oe=Ue({rating:Ge().min(1,"Please select a rating").max(5),comment:De().min(6,"Please write a few words (6+ chars)").max(2e3),display_name:De().max(60).optional()});async function ut(e=20){const{data:t,error:l}=await he.from("feedback_public").select("*").order("created_at",{ascending:!1}).limit(e);if(l)throw l;return t??[]}function ht(e){const t=Ne.c(66),{open:l,onOpenChange:n,review:i,onSave:k,saving:m}=e;let y;t[0]===Symbol.for("react.memo_cache_sentinel")?(y=Pe(Oe),t[0]=y):y=t[0];const C=i.display_name??"";let u;t[1]!==i.comment||t[2]!==i.rating||t[3]!==C?(u={resolver:y,defaultValues:{rating:i.rating,comment:i.comment,display_name:C}},t[1]=i.comment,t[2]=i.rating,t[3]=C,t[4]=u):u=t[4];const{register:a,handleSubmit:h,setValue:d,watch:A,formState:O}=qe(u),{errors:c,isSubmitting:D}=O;let B;t[5]!==A?(B=A("rating"),t[5]=A,t[6]=B):B=t[6];const F=B;let W;t[7]===Symbol.for("react.memo_cache_sentinel")?(W=s.jsxs(Me,{children:[s.jsx($e,{children:"Edit your review"}),s.jsx(Ke,{children:"Update your rating or comment. Changes may require re-approval."})]}),t[7]=W):W=t[7];let T;t[8]!==n||t[9]!==k?(T=async j=>{await k({rating:j.rating,comment:j.comment,display_name:j.display_name??null}),n(!1)},t[8]=n,t[9]=k,t[10]=T):T=t[10];let P;t[11]!==h||t[12]!==T?(P=h(T),t[11]=h,t[12]=T,t[13]=P):P=t[13];let Y;t[14]===Symbol.for("react.memo_cache_sentinel")?(Y=s.jsx(ue,{children:"Rating"}),t[14]=Y):Y=t[14];let U;t[15]!==d?(U=j=>d("rating",j,{shouldValidate:!0}),t[15]=d,t[16]=U):U=t[16];const o=m||D;let q;t[17]!==F||t[18]!==U||t[19]!==o?(q=s.jsx(Ie,{value:F,onChange:U,disabled:o}),t[17]=F,t[18]=U,t[19]=o,t[20]=q):q=t[20];let b;t[21]!==c.rating?(b=c.rating&&s.jsx("p",{className:"text-sm text-destructive",children:c.rating.message}),t[21]=c.rating,t[22]=b):b=t[22];let L;t[23]!==q||t[24]!==b?(L=s.jsxs("div",{className:"grid gap-2",children:[Y,q,b]}),t[23]=q,t[24]=b,t[25]=L):L=t[25];let H;t[26]===Symbol.for("react.memo_cache_sentinel")?(H=s.jsx(ue,{htmlFor:"display_name",children:"Display name (optional)"}),t[26]=H):H=t[26];let R;t[27]!==a?(R=a("display_name"),t[27]=a,t[28]=R):R=t[28];const E=m||D;let M;t[29]!==R||t[30]!==E?(M=s.jsx(Be,{id:"display_name",...R,disabled:E}),t[29]=R,t[30]=E,t[31]=M):M=t[31];let v;t[32]!==c.display_name?(v=c.display_name&&s.jsx("p",{className:"text-sm text-destructive",children:c.display_name.message}),t[32]=c.display_name,t[33]=v):v=t[33];let $;t[34]!==M||t[35]!==v?($=s.jsxs("div",{className:"grid gap-2",children:[H,M,v]}),t[34]=M,t[35]=v,t[36]=$):$=t[36];let I;t[37]===Symbol.for("react.memo_cache_sentinel")?(I=s.jsx(ue,{htmlFor:"comment",children:"Comment"}),t[37]=I):I=t[37];let _;t[38]!==a?(_=a("comment"),t[38]=a,t[39]=_):_=t[39];const G=m||D;let f;t[40]!==_||t[41]!==G?(f=s.jsx(Le,{id:"comment",rows:5,..._,disabled:G}),t[40]=_,t[41]=G,t[42]=f):f=t[42];let x;t[43]!==c.comment?(x=c.comment&&s.jsx("p",{className:"text-sm text-destructive",children:c.comment.message}),t[43]=c.comment,t[44]=x):x=t[44];let w;t[45]!==f||t[46]!==x?(w=s.jsxs("div",{className:"grid gap-2",children:[I,f,x]}),t[45]=f,t[46]=x,t[47]=w):w=t[47];const K=m||D;let Q;t[48]!==K?(Q=s.jsx(Ve,{disabled:K,children:"Cancel"}),t[48]=K,t[49]=Q):Q=t[49];const V=m||D,z=m||D?"Savingâ€¦":"Save changes";let g;t[50]!==V||t[51]!==z?(g=s.jsx(ze,{type:"submit",disabled:V,children:z}),t[50]=V,t[51]=z,t[52]=g):g=t[52];let N;t[53]!==Q||t[54]!==g?(N=s.jsxs(Qe,{children:[Q,g]}),t[53]=Q,t[54]=g,t[55]=N):N=t[55];let p;t[56]!==L||t[57]!==$||t[58]!==w||t[59]!==N||t[60]!==P?(p=s.jsxs(Ee,{children:[W,s.jsxs("form",{onSubmit:P,className:"grid gap-4",children:[L,$,w,N]})]}),t[56]=L,t[57]=$,t[58]=w,t[59]=N,t[60]=P,t[61]=p):p=t[61];let S;return t[62]!==n||t[63]!==l||t[64]!==p?(S=s.jsx(Re,{open:l,onOpenChange:n,children:p}),t[62]=n,t[63]=l,t[64]=p,t[65]=S):S=t[65],S}function Rt(){const e=Ne.c(91),t=We(),{user:l}=Ye();let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n={queryKey:["feedback_public"],queryFn:vt,staleTime:6e4},e[0]=n):n=e[0];const{data:i,isLoading:k}=Ae(n);let m;e[1]===Symbol.for("react.memo_cache_sentinel")?(m={queryKey:["my-feedback"],queryFn:mt,staleTime:3e4},e[1]=m):m=e[1];const{data:y,isLoading:C}=Ae(m);let u;e[2]!==t?(u={mutationFn:ct,onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:["feedback_public"]}),t.invalidateQueries({queryKey:["my-feedback"]})])}},e[2]=t,e[3]=u):u=e[3];const a=ye(u);let h;e[4]!==t?(h={mutationFn:bt,onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:["feedback_public"]}),t.invalidateQueries({queryKey:["my-feedback"]})])}},e[4]=t,e[5]=h):h=e[5];const d=ye(h);let A;e[6]!==t?(A={mutationFn:jt,onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:["feedback_public"]}),t.invalidateQueries({queryKey:["my-feedback"]})])}},e[6]=t,e[7]=A):A=e[7];const O=ye(A);let c;e[8]===Symbol.for("react.memo_cache_sentinel")?(c=Pe(Oe),e[8]=c):c=e[8];const D=l?.user_metadata?.name??"";let B;e[9]!==D?(B={resolver:c,defaultValues:{rating:5,comment:"",display_name:D}},e[9]=D,e[10]=B):B=e[10];const{register:F,handleSubmit:W,setValue:T,watch:P,reset:Y,formState:U}=qe(B),{errors:o,isSubmitting:q}=U;let b;e[11]!==P?(b=P("rating"),e[11]=P,e[12]=b):b=e[12];const L=b;let H;e[13]!==a||e[14]!==Y||e[15]!==l?.user_metadata?.name?(H=async r=>{await a.mutateAsync(r),Y({rating:5,comment:"",display_name:l?.user_metadata?.name??""})},e[13]=a,e[14]=Y,e[15]=l?.user_metadata?.name,e[16]=H):H=e[16];const R=H,[E,M]=we.useState(null),[v,$]=we.useState(null);let I;e[17]===Symbol.for("react.memo_cache_sentinel")?(I=s.jsxs("div",{className:"text-center mb-10 space-y-2",children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:"Feedback"}),s.jsx("p",{className:"text-muted-foreground",children:"Share your experience with PawTrace. Reviews appear publicly after moderation."})]}),e[17]=I):I=e[17];let _;e[18]===Symbol.for("react.memo_cache_sentinel")?(_=s.jsxs(at,{className:"grid grid-cols-3 max-w-lg mx-auto",children:[s.jsx(ve,{value:"write",children:"Write a review"}),s.jsx(ve,{value:"mine",children:"My reviews"}),s.jsx(ve,{value:"public",children:"Public reviews"})]}),e[18]=_):_=e[18];let G;e[19]===Symbol.for("react.memo_cache_sentinel")?(G=s.jsxs(Je,{children:[s.jsx(Xe,{children:"Leave a review"}),s.jsx(je,{children:"Rate PawTrace and add a short comment."})]}),e[19]=G):G=e[19];let f;e[20]!==a.error||e[21]!==a.isError?(f=a.isError&&s.jsx(Fe,{variant:"destructive",children:s.jsx(Te,{children:a.error?.message??"Failed to submit feedback"})}),e[20]=a.error,e[21]=a.isError,e[22]=f):f=e[22];let x;e[23]!==a.isSuccess?(x=a.isSuccess&&s.jsx(Fe,{children:s.jsx(Te,{children:"Thanks! Your review was submitted and will be visible after approval."})}),e[23]=a.isSuccess,e[24]=x):x=e[24];let w;e[25]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx(ue,{children:"Rating"}),e[25]=w):w=e[25];let K;e[26]!==T?(K=r=>T("rating",r,{shouldValidate:!0}),e[26]=T,e[27]=K):K=e[27];const Q=q||a.isPending;let V;e[28]!==L||e[29]!==K||e[30]!==Q?(V=s.jsx(Ie,{value:L,onChange:K,disabled:Q}),e[28]=L,e[29]=K,e[30]=Q,e[31]=V):V=e[31];let z;e[32]!==o.rating?(z=o.rating&&s.jsx("p",{className:"text-sm text-destructive",children:o.rating.message}),e[32]=o.rating,e[33]=z):z=e[33];let g;e[34]!==V||e[35]!==z?(g=s.jsxs("div",{className:"grid gap-2",children:[w,V,z]}),e[34]=V,e[35]=z,e[36]=g):g=e[36];let N;e[37]===Symbol.for("react.memo_cache_sentinel")?(N=s.jsx(ue,{htmlFor:"display_name",children:"Display name (optional)"}),e[37]=N):N=e[37];let p;e[38]!==F?(p=F("display_name"),e[38]=F,e[39]=p):p=e[39];let S;e[40]!==p?(S=s.jsx(Be,{id:"display_name",placeholder:"e.g., Collin",...p}),e[40]=p,e[41]=S):S=e[41];let j;e[42]!==o.display_name?(j=o.display_name&&s.jsx("p",{className:"text-sm text-destructive",children:o.display_name.message}),e[42]=o.display_name,e[43]=j):j=e[43];let Z;e[44]!==S||e[45]!==j?(Z=s.jsxs("div",{className:"grid gap-2",children:[N,S,j]}),e[44]=S,e[45]=j,e[46]=Z):Z=e[46];let fe;e[47]===Symbol.for("react.memo_cache_sentinel")?(fe=s.jsx(ue,{htmlFor:"comment",children:"Comment"}),e[47]=fe):fe=e[47];let ee;e[48]!==F?(ee=F("comment"),e[48]=F,e[49]=ee):ee=e[49];let te;e[50]!==ee?(te=s.jsx(Le,{id:"comment",placeholder:"What do you like? What should we improve?",rows:5,...ee}),e[50]=ee,e[51]=te):te=e[51];let se;e[52]!==o.comment?(se=o.comment&&s.jsx("p",{className:"text-sm text-destructive",children:o.comment.message}),e[52]=o.comment,e[53]=se):se=e[53];let ae;e[54]!==te||e[55]!==se?(ae=s.jsxs("div",{className:"grid gap-2",children:[fe,te,se]}),e[54]=te,e[55]=se,e[56]=ae):ae=e[56];let le;e[57]!==f||e[58]!==x||e[59]!==g||e[60]!==Z||e[61]!==ae?(le=s.jsxs(Ze,{className:"space-y-5",children:[f,x,g,Z,ae]}),e[57]=f,e[58]=x,e[59]=g,e[60]=Z,e[61]=ae,e[62]=le):le=e[62];let ie;e[63]!==W||e[64]!==R?(ie=W(R),e[63]=W,e[64]=R,e[65]=ie):ie=e[65];const ge=q||a.isPending,pe=q||a.isPending?"Submittingâ€¦":"Submit review";let ne;e[66]!==ie||e[67]!==ge||e[68]!==pe?(ne=s.jsx(et,{children:s.jsx(_e,{onClick:ie,disabled:ge,className:"w-full",children:pe})}),e[66]=ie,e[67]=ge,e[68]=pe,e[69]=ne):ne=e[69];let re;e[70]!==le||e[71]!==ne?(re=s.jsx(be,{value:"write",className:"mt-6",children:s.jsxs(X,{children:[G,le,ne]})}),e[70]=le,e[71]=ne,e[72]=re):re=e[72];let ce;e[73]!==O||e[74]!==v||e[75]!==C||e[76]!==y?(ce=s.jsx("div",{className:"space-y-4",children:C?s.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:Array.from({length:4}).map(pt)}):y&&y.length>0?s.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:y.map(r=>s.jsxs(X,{className:"p-4 flex flex-col gap-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:5}).map((ke,Ce)=>s.jsx(Se,{className:`h-4 w-4 ${Ce<r.rating?"fill-yellow-400 text-yellow-500":"text-muted-foreground/40"}`},Ce))}),s.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(r.created_at).toLocaleDateString()})]}),s.jsx("div",{className:"text-sm",children:r.comment}),r.display_name&&s.jsxs("div",{className:"text-xs text-muted-foreground",children:["â€” ",r.display_name]}),s.jsxs("div",{className:"mt-2 flex gap-2",children:[s.jsxs(_e,{size:"sm",variant:"outline",onClick:()=>M(r),children:[s.jsx(nt,{className:"h-4 w-4 mr-1"})," Edit"]}),s.jsxs(Re,{open:!!v&&v.id===r.id,onOpenChange:ke=>!ke&&$(null),children:[s.jsx(tt,{asChild:!0,children:s.jsxs(_e,{size:"sm",variant:"destructive",onClick:()=>$(r),children:[s.jsx(st,{className:"h-4 w-4 mr-1"})," Delete"]})}),s.jsxs(Ee,{children:[s.jsxs(Me,{children:[s.jsx($e,{children:"Delete this review?"}),s.jsx(Ke,{children:"This will permanently remove your review. This action cannot be undone."})]}),s.jsxs(Qe,{children:[s.jsx(Ve,{disabled:O.isPending,children:"Cancel"}),s.jsx(ze,{disabled:O.isPending,onClick:async()=>{await O.mutateAsync(r.id),$(null)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:O.isPending?"Deletingâ€¦":"Delete"})]})]})]})]})]},r.id))}):s.jsx(X,{className:"p-6",children:s.jsx(je,{children:"You havenâ€™t written any reviews yet."})})}),e[73]=O,e[74]=v,e[75]=C,e[76]=y,e[77]=ce):ce=e[77];let me;e[78]!==E||e[79]!==d?(me=E&&s.jsx(ht,{open:!!E,onOpenChange:r=>!r&&M(null),review:E,saving:d.isPending,onSave:async r=>{await d.mutateAsync({id:E.id,patch:r}),M(null)}}),e[78]=E,e[79]=d,e[80]=me):me=e[80];let oe;e[81]!==ce||e[82]!==me?(oe=s.jsxs(be,{value:"mine",className:"mt-6",children:[ce,me]}),e[81]=ce,e[82]=me,e[83]=oe):oe=e[83];let de;e[84]!==k||e[85]!==i?(de=s.jsx(be,{value:"public",className:"mt-6",children:k?s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map(xt)}):i&&i.length>0?s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(ft)}):s.jsx(X,{className:"p-6",children:s.jsx(je,{children:"No public reviews yet. Be the first to share your experience!"})})}),e[84]=k,e[85]=i,e[86]=de):de=e[86];let xe;return e[87]!==re||e[88]!==oe||e[89]!==de?(xe=s.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-10 md:py-14 max-w-6xl",children:[I,s.jsxs(lt,{defaultValue:"write",children:[_,re,oe,de]})]}),e[87]=re,e[88]=oe,e[89]=de,e[90]=xe):xe=e[90],xe}function ft(e){return s.jsxs(X,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:5}).map((t,l)=>s.jsx(Se,{className:`h-4 w-4 ${l<e.rating?"fill-yellow-400 text-yellow-500":"text-muted-foreground/40"}`},l))}),s.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()})]}),s.jsx("div",{className:"mt-2 text-sm",children:e.comment}),e.display_name&&s.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["â€” ",e.display_name]})]},e.id)}function xt(e,t){return s.jsxs(X,{className:"p-4",children:[s.jsx(J,{className:"h-4 w-1/3 mb-3"}),s.jsx("div",{className:"flex gap-2 mb-3",children:Array.from({length:5}).map(gt)}),s.jsx(J,{className:"h-4 w-3/4 mb-2"}),s.jsx(J,{className:"h-4 w-2/3"})]},t)}function gt(e,t){return s.jsx(J,{className:"h-5 w-5 rounded"},t)}function pt(e,t){return s.jsxs(X,{className:"p-4",children:[s.jsx(J,{className:"h-4 w-1/3 mb-3"}),s.jsx("div",{className:"flex gap-2 mb-3",children:Array.from({length:5}).map(yt)}),s.jsx(J,{className:"h-4 w-3/4 mb-2"}),s.jsx(J,{className:"h-4 w-2/3"})]},t)}function yt(e,t){return s.jsx(J,{className:"h-5 w-5 rounded"},t)}function jt(e){return dt(e)}function bt(e){return ot(e.id,e.patch)}function vt(){return ut(24)}export{Rt as default};
